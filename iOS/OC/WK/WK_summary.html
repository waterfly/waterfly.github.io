<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WK实践总结 | WaterFly</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just Coding">
    
    <link rel="preload" href="/assets/css/0.styles.84748982.css" as="style"><link rel="preload" href="/assets/js/app.3efcfa1f.js" as="script"><link rel="preload" href="/assets/js/3.d41f5393.js" as="script"><link rel="preload" href="/assets/js/1.0d0e82e9.js" as="script"><link rel="preload" href="/assets/js/36.3d80fb49.js" as="script"><link rel="prefetch" href="/assets/js/10.6a591f7b.js"><link rel="prefetch" href="/assets/js/11.2da2c136.js"><link rel="prefetch" href="/assets/js/12.597e1e9e.js"><link rel="prefetch" href="/assets/js/13.bfe6e49a.js"><link rel="prefetch" href="/assets/js/14.d5101ebe.js"><link rel="prefetch" href="/assets/js/15.d075eb78.js"><link rel="prefetch" href="/assets/js/16.1de846ec.js"><link rel="prefetch" href="/assets/js/17.73e1206f.js"><link rel="prefetch" href="/assets/js/18.3563029d.js"><link rel="prefetch" href="/assets/js/19.018202b6.js"><link rel="prefetch" href="/assets/js/20.92e231d8.js"><link rel="prefetch" href="/assets/js/21.a26b4bf6.js"><link rel="prefetch" href="/assets/js/22.a240a942.js"><link rel="prefetch" href="/assets/js/23.5d73353d.js"><link rel="prefetch" href="/assets/js/24.1a101222.js"><link rel="prefetch" href="/assets/js/25.f7c05ac5.js"><link rel="prefetch" href="/assets/js/26.cf0f99d3.js"><link rel="prefetch" href="/assets/js/27.4412c990.js"><link rel="prefetch" href="/assets/js/28.a9e9a7e1.js"><link rel="prefetch" href="/assets/js/29.9b39ea41.js"><link rel="prefetch" href="/assets/js/30.19dafc01.js"><link rel="prefetch" href="/assets/js/31.9d2c45f0.js"><link rel="prefetch" href="/assets/js/32.f7aa758f.js"><link rel="prefetch" href="/assets/js/33.54518586.js"><link rel="prefetch" href="/assets/js/34.71ab4ffb.js"><link rel="prefetch" href="/assets/js/35.5442dc08.js"><link rel="prefetch" href="/assets/js/37.d767afa3.js"><link rel="prefetch" href="/assets/js/38.15d6331f.js"><link rel="prefetch" href="/assets/js/39.a6c25426.js"><link rel="prefetch" href="/assets/js/4.d08f1479.js"><link rel="prefetch" href="/assets/js/40.87d678b9.js"><link rel="prefetch" href="/assets/js/41.edd890b5.js"><link rel="prefetch" href="/assets/js/42.d6677079.js"><link rel="prefetch" href="/assets/js/43.ff4d75ff.js"><link rel="prefetch" href="/assets/js/44.32c7a951.js"><link rel="prefetch" href="/assets/js/45.2c851721.js"><link rel="prefetch" href="/assets/js/46.9bbe5a11.js"><link rel="prefetch" href="/assets/js/47.0e2c36cc.js"><link rel="prefetch" href="/assets/js/48.09bc8442.js"><link rel="prefetch" href="/assets/js/49.52342b74.js"><link rel="prefetch" href="/assets/js/5.9634f48e.js"><link rel="prefetch" href="/assets/js/50.c9e3c4c5.js"><link rel="prefetch" href="/assets/js/51.28a51db9.js"><link rel="prefetch" href="/assets/js/52.58832236.js"><link rel="prefetch" href="/assets/js/53.86af7b76.js"><link rel="prefetch" href="/assets/js/54.973c15bf.js"><link rel="prefetch" href="/assets/js/55.d4a03e12.js"><link rel="prefetch" href="/assets/js/56.ac7e97e0.js"><link rel="prefetch" href="/assets/js/57.7fa14d11.js"><link rel="prefetch" href="/assets/js/58.b0f390b8.js"><link rel="prefetch" href="/assets/js/59.62b96874.js"><link rel="prefetch" href="/assets/js/6.4c543392.js"><link rel="prefetch" href="/assets/js/60.0c40514a.js"><link rel="prefetch" href="/assets/js/61.65259e68.js"><link rel="prefetch" href="/assets/js/62.9fb64114.js"><link rel="prefetch" href="/assets/js/63.3975ffd5.js"><link rel="prefetch" href="/assets/js/64.911d2812.js"><link rel="prefetch" href="/assets/js/65.ce9ab40b.js"><link rel="prefetch" href="/assets/js/66.b89de3df.js"><link rel="prefetch" href="/assets/js/67.4169b86c.js"><link rel="prefetch" href="/assets/js/68.a812ad4b.js"><link rel="prefetch" href="/assets/js/69.b0c76c03.js"><link rel="prefetch" href="/assets/js/7.2aba56aa.js"><link rel="prefetch" href="/assets/js/70.9749f302.js"><link rel="prefetch" href="/assets/js/71.0d38010b.js"><link rel="prefetch" href="/assets/js/72.a6338004.js"><link rel="prefetch" href="/assets/js/73.c1001eb8.js"><link rel="prefetch" href="/assets/js/74.0069037e.js"><link rel="prefetch" href="/assets/js/75.c4591a8d.js"><link rel="prefetch" href="/assets/js/76.e1a3f216.js"><link rel="prefetch" href="/assets/js/77.df0b0aac.js"><link rel="prefetch" href="/assets/js/78.2f535a98.js"><link rel="prefetch" href="/assets/js/79.60e4b9f5.js"><link rel="prefetch" href="/assets/js/8.c5d718a6.js"><link rel="prefetch" href="/assets/js/80.50af71ac.js"><link rel="prefetch" href="/assets/js/81.7d753c90.js"><link rel="prefetch" href="/assets/js/82.5703b0fa.js"><link rel="prefetch" href="/assets/js/83.4af8ebaa.js"><link rel="prefetch" href="/assets/js/84.ed963d52.js"><link rel="prefetch" href="/assets/js/85.7cb175ff.js"><link rel="prefetch" href="/assets/js/86.bd0d1f92.js"><link rel="prefetch" href="/assets/js/87.f00e8426.js"><link rel="prefetch" href="/assets/js/88.a34c0493.js"><link rel="prefetch" href="/assets/js/89.564cb64c.js"><link rel="prefetch" href="/assets/js/9.25143fa3.js"><link rel="prefetch" href="/assets/js/90.ce031d67.js"><link rel="prefetch" href="/assets/js/91.2a75f163.js"><link rel="prefetch" href="/assets/js/92.a2591da3.js"><link rel="prefetch" href="/assets/js/93.6af4f4b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84748982.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-349e681a><div data-v-349e681a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-b3e6ef50 data-v-349e681a data-v-349e681a><h3 class="title" data-v-b3e6ef50>WaterFly</h3> <p class="description" data-v-b3e6ef50>Just Coding</p> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-349e681a><header class="navbar" data-v-349e681a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WaterFly</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-349e681a></div> <aside class="sidebar" data-v-349e681a><div class="personal-info-wrapper" data-v-1bfe3fa5 data-v-349e681a><img src="/bike.png" alt="author-avatar" class="personal-img" data-v-1bfe3fa5> <!----> <div class="num" data-v-1bfe3fa5><div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>83</h3> <h6 data-v-1bfe3fa5>Articles</h6></div> <div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>34</h3> <h6 data-v-1bfe3fa5>Tags</h6></div></div> <ul class="social-links" data-v-1bfe3fa5></ul> <hr data-v-1bfe3fa5></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/iOS/OC/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html" class="sidebar-link">JavaSrciptCore学习</a></li><li><a href="/iOS/OC/WWDC19/WWDC19.html" class="sidebar-link">WWDC19 概要</a></li><li><a href="/iOS/OC/WK/WK_summary.html" aria-current="page" class="active sidebar-link">WK实践总结</a></li><li><a href="/iOS/OC/Thread/多用派发队列少用同步锁.html" class="sidebar-link">多用派发队列 少用同步锁</a></li><li><a href="/iOS/OC/Runtime/关联对象实现week.html" class="sidebar-link">关联对象实现week</a></li><li><a href="/iOS/OC/Component/京东组件化方案解析/京东组件化方案解析.html" class="sidebar-link">京东组件化方案解析</a></li><li><a href="/iOS/OC/Component/iOS组件化开源库阅读/iOS组件化开源库阅读.html" class="sidebar-link">iOS组件化开源库阅读</a></li><li><a href="/iOS/OC/Thread/App延长后台时间和backgroundFetch.html" class="sidebar-link">App 延长后台时间 和 background fetch</a></li><li><a href="/iOS/OC/Thread/iOS_IPC_线程通信.html" class="sidebar-link">iOS IPC 线程通信</a></li><li><a href="/iOS/OC/Thread/iOS锁总结/iOS锁总结.html" class="sidebar-link">iOS锁总结</a></li><li><a href="/iOS/OC/Kit/API_Reference系列之Mapkit解析.html" class="sidebar-link">API Reference 系列 之Mapkit解析</a></li><li><a href="/iOS/OC/Other/导航栏TitleView不显示的问题.html" class="sidebar-link">导航栏TitleView在iOS11上不显示</a></li><li><a href="/iOS/OC/Other/Xcode_GPX文件Mock真机系统定位.html" class="sidebar-link">Xcode GPX文件Mock真机系统定位</a></li><li><a href="/iOS/OC/Other/《禅与Objective-C编程艺术》阅读笔记.html" class="sidebar-link">《禅与 Objective-C 编程艺术 》阅读笔记</a></li><li><a href="/iOS/OC/Other/UniversalLink.html" class="sidebar-link">Universal Link接入方案</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-b3e6ef50 data-v-349e681a><h3 class="title" data-v-b3e6ef50>WK实践总结</h3> <!----> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-349e681a><div data-v-349e681a><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">WK实践总结</h1> <div data-v-0b291498><!----> <i class="iconfont reco-date" data-v-0b291498><span data-v-0b291498>3/29/2020</span></i> <!----> <i class="tags iconfont reco-tag" data-v-0b291498><span class="tag-item" data-v-0b291498>wk</span></i></div></div> <div class="theme-reco-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#wk总结">WK总结</a><ul><li><a href="#wk类分析">WK类分析</a><ul><li><a href="#wkwebviewconfiguration">WKWebViewConfiguration</a><ul><li><a href="#wkpreferences">WKPreferences</a></li><li><a href="#wkusercontentcontroller">WKUserContentController</a><ul><li><a href="#wkuserscript">WKUserScript</a></li><li><a href="#与js交互">与JS交互</a></li><li><a href="#rulelist">RuleList</a></li></ul></li><li><a href="#wkwebsitedatastore">WKWebsiteDataStore</a></li><li><a href="#suppressesincrementalrendering">suppressesIncrementalRendering</a></li><li><a href="#mediatypesrequiringuseractionforplayback-ios10">mediaTypesRequiringUserActionForPlayback(iOS10)</a></li><li><a href="#allowsinlinemediaplayback">allowsInlineMediaPlayback</a></li><li><a href="#selectiongranularity">selectionGranularity</a></li><li><a href="#datadetectortypes-ios10">dataDetectorTypes  （iOS10）</a></li><li><a href="#ignoresviewportscalelimits">ignoresViewportScaleLimits</a></li><li><a href="#wkurlschemehandler-ios11">WKURLSchemeHandler ( iOS11)</a></li></ul></li><li><a href="#wknavigationaction">WKNavigationAction</a><ul><li><a href="#属性">属性</a></li><li><a href="#相关类">相关类</a></li></ul></li><li><a href="#wkuidelegate">WKUIDelegate</a><ul><li><a href="#相关方法">相关方法</a></li><li><a href="#相关类">相关类</a></li></ul></li><li><a href="#wknavigationdelegate">WKNavigationDelegate</a><ul><li><a href="#协议方法">协议方法</a></li><li><a href="#相关类-协议-枚举">相关类/协议/枚举</a></li></ul></li><li><a href="#wkbackforwardlist">WKBackForwardList</a><ul><li><a href="#相关类">相关类</a></li></ul></li><li><a href="#wkprocesspool">WKProcessPool</a></li><li><a href="#部分重要方法">部分重要方法</a></li></ul></li><li><a href="#类结构图">类结构图</a></li><li><a href="#工程实践注意点">工程实践注意点</a><ul><li><a href="#wkscriptmessagehandler协议">WKScriptMessageHandler协议</a></li><li><a href="#blank情况">_blank情况</a></li><li><a href="#wk-在alert-无法弹出时会出现-crash">WK 在alert 无法弹出时会出现 Crash</a></li><li><a href="#wkuidelegate">WKUIDelegate</a></li><li><a href="#wknavigationdelegate">WKNavigationDelegate</a><ul><li><a href="#调用顺序分析">调用顺序分析</a></li><li><a href="#关于错误回调">关于错误回调</a></li><li><a href="#uiwebview-wkwebview-加载流程对比">UIWebView/WKWebView 加载流程对比</a></li></ul></li><li><a href="#useragent">UserAgent</a></li><li><a href="#本地离线包加载">本地离线包加载</a><ul><li><a href="#loadrequest">loadRequest</a></li><li><a href="#loadfileurl-allowingreadaccesstourl">loadFileURL:allowingReadAccessToURL:</a></li><li><a href="#设置wk跨域">设置WK跨域</a></li><li><a href="#私有api拦截wk请求">私有API拦截WK请求</a></li><li><a href="#wkurlschemehandler">WKURLSchemeHandler</a></li></ul></li><li><a href="#cookie问题">Cookie问题</a></li><li><a href="#白屏问题">白屏问题</a><ul><li><a href="#web页面url远程和本地">Web页面URL远程和本地</a></li><li><a href="#web页面被kill时的两种情况">Web页面被Kill时的两种情况</a><ul><li><a href="#web页面正在展示">Web页面正在展示</a></li><li><a href="#web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中">Web页面非当前展示页面，退到后台或在导航栈中非当前展示的VC中</a></li></ul></li></ul></li><li><a href="#estimatedprogress问题">estimatedProgress问题</a></li><li><a href="#默认的跳转行为-打开-ituns、tel、mail、等其他scheme">默认的跳转行为，打开 iTuns、tel、mail、等其他scheme</a></li></ul></li><li><a href="#附录">附录</a></li></ul></li></ul></div><p></p> <p>[TOC]</p> <h1 id="wk总结"><a href="#wk总结" class="header-anchor">#</a> WK总结</h1> <h2 id="wk类分析"><a href="#wk类分析" class="header-anchor">#</a> WK类分析</h2> <p>熟悉一个模块，先对内部所有类功能一个个熟悉，然后再跑个Demo各种验证功能，基本就差不多了。</p> <h3 id="wkwebviewconfiguration"><a href="#wkwebviewconfiguration" class="header-anchor">#</a> WKWebViewConfiguration</h3> <p>WKWeb页面的各种配置项，用config来创建WK，一旦创建wk后，就不能再修改config</p> <h4 id="wkpreferences"><a href="#wkpreferences" class="header-anchor">#</a> WKPreferences</h4> <p>用于设置web view一些属性，字体大小、是否允许js等，作用不大</p> <h4 id="wkusercontentcontroller"><a href="#wkusercontentcontroller" class="header-anchor">#</a> WKUserContentController</h4> <p>用与web页面进行JS通信和规则规律。该类主要由三个功能，向Web注入JS、与Web页面进行JS交互、按照设定的规则对Web页面进行过滤。<strong>注意，网上有资料说 WKWebViewConfiguration 存在不被释放的问题，具体这块要再研究下</strong></p> <h5 id="wkuserscript"><a href="#wkuserscript" class="header-anchor">#</a> WKUserScript</h5> <p>WKUserScript，JS的抽象，用于OC向Web注入或移除JS</p> <h5 id="与js交互"><a href="#与js交互" class="header-anchor">#</a> 与JS交互</h5> <p>用于JS向OC发送message，在OC中实现该协议，获取到到对应的message</p> <ul><li><p>WKScriptMessage</p></li> <li><p>WKScriptMessageHandler协议</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token operator">*</span> js中写法，替换name为自定义name，window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span><span class="token operator">&lt;</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>messageBody<span class="token operator">&gt;</span><span class="token punctuation">)</span>

<span class="token operator">*</span> OC中实现WKScriptMessageHandler协议，收到的message会封装为 WKScriptMessage

</code></pre></div></li></ul> <h5 id="rulelist"><a href="#rulelist" class="header-anchor">#</a> RuleList</h5> <p>用来过滤网页的规则，iOS11引入，基本用不到</p> <ul><li>WKContentRuleList</li> <li>WKContentRuleListStore</li></ul> <p>相关资料：</p> <ul><li><p><a href="https://www.jianshu.com/p/8af24e9dc82e" target="_blank" rel="noopener noreferrer">iOS 11：WKWebView内容过滤规则详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.apple.com/documentation/safariservices/creating_a_content_blocker?language=objc" target="_blank" rel="noopener noreferrer">Creating a Content Blocker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>   官方文档，介绍了过滤的规则</p></li> <li><p><a href="https://developer.apple.com/videos/play/wwdc2017/220/" target="_blank" rel="noopener noreferrer">WWDC 17：customized_loading_in_wkwebview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="wkwebsitedatastore"><a href="#wkwebsitedatastore" class="header-anchor">#</a> WKWebsiteDataStore</h4> <p>用于管理 Cookies, session storage, local storage, WebSQL, IndexedDB等Web存储相关。</p> <p>相关类有：</p> <ul><li>WKWebsiteDataRecord，对数据类型的抽象，只有两个属性
<ul><li>displayName，键值</li> <li>dataTypes，数据类型</li></ul></li> <li>WKHTTPCookieStore，从iOS11开始引入，用于WK管理Cookie</li></ul> <h4 id="suppressesincrementalrendering"><a href="#suppressesincrementalrendering" class="header-anchor">#</a> suppressesIncrementalRendering</h4> <p>是否在所有的数据加载到内存中才开始渲染，默认为 NO，目前感觉作用不大。</p> <h4 id="mediatypesrequiringuseractionforplayback-ios10"><a href="#mediatypesrequiringuseractionforplayback-ios10" class="header-anchor">#</a> mediaTypesRequiringUserActionForPlayback(iOS10)</h4> <p>类似 UIWEBVIEW的 mediaPlaybackRequiresUserAction（默认值是 true） ，但是修改成了 type类型，默认是none，即不需要。iOS 9- 10 用 <strong>requiresUserActionForMediaPlayback</strong> 属性，默认是NO，即不需要</p> <h4 id="allowsinlinemediaplayback"><a href="#allowsinlinemediaplayback" class="header-anchor">#</a> allowsInlineMediaPlayback</h4> <p>是否允许内敛播放，默认NO</p> <h4 id="selectiongranularity"><a href="#selectiongranularity" class="header-anchor">#</a> selectionGranularity</h4> <p>网页交互中选择内容的粒度。(自动变化/任何字符串边界)</p> <h4 id="datadetectortypes-ios10"><a href="#datadetectortypes-ios10" class="header-anchor">#</a> dataDetectorTypes  （iOS10）</h4> <p>默认值是 WKDataDetectorTypeNone ，我们工程没有设置，这些可通过 meta自动添加 <code>&lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no,email=no,adress=no&quot;&gt;</code></p> <h4 id="ignoresviewportscalelimits"><a href="#ignoresviewportscalelimits" class="header-anchor">#</a> ignoresViewportScaleLimits</h4> <p>是否禁止用户对web页面缩放，如果设置为true则禁止用户缩放页面，会会略 user-scalable 设置；默认值为false，受 <code>&lt;meta name=&quot;viewport&quot; content=&quot;user-scalable=no&quot;/&gt;</code> 里面的 user-scalable 控制</p> <h4 id="wkurlschemehandler-ios11"><a href="#wkurlschemehandler-ios11" class="header-anchor">#</a> WKURLSchemeHandler ( iOS11)</h4> <p>离线资源加载，只对对自定义的协议拦截，不能对http,https进行拦截</p> <p>相关类：</p> <ul><li>WKURLSchemeHandler</li> <li>WKWebViewConfiguration</li> <li>WKURLSchemeTask</li></ul> <h3 id="wknavigationaction"><a href="#wknavigationaction" class="header-anchor">#</a> WKNavigationAction</h3> <p>对打开新web这个动作的抽象</p> <h4 id="属性"><a href="#属性" class="header-anchor">#</a> 属性</h4> <ul><li>sourceFrame</li> <li>targetFrame</li> <li>navigationType</li> <li>request</li></ul> <h4 id="相关类"><a href="#相关类" class="header-anchor">#</a> 相关类</h4> <ul><li><strong>WKFrameInfo</strong>，对frame的一个抽象，比如 一个<iframe>标签就对应一个单独的 WKFrameInfo</iframe></li> <li><strong>WKNavigationType</strong>，动作的类型，比如 <code>&lt;a href target='_blank'&gt;</code>就是WKNavigationTypeLinkActivated；<code>window.open</code> 就是 WKNavigationTypeOther</li></ul> <h3 id="wkuidelegate"><a href="#wkuidelegate" class="header-anchor">#</a> WKUIDelegate</h3> <p>UI协议，用于处理 JS中 alert,confirm,prompt方法的展示，如果不实现相关协议，对应方法会无响应。注，在UIWebView中，这些是自动处理的。</p> <h4 id="相关方法"><a href="#相关方法" class="header-anchor">#</a> 相关方法</h4> <ul><li><p><code>createWebViewWithConfiguration</code>，处理 _blank的情况，如果不实现该方法，则WK不会响应_blank的情况</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 针对以下两种 _blank的情况，如果不实现该方法，以下两种行为会失效，即不会加载新页面</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;https://www.qq.com&quot;</span> target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span><span class="token operator">&gt;</span><span class="token constant">QQ</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
window<span class="token punctuation">.</span><span class="token function">open</span> <span class="token punctuation">(</span><span class="token string">'https://www.qq.com'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>runJavaScriptAlertPanelWithMessage</code>，当JS 调用 alert()时候会触发该方法，如果不实现则会无响应</p></li> <li><p><code>runJavaScriptConfirmPanelWithMessage</code>，当JS调用 confirm()时候会触发该方法，如果不实现则会无响应</p></li> <li><p><code>runJavaScriptTextInputPanelWithPrompt</code>，当JS调用 prompt(message,default) 时会触发该方法，如果不实现会无反应</p></li> <li><p><code>webViewDidClose:</code>，JS 调用 <code>window.close ();</code> 会触发该方法</p></li></ul> <h4 id="相关类-2"><a href="#相关类-2" class="header-anchor">#</a> 相关类</h4> <ul><li>WKWindowFeatures，当新的wk被请求的时候，展示一些额外的属性，包括statusbar, toolbar, menubar的一些状态，但都是readonly的</li></ul> <h3 id="wknavigationdelegate"><a href="#wknavigationdelegate" class="header-anchor">#</a> WKNavigationDelegate</h3> <p>一个非常重要的协议，webview加载各个阶段的代理方法。</p> <h4 id="协议方法"><a href="#协议方法" class="header-anchor">#</a> 协议方法</h4> <ul><li><p><code>decidePolicyForNavigationAction</code>，在发送请求之前决定是否跳转</p></li> <li><p><code>didStartProvisionalNavigation</code>，页面开始加载时调用</p></li> <li><p><code>decidePolicyForNavigationResponse</code>，在收到响应后决定是否跳转</p></li> <li><p><code>didCommitNavigation</code>，当内容开始返回时调用</p></li> <li><p><code>didFinishNavigation</code>，页面加载完成之后调用</p></li> <li><p><code>didFailNavigation</code>，启动时加载数据发生错误就会调用这个方法</p></li> <li><p><code>didFailProvisionalNavigation:withError:</code>，当一个正在提交的页面在跳转过程中出现错误时调用这个方法</p></li> <li><p><code>didReceiveServerRedirectForProvisionalNavigation</code>，接收到服务器跳转请求之后调用</p></li> <li><p><code>didReceiveAuthenticationChallenge</code>，证书 认证相关</p></li> <li><p><code>webViewWebContentProcessDidTerminate</code>，当wk进程即将被杀死的时候会调用，比如内存过高的时候，但是有文章说也有部分情况不会调用。一般在此方法内调用 webview reload</p></li></ul> <h4 id="相关类-协议-枚举"><a href="#相关类-协议-枚举" class="header-anchor">#</a> 相关类/协议/枚举</h4> <ul><li><strong>WKNavigationAction</strong></li> <li><strong>WKNavigation</strong>，无属性方法，官方说法是为了跟踪web的加载过程，作为唯一标示</li> <li><strong>WKNavigationResponse</strong>，用于 decidePolicyForNavigationResponse</li> <li><strong>WKNavigationActionPolicy</strong></li> <li><strong>WKNavigationResponsePolicy</strong></li></ul> <h3 id="wkbackforwardlist"><a href="#wkbackforwardlist" class="header-anchor">#</a> WKBackForwardList</h3> <p>用于页面前进后退管理，比较简单</p> <h4 id="相关类-3"><a href="#相关类-3" class="header-anchor">#</a> 相关类</h4> <ul><li>WKBackForwardListItem</li></ul> <h3 id="wkprocesspool"><a href="#wkprocesspool" class="header-anchor">#</a> WKProcessPool</h3> <p>web的进程池，多个web共享一个进程池，可以共享cookie、用户凭证等，但是苹果文档支出，如果一个进程池的web到达上限后，新的web会分配到新的进程池里，但是这个上限并没有说多少。</p> <p>该类在iOS11之前应该是很有用的，为了共享Cookie（把该类设置成单例，然后分配给WK），但是11之后，wk有了自己的cookie管理，似乎作用不到了。</p> <p>具体还要再研究下</p> <h3 id="部分重要方法"><a href="#部分重要方法" class="header-anchor">#</a> 部分重要方法</h3> <ul><li><strong>estimatedProgress</strong>，页面加载进度，可以KVO</li> <li><strong>evaluateJavaScript</strong>，可以向页面注入JS方法执行</li> <li><strong>takeSnapshotWithConfiguration</strong>，获取wk可见区域的视图，iOS11引入</li> <li><strong>allowsBackForwardNavigationGestures</strong>，是否允许右滑手势，默认是NO。设置为YES后，右滑会打开上个Web页面，体验与Native类似</li> <li><strong>allowsLinkPreview</strong>，是否允许预览,10及其以后默认值是YES之前是NO，如果设置YES,用户点击会跳转到Safari</li></ul> <h2 id="类结构图"><a href="#类结构图" class="header-anchor">#</a> 类结构图</h2> <p><img src="WKClass.jpg" alt=""></p> <h2 id="工程实践注意点"><a href="#工程实践注意点" class="header-anchor">#</a> 工程实践注意点</h2> <h3 id="wkscriptmessagehandler协议"><a href="#wkscriptmessagehandler协议" class="header-anchor">#</a> WKScriptMessageHandler协议</h3> <div class="language-objc extra-class"><pre class="language-objc"><code>
<span class="token comment">//苹果在 WKWebView 中的 js runtime 里事先注入了一个 window.webkit.messageHandlers.OOXX.postMessage() 方法，我们可以使用这个方法直接向 Native 层传值，异常方便</span>

    
<span class="token comment">//Demo：</span>
    JS<span class="token punctuation">:</span>
在JS中使用window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>TEST<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>向APP传值

    OC<span class="token punctuation">:</span>
func <span class="token function">userContentController</span><span class="token punctuation">(</span>userContentController<span class="token punctuation">:</span> WKUserContentController<span class="token punctuation">,</span> didReceiveScriptMessage message<span class="token punctuation">:</span> WKScriptMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//根据定义的key来判断message</span>
    <span class="token keyword">if</span> message<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;TEST&quot;</span> <span class="token punctuation">{</span>
    <span class="token comment">//转换为字典,并获取key/value</span>
        <span class="token keyword">if</span> let dic <span class="token operator">=</span> message<span class="token punctuation">.</span>body as<span class="token operator">?</span> NSDictionary<span class="token punctuation">,</span>
          
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="blank情况"><a href="#blank情况" class="header-anchor">#</a> _blank情况</h3> <p>JS中使用_blank打开新页面的情况有两种：</p> <ul><li><code>&lt;a href=&quot;https://www.qq.com&quot; target=&quot;_blank&quot;&gt;QQ&lt;/a&gt;</code></li> <li><code>window.open ('https://www.qq.com', '_blank’)</code></li></ul> <p>当以上两种情况使用 _blank 需要新开页面的情况，如果WK不实现相关代理方法，则WK会无响应。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//示例代码</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> WKUIDelegate</span></span>
<span class="token comment">/*
 处理：_blank的情况，如果不实现该方法，则WK不会响应_blank的情况
 &lt;a href=&quot;https://www.qq.com&quot; target=&quot;_blank&quot;&gt;QQ&lt;/a&gt;   ，对应 WKNavigationAction.navigationType == WKNavigationTypeLinkActivated
 window.open ('https://www.qq.com', '_blank');  对应 WKNavigationAction.navigationType == WKNavigationTypeOther
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView createWebViewWithConfiguration<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebViewConfiguration <span class="token operator">*</span><span class="token punctuation">)</span>configuration forNavigationAction<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationAction <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction windowFeatures<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWindowFeatures <span class="token operator">*</span><span class="token punctuation">)</span>windowFeatures<span class="token punctuation">{</span>
    <span class="token comment">//对于加载新连接的情况是 navigationAction.sourceFrame = xxxx, navigationAction.targetFrame = nil</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigationAction<span class="token punctuation">.</span>targetFrame<span class="token punctuation">.</span>isMainFrame<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//感觉这里判断的意义不大，测试了 href, window.open, iframe 里面的href 和 open, 对应的 target 都为 nil，且该方法只会走一次，已知的两种情况targetFrame都为nil ，u不知道有没其他情况</span>
        <span class="token punctuation">[</span>webView loadRequest<span class="token punctuation">:</span>navigationAction<span class="token punctuation">.</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>网上还有一种方案是说，用 WKNavigationDelegate 的 decidePolicyForNavigationAction，该方法是当加载任一url的时候都会加载 ，<strong>但是这个方法只有 href 的情况调用，当Js调用 windows.open 的时候 不会调用</strong>：</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> WKNavigationDelegate</span></span>

<span class="token comment">/*
 
 这个方法是加载任意url都会先走这个方法，
 &lt;a href=&quot;&quot; target=&quot;_blank&gt; 的情况会走该方法，
 windown.open(url,'_blank&quot;)则不会先走，如果不实现 createWebViewWithConfiguration ，则会无响应
 
 第一打开web
 navigationAction.sourceFrame = nil
 navigationAction.targetFrame = xxxxx
 
 加载其他链接
 navigationAction.sourceFrame = xxxxx
 navigationAction.targetFrame = nil
 
 navigationAction.sourceFrame = nil
 navigationAction.targetFrame = yyyyy
 
 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationAction<span class="token punctuation">:</span><span class="token punctuation">(</span>WKNavigationAction <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction decisionHandler<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>WKNavigationActionPolicy<span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">{</span>
    <span class="token comment">//如果是跳转一个新页面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigationAction<span class="token punctuation">.</span>targetFrame <span class="token operator">==</span> nil<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>webView loadRequest<span class="token punctuation">:</span>navigationAction<span class="token punctuation">.</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">decisionHandler</span><span class="token punctuation">(</span>WKNavigationActionPolicyAllow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="wk-在alert-无法弹出时会出现-crash"><a href="#wk-在alert-无法弹出时会出现-crash" class="header-anchor">#</a> WK 在alert 无法弹出时会出现 Crash</h3> <p>详见 <a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">WKWebView 那些坑    Bugly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="wkuidelegate-2"><a href="#wkuidelegate-2" class="header-anchor">#</a> WKUIDelegate</h3> <p>WKUIDelegate 的几个回调需要处理，否则 JS的 <em>alert()</em>、<em>confirm()</em>、<em>prompt(message,default)</em> 方法会无响应。</p> <p>其中 <code>webViewDidClose:</code>可以不用处理，该回调对应 js 的 *window.close ()*方法。 目前似乎没有这个场景，window.close()是针对使用 window.open() 打开的页面，目前这种写法比较少。</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>
#pragma mark - WKUIDelegate


/*
 处理：_blank的情况，如果不实现该方法，则WK不会响应_blank的情况
 &lt;a href=&quot;https://www.qq.com&quot; target=&quot;_blank&quot;&gt;QQ&lt;/a&gt;   ，对应 WKNavigationAction.navigationType == WKNavigationTypeLinkActivated
 window.open ('https://www.qq.com', '_blank');  对应 WKNavigationAction.navigationType == WKNavigationTypeOther
 */
- (nullable WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures{
    //对于加载新连接的情况是 navigationAction.sourceFrame = xxxx, navigationAction.targetFrame = nil
    if (!navigationAction.targetFrame.isMainFrame) {        //感觉这里判断的意义不大，测试了 href, window.open, iframe 里面的href 和 open, 对应的 target 都为 nil，且该方法只会走一次，已知的两种情况targetFrame都为nil ，不知道有没其他情况
        [webView loadRequest:navigationAction.request];
    }
    return nil;
}

/*
 js 调用 window.close (); 会触发该方法，官方文档说：
 Your app should remove the web view from the view hierarchy and update the UI as needed, for instance by closing the containing browser tab or window.
 但是目前似乎没有这个场景，window.close()是针对使用 window.open() 打开的页面，似乎 这种写法比较少
 该代理暂时不处理
 
 */
//- (void)webViewDidClose:(WKWebView *)webView API_AVAILABLE(macosx(10.11), ios(9.0)){
//
//}

//当JS 调用 alert()时候会触发该方法，如果不实现则会无响应
- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler{
    
    UIAlertController *alert = [UIAlertController alertControllerWithTitle:message
                                                                   message:nil
                                                            preferredStyle:UIAlertControllerStyleAlert];
    UIAlertAction *action = [UIAlertAction actionWithTitle:@&quot;确定&quot;
                                                     style:UIAlertActionStyleDefault
                                                   handler:^(UIAlertAction * _Nonnull action) {
                                                       completionHandler();
                                                   }];
    [alert addAction:action];
    [self.currentVC presentViewController:alert animated:YES completion:nil];
}

//当JS调用 confirm()时候会触发该方法，如果不实现则会无响应
- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL result))completionHandler{
    UIAlertController *alert = [UIAlertController alertControllerWithTitle:message
                                                                   message:nil
                                                            preferredStyle:UIAlertControllerStyleAlert];
    UIAlertAction *sure = [UIAlertAction actionWithTitle:@&quot;确定&quot;
                                                   style:UIAlertActionStyleDefault
                                                 handler:^(UIAlertAction * _Nonnull action) {
                                                     completionHandler(YES);
                                                 }];
    UIAlertAction *cacle = [UIAlertAction actionWithTitle:@&quot;取消&quot;
                                                    style:UIAlertActionStyleCancel
                                                  handler:^(UIAlertAction * _Nonnull action) {
                                                      completionHandler(NO);
                                                  }];
    
    [alert addAction:sure];
    [alert addAction:cacle];
    [self.currentVC presentViewController:alert animated:YES completion:nil];
}

/*
 当JS调用 prompt(message,default) 时会触发该方法，如果不实现会无反应，注意 defaultd参数无textfiled的默认值不是placeHolder
 注意点，在action的handler里是不能直接饮用 UIAlertController 的，否则会造成循环引用。网上的例子多是直接引用，是不对的
 */
- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(nullable NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * _Nullable result))completionHandler{
    UIAlertController *alert = [UIAlertController alertControllerWithTitle:prompt
                                                                   message:nil
                                                            preferredStyle:UIAlertControllerStyleAlert];
    
    __weak typeof(alert) weakAlert = alert;
    UIAlertAction *sure = [UIAlertAction actionWithTitle:@&quot;确定&quot;
                                                   style:UIAlertActionStyleDefault
                                                 handler:^(UIAlertAction * _Nonnull action) {
                                                     //                                                       网上例子大多是直接饮用alert，这里直接引用alert是会造成 UIAlertController 泄露的，理论实践都验证了
                                                     //                                                     completionHandler(alert.textFields.firstObject.text);
                                                     completionHandler(weakAlert.textFields.firstObject.text);
                                                 }];
    UIAlertAction *cacle = [UIAlertAction actionWithTitle:@&quot;取消&quot;
                                                    style:UIAlertActionStyleCancel
                                                  handler:^(UIAlertAction * _Nonnull action) {
                                                      completionHandler(nil);
                                                  }];
    [alert addTextFieldWithConfigurationHandler:^(UITextField * _Nonnull textField) {
        textField.text = defaultText;
    }];
    
    [alert addAction:sure];
    [alert addAction:cacle];
    [self.currentVC presentViewController:alert animated:YES completion:nil];
}

</code></pre></div><h3 id="wknavigationdelegate-2"><a href="#wknavigationdelegate-2" class="header-anchor">#</a> WKNavigationDelegate</h3> <h4 id="调用顺序分析"><a href="#调用顺序分析" class="header-anchor">#</a> 调用顺序分析</h4> <p>不存在iframe时的web调用顺序</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//不存在iframe时的调用顺序</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didStartProvisionalNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>
ebView<span class="token punctuation">:</span>didCommitNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didFinishNavigation<span class="token punctuation">:</span>

</code></pre></div><p>当页面存在一个iframe标签时调用顺序为</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//当页面存在一个iframe时调用顺序为：</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>    （URL<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/）</span>
webView<span class="token punctuation">:</span>didStartProvisionalNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didCommitNavigation<span class="token punctuation">:</span>

<span class="token comment">//这里会多出这两次调用，用于加载iframe</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>    （URL<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/sencond.html）</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>

webView<span class="token punctuation">:</span>didFinishNavigation<span class="token punctuation">:</span>

</code></pre></div><p>当有两个 iframe时的调用顺序，即对iframe会一次性调用 <code>decidePolicyForNavigationAction</code> ，然后再一次性调用<code>decidePolicyForNavigationResponse</code></p> <div class="language-objc extra-class"><pre class="language-objc"><code>
<span class="token comment">//当有两个 iframe时的调用顺序，即对iframe会一次性调用 decidePolicyForNavigationAction ，然后再一次性调用decidePolicyForNavigationResponse</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/</span>
webView<span class="token punctuation">:</span>didStartProvisionalNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/</span>
webView<span class="token punctuation">:</span>didCommitNavigation<span class="token punctuation">:</span>

webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/sencond.html</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/thrid.html</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/sencond.html</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.100:8005/thrid.html</span>

webView<span class="token punctuation">:</span>didFinishNavigation<span class="token punctuation">:</span>

</code></pre></div><p>如果在 decidePolicyForNavigationAction 中选择cancel，调用顺序</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//如果在 decidePolicyForNavigationAction 中选择cancel，调用顺序</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>

</code></pre></div><p>如果在 decidePolicyForNavigationResponse 里选择 cancel的调用顺序，最后会调用fail</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//如果在 decidePolicyForNavigationResponse 里选择 cancel的调用顺序，最后会调用fail</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didStartProvisionalNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>decidePolicyForNavigationResponse<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didFailProvisionalNavigation<span class="token punctuation">:</span>withError<span class="token punctuation">:</span>

</code></pre></div><h4 id="关于错误回调"><a href="#关于错误回调" class="header-anchor">#</a> 关于错误回调</h4> <p>WK错误回调有两个：</p> <ul><li><p><code>webView:didFailProvisionalNavigation:withError:</code> ，启动时加载数据发生错误就会调用这个方法</p></li> <li><p><code>webView:didFailNavigation:withError:</code>，当一个正在提交的页面在跳转过程中出现错误时调用这个方法 ，例如在didCommitNavigation这个代理方法中调用webview的stopLoading方法，但是具体还有点不清楚</p></li></ul> <p>具体区别还没搞清楚，现在测试如果页面加载失败，比如关掉nginx的情况，会调用 didFailProvisionalNavigation</p> <div class="language-objc extra-class"><pre class="language-objc"><code>webView<span class="token punctuation">:</span>decidePolicyForNavigationAction<span class="token punctuation">:</span>decisionHandler<span class="token punctuation">:</span>  url<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.1.110/</span>
webView<span class="token punctuation">:</span>didStartProvisionalNavigation<span class="token punctuation">:</span>
webView<span class="token punctuation">:</span>didFailProvisionalNavigation<span class="token punctuation">:</span>withError<span class="token punctuation">:</span>
</code></pre></div><h4 id="uiwebview-wkwebview-加载流程对比"><a href="#uiwebview-wkwebview-加载流程对比" class="header-anchor">#</a> UIWebView/WKWebView 加载流程对比</h4> <p>WK的回调更加细分，方便精细度控制</p> <p><img src="/assets/img/WKLoadProcess.b14e39e1.jpg" alt=""></p> <h3 id="useragent"><a href="#useragent" class="header-anchor">#</a> UserAgent</h3> <p>WK新增了两种设置UA的方法</p> <ul><li><code>WKWebViewConfiguration.applicationNameForUserAgent</code>，这个会对默认的UA值设备信息部分进行替换</li> <li><code>WKWebView.customUserAgent</code>，设置这个值会完全覆盖UA值</li></ul> <p>示例</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//WK</span>
Defaults User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> 
Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>iPhone<span class="token punctuation">;</span> CPU iPhone OS <span class="token number">12</span>_4 like Mac OS X<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">605.1</span><span class="token number">.15</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Mobile<span class="token operator">/</span><span class="token number">15E148</span>

WKWebViewConfiguration<span class="token punctuation">.</span>applicationNameForUserAgent<span class="token punctuation">:</span>    TestUA
Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>iPhone<span class="token punctuation">;</span> CPU iPhone OS <span class="token number">12</span>_4 like Mac OS X<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">605.1</span><span class="token number">.15</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> TestUA

WKWebView<span class="token punctuation">.</span>customUserAgent<span class="token punctuation">:</span>    TestUA
User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> TestUA

</code></pre></div><p>设置全局UA方法：</p> <div class="language-objc extra-class"><pre class="language-objc"><code>WKWebView  <span class="token operator">*</span>wkWebView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKWebView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span>CGRectZero<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>wkWebView evaluateJavaScript<span class="token punctuation">:</span><span class="token string">@&quot;navigator.userAgent&quot;</span> completionHandler<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id  _nullable result<span class="token punctuation">,</span> NSError <span class="token operator">*</span> _nullable error<span class="token punctuation">)</span> <span class="token punctuation">{</span>      
   <span class="token comment">//1）获取默认userAgent：</span>
   NSString <span class="token operator">*</span>oldUA <span class="token operator">=</span> result<span class="token punctuation">;</span>   <span class="token comment">//直接获取为nil </span>
  
  <span class="token comment">//2）设置userAgent：添加额外的信息   </span>
  NSString <span class="token operator">*</span>newUA <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%@ crfapp/(%@)&quot;</span><span class="token punctuation">,</span> oldUA <span class="token punctuation">,</span> <span class="token string">@&quot;ios;43&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
  NSDictionary <span class="token operator">*</span>dictNU <span class="token operator">=</span> <span class="token punctuation">[</span>NSDictionary dictionaryWithObjectsAndKeys<span class="token punctuation">:</span>newUA<span class="token punctuation">,</span> <span class="token string">@&quot;UserAgent&quot;</span><span class="token punctuation">,</span> nil<span class="token punctuation">]</span><span class="token punctuation">;</span>   
  <span class="token punctuation">[</span><span class="token punctuation">[</span>NSUserDefaults standardUserDefaults<span class="token punctuation">]</span> registerDefaults<span class="token punctuation">:</span>dictNU<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//注：WKWebView  调用evaluateJavaScript方法获取UA或者设置UA时，需执行loadRequest方法，否则completionHandler result值为空。但是经过测试，是可以拿到的，估计部分系统有该问题</span>

NSURL <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token punctuation">[</span>NSURL URLWithString<span class="token punctuation">:</span><span class="token string">&quot;h5Url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSURLRequest <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span>NSURLRequest requestWithURL<span class="token punctuation">:</span>url
                                             cachePolicy<span class="token punctuation">:</span>NSURLRequestUseProtocolCachePolicy
                                         timeoutInterval<span class="token punctuation">:</span><span class="token number">10.f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>wkWebView loadRequest<span class="token punctuation">:</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><p>经过测试，<strong>UA的优先级为：WKWebView.customUserAgent &gt; 全局设置 &gt; applicationNameForUserAgent</strong></p> <p><strong>注意，WK全局设置UA，由于是异步，回调可能比较晚，App启动第一次可能回调还没回来，所以UA可能会失效。可直接使用UIWebView设置UA，并设置WK的 applicationNameForUserAgent或customUserAgent，用来防止UA失去自定义节点。</strong></p> <h3 id="本地离线包加载"><a href="#本地离线包加载" class="header-anchor">#</a> 本地离线包加载</h3> <h4 id="loadrequest"><a href="#loadrequest" class="header-anchor">#</a> loadRequest</h4> <p>真机不能使用loadRequest，无法加载本地页面，但是模拟器可以</p> <h4 id="loadfileurl-allowingreadaccesstourl"><a href="#loadfileurl-allowingreadaccesstourl" class="header-anchor">#</a> <strong>loadFileURL:allowingReadAccessToURL:</strong></h4> <p>NSURL 必须是file协议，否则会无法加载</p> <p>使用 <code>NSURL *url = [NSURL fileURLWithPath:fragment]</code> 方法会对#等参数进行编码，导致无法识别。所以有两种解决方法：</p> <ol><li><p>手动拼接 <code>file://</code>，不使用 <code>fileURLWithPath:</code>方法</p></li> <li><p>使用 NSURLComponents方法，对query和fragmetn进行设置</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>
            NSURLComponents *test = [NSURLComponents componentsWithURL:url resolvingAgainstBaseURL:nil];
            test.fragment = @&quot;/list&quot;;
            [test setQueryItems:@[[NSURLQueryItem queryItemWithName:@&quot;data&quot; value:@&quot;3333&quot;]]];
            [self.webView loadFileURL:test.URL allowingReadAccessToURL:[NSURL fileURLWithPath:document]];


</code></pre></div></li></ol> <h4 id="设置wk跨域"><a href="#设置wk跨域" class="header-anchor">#</a> 设置WK跨域</h4> <p>另外需要注意，必须设置WK跨域，否则会无法加载本地包</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>    [configuration.preferences setValue:@YES forKey:@&quot;allowFileAccessFromFileURLs&quot;];
    if (@available(iOS 10.0, *)) {
        [configuration setValue:@YES forKey:@&quot;allowUniversalAccessFromFileURLs&quot;];
    }
}
</code></pre></div><p>###拦截WKWebView请求</p> <h4 id="私有api拦截wk请求"><a href="#私有api拦截wk请求" class="header-anchor">#</a> 私有API拦截WK请求</h4> <p>基于UIWebView可以自由做拦截，然后做资源缓存等处理，但是WK无法通过 NSURLProtocol 做拦截，资源缓存这块比较难处理。</p> <p>WK的请求其实是可以拦截的，通过一个私有API <code>[WKBrowsingContextController registerSchemeForCustomProtocol:]</code>，但是这种方案有两个问题：</p> <ul><li>Web页面的POST请求body体会被清空</li> <li>对ATS支持不足，Allow Arbitrary Loads 选项设置为NO 下，一旦拦截后，WK发起的http网络请求会被阻塞。不过这块设置为YES即可。</li></ul> <p>针对第一个问题，其实网上有一个方案可以绕过，大致思路是：</p> <ol><li>Hook Ajax请求，Web页面的Ajax请求全部通过Native转发</li> <li>通过私有API拦截WK请求，由于Ajax请求已经被Hook，剩下的请求一般都是图片等资源请求，不存在body体的情况，可以拦截后做本地缓存等处理。</li></ol> <p>不过需要注意点，目前似乎只能做到Hook Ajax请求，还无法做到Hook fetch请求。如果Web页面有post的fetch请求，请求会失败。还有文章提出Hook Ajax可能存在 <strong>post header字符长度限制</strong> 、<strong>Put类型请求异常</strong>等情况。</p> <p>具体可参考：</p> <ul><li><p><a href="https://github.com/wendux/Ajax-hook" target="_blank" rel="noopener noreferrer">Ajax-hook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/karosLi/KKJSBridge" target="_blank" rel="noopener noreferrer">KKJSBridge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p>还有一个技巧，可通过搭建locak web server的形式来加载本地包，不过个人感觉这块目前意义不大，具体可参考 <a href="https://juejin.im/entry/599e500e6fb9a0249174fa31" target="_blank" rel="noopener noreferrer">基于 LocalWebServer 实现 WKWebView 离线资源加载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="wkurlschemehandler"><a href="#wkurlschemehandler" class="header-anchor">#</a> WKURLSchemeHandler</h4> <p>作用与NSURLProtocol类似，可以拦截网络请求，但是只能拦截WK中自定义协议，一般使用 WKURLSchemeHandler 实现的 WKWebView 离线资源加载。<strong>WKURLSchemeHandler 最好的场景还是用在加载本地图片上，其它方面不稳定，慎用</strong>。</p> <p>WKURLSchemeHandler 是 iOS11 就推出的，用于处理自定义请求的方案，不过并不能处理 HTTP、HTTPS 等常规 scheme。</p> <div class="language-objc extra-class"><pre class="language-objc"><code><span class="token comment">//相关代码</span>

<span class="token comment">//WKURLSchemeHandler</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView startURLSchemeTask<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>WKURLSchemeTask<span class="token operator">&gt;</span><span class="token punctuation">)</span>urlSchemeTask<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token punctuation">:</span><span class="token punctuation">(</span>WKWebView <span class="token operator">*</span><span class="token punctuation">)</span>webView stopURLSchemeTask<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>WKURLSchemeTask<span class="token operator">&gt;</span><span class="token punctuation">)</span>urlSchemeTask<span class="token punctuation">;</span>

<span class="token comment">//WKWebViewConfiguration</span>
<span class="token comment">//注册 schemeHandle， You can use +[WKWebView handlesURLScheme:] to check the availability of a given URL scheme.</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setURLSchemeHandler<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>WKURLSchemeHandler<span class="token operator">&gt;</span><span class="token punctuation">)</span>urlSchemeHandler forURLScheme<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>urlScheme <span class="token function">API_AVAILABLE</span><span class="token punctuation">(</span><span class="token function">macosx</span><span class="token punctuation">(</span><span class="token number">10.13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ios</span><span class="token punctuation">(</span><span class="token number">11.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取当前 schemeHandle 示例</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>WKURLSchemeHandler<span class="token operator">&gt;</span><span class="token punctuation">)</span>urlSchemeHandlerForURLScheme<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>urlScheme <span class="token function">API_AVAILABLE</span><span class="token punctuation">(</span><span class="token function">macosx</span><span class="token punctuation">(</span><span class="token number">10.13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ios</span><span class="token punctuation">(</span><span class="token number">11.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//WKWebView</span>
<span class="token comment">//判断  urlScheme 是否可以用</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>handlesURLScheme<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>urlScheme <span class="token function">API_AVAILABLE</span><span class="token punctuation">(</span><span class="token function">macosx</span><span class="token punctuation">(</span><span class="token number">10.13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ios</span><span class="token punctuation">(</span><span class="token number">11.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//WKURLSchemeTask</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURLRequest <span class="token operator">*</span>request<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>didReceiveResponse<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLResponse <span class="token operator">*</span><span class="token punctuation">)</span>response<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>didReceiveData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSData <span class="token operator">*</span><span class="token punctuation">)</span>data<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>didFinish<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>didFailWithError<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">;</span>

</code></pre></div><p>参考资料：</p> <ul><li><a href="https://mp.weixin.qq.com/s/VcvZ1C1Qs26v5iB8dwBjcw" target="_blank" rel="noopener noreferrer">WKURLSchemeHandler 的能与不能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/hite/AppHost" target="_blank" rel="noopener noreferrer">AppHost<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>   一个 native 和 h5 通讯的框架，支持调试</li> <li><a href="https://developer.apple.com/videos/play/wwdc2017/220/" target="_blank" rel="noopener noreferrer">WWDC 2017 Customized Loading in WKWebView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/pengyuan_D/article/details/89958936" target="_blank" rel="noopener noreferrer">思考 NSURLProtocol 无法拦截 WKWebview 请求的解决思路<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，在本篇文章中，使用了私有api，hook wk，从而拦截http, https请求，（不过 iOS 12.2 上该方法已经失效，不存在此属性，详见 <a href="https://nemocdz.github.io/post/ios-%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86proxy%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener noreferrer">iOS 设置代理（Proxy）方案总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="cookie问题"><a href="#cookie问题" class="header-anchor">#</a> Cookie问题</h3> <p>WK的软肋之一就是Cookie问题，<strong>Cookie问题的核心就是 WKWebview 与 NSHTTPCookieStorage 的Cookie不共享</strong>。</p> <p>WK在 iOS11 推出了 WKHTTPCookieStore 管理Cookie，基本解决了Cookie软肋的问题。不过依然无法做到与Native请求共享Cookie，如果共享需要手动处理。</p> <p>鉴于工程实际情况，对WK的Cooike做了以下处理：</p> <ul><li><p>创建一个 WKProcessPool 的单例，WK共享该 WKProcessPool，使不同WK共享WK</p></li> <li><p>对iOS11 以下的情况，针对首次request主动携带 NSHTTPCookieStorage 里的Cookie</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>NSArray&lt;NSHTTPCookie *&gt; *availableCookie = [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookiesForURL:request.URL];
                    if (availableCookie.count &gt; 0) {
                        NSDictionary *reqHeader = [NSHTTPCookie requestHeaderFieldsWithCookies:availableCookie];
                        NSString *cookieStr = [reqHeader objectForKey:@&quot;Cookie&quot;];
                        
                        muRequest = [request mutableCopy];
                        [(NSMutableURLRequest *)muRequest setValue:cookieStr forHTTPHeaderField:@&quot;Cookie&quot;];
                    }
[webView loadRequest:muRequest];
</code></pre></div></li> <li><p>其他情况，无业务需求，暂不做处理。Cookie这块比较复杂，看的脑壳疼，目前基于工程现状，不需要做到</p></li></ul> <p>NSHTTPCookieStorage 与 WK的同步，具体有需要再处理。</p> <p>不同工程注意点不一样，这块具体可以参考</p> <p><a href="https://xiaozhuanlan.com/topic/5743162890" target="_blank" rel="noopener noreferrer">WKWebView 你爬出来了吗？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.geniusqyu.com/2018/12/02/WKWebView-cookie-%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener noreferrer">WKWebView Cookie 问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/entry/5975916e518825594d23d777" target="_blank" rel="noopener noreferrer">教你使用 WKWebView 的正确姿势<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">WKWebView 那些坑    Bugly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/ac45d99cf912" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（上）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/870dba42ec15" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（中）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/52668d5b2e68" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（下）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5NzMwODI0MA==&amp;mid=2647764511&amp;idx=1&amp;sn=eb792ed468a13239926641c9dd7091e2&amp;chksm=8887d520bff05c36484ed8a9a0731014c93a94ac0d7d9f944c9470cad48d1f21ec0dccc552a7&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1567467597976&amp;sharer_shareid=c38ca2f3cbd21853ce550074313749fc%23rd" target="_blank" rel="noopener noreferrer">一站式解决WKWebView各类问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="白屏问题"><a href="#白屏问题" class="header-anchor">#</a> 白屏问题</h3> <p>在 <a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">WKWebView 那些坑    Bugly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中有提到白屏问题，WK是独立的进程，当系统内存过高时，可能会Kill掉WK进程，造成白屏问题。文中的做法是在 <code>webViewWebContentProcessDidTerminate:</code> 回调中执行 <code>reload</code>。</p> <p>在接入实际过程中，发现我们工程中简单的执行reload会有以下几个问题：</p> <ul><li>页面非当前展示页面时，即使调用reload，系统依然会再次kill掉页面，会造成频繁kill，频繁reload，消耗性能</li> <li>file协议的本地Web页面，执行reload会报错：<code>*Error Domain=kCFErrorDomainCFNetwork Code=1 &quot;(null)&quot; UserInfo={_NSURLErrorFailingURLSessionTaskErrorKey=LocalDataTask*</code></li></ul> <h4 id="web页面url远程和本地"><a href="#web页面url远程和本地" class="header-anchor">#</a> Web页面URL远程和本地</h4> <ol><li>http/https，http类型的可以执行 <code>reload</code></li> <li>file（即本地包），file协议的必须要执行 <code>loadFileURL:allowingReadAccessToURL:</code> 才能正常加载。这里需要注意，如果WK正常展示过程中调用 <code>reload</code>是可以正常刷新的。但是在 <code>webViewWebContentProcessDidTerminate:</code> 函数中调用<code>reload</code>会报错，即被Terminated后，必须调用  <code>loadFileURL:allowingReadAccessToURL:</code> 重新加载</li></ol> <h4 id="web页面被kill时的两种情况"><a href="#web页面被kill时的两种情况" class="header-anchor">#</a> Web页面被Kill时的两种情况</h4> <h5 id="web页面正在展示"><a href="#web页面正在展示" class="header-anchor">#</a> Web页面正在展示</h5> <p>这种情况，直接<code>reload</code>（file协议需要调用<code>loadFileURL:allowingReadAccessToURL:</code>，后面类似情况都需要做区分，不再赘述）</p> <h5 id="web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中"><a href="#web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中" class="header-anchor">#</a> Web页面非当前展示页面，退到后台或在导航栈中非当前展示的VC中</h5> <p>这种情况不建议直接刷新页面，系统Kill是为了减少内存，如果直接刷新，经过测试系统还会继续Kill。所以直接刷新意义不大，只会造成频繁的Kill和刷新，消耗性能。</p> <p>另外，在我们工程中，是混合Bridge模式，比如 <code>A混合页面 -&gt; B混合页面 -&gt; C混合页面</code> ，A需要隐藏bar ,B C 需要展示bar ,此时如果A被杀死 然后直接reload，A中的Bridge会造成bar 被隐藏，BC页面的显示就会有问题。</p> <p>因此这种情况需要监听 <strong>前后台状态和viewWillAppear/Disappear</strong> ，在 <code>webViewWebContentProcessDidTerminate:</code>  中记录当前URL，当页面重新展示时（从后台到前台或触发viewWillAppear）再重新刷新页面。<strong>不过需要注意，这种情况下会有个短暂的loading或白屏。</strong></p> <h3 id="estimatedprogress问题"><a href="#estimatedprogress问题" class="header-anchor">#</a> estimatedProgress问题</h3> <p>estimatedProgress 是WK推出用于监听页面加载进度的。**需要注意的是，estimatedProgress 并不是从<code>loadRequst</code>开始，也不一定是从 <code>decidePolicyForNavigationAction:</code>或 <code>didStartProvisionalNavigation</code>开始。**即中间会有一段白屏期，这块需要注意下，不过目前测试下来，这个时间目前还可以接受，暂时没有处理。</p> <p>具体可参考 <a href="https://mp.weixin.qq.com/s/XNv_3yyk-vH1xOMtPZ4K-A" target="_blank" rel="noopener noreferrer">WKWebview 加载过程中的性能指标图解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="默认的跳转行为-打开-ituns、tel、mail、等其他scheme"><a href="#默认的跳转行为-打开-ituns、tel、mail、等其他scheme" class="header-anchor">#</a> 默认的跳转行为，打开 iTuns、tel、mail、等其他scheme</h3> <p>WK上打开 mailto、tel、facetime、sms和其他scheme时，默认会忽略这些链接，不会有任何反应，这块需要单独处理。在 <code>decidePolicyForNavigationAction:</code>中判断scheme，然后调用<code>openURL:</code>函数打开。</p> <div class="language- extra-class"><pre class="language-text"><code>
//参考代码
- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler{
    
    NSURL *tmpURL = navigationAction.request.URL;
    NSArray *schemes = @[@&quot;http&quot;,@&quot;https&quot;,@&quot;file&quot;,@&quot;about&quot;];        //注意这类需要加about，部分空连接 scheme 是 about
    if (![schemes containsObject:tmpURL.scheme]) {
        if (@available(iOS 10.0,*)) {
            [[UIApplication sharedApplication] openURL:tmpURL
                                               options:@{}
                                     completionHandler:nil];
        }else{
            [[UIApplication sharedApplication] openURL:tmpURL];
        }
        decisionHandler(WKNavigationActionPolicyCancel);
        return;
    }
}
</code></pre></div><h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <p><a href="https://developer.apple.com/documentation/webkit?language=objc" target="_blank" rel="noopener noreferrer">WebKit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://support.apple.com/zh-cn/guide/safari-developer/welcome/mac" target="_blank" rel="noopener noreferrer">Safari Developer Help<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>   Safari调试工具</p> <p><a href="https://developer.apple.com/documentation/webkit/wkwebview?language=objc" target="_blank" rel="noopener noreferrer">WKWebView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/7bb5f15f1daa" target="_blank" rel="noopener noreferrer">WKWebView学习笔记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/4fa8c4eb1316" target="_blank" rel="noopener noreferrer">IOS进阶之WKWebView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://ongfei.github.io/2016/05/14/WKWebview%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener noreferrer">WKWebview的使用及遇到的问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s/0OR4HJQSDq7nEFUAaX1x5A" target="_blank" rel="noopener noreferrer">移动端本地 H5 秒开方案探索与实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://tech.meituan.com/2017/06/09/webviewperf.html" target="_blank" rel="noopener noreferrer">WebView性能、体验分析与优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.moecoder.com/2016/10/26/support-nsurlprotocol-in-wkwebview/" target="_blank" rel="noopener noreferrer">让 WKWebView 支持 NSURLProtocol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://nshipster.cn/wkwebkit/" target="_blank" rel="noopener noreferrer">wkwebkit-nshipster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://xiaozhuanlan.com/topic/5743162890" target="_blank" rel="noopener noreferrer">WKWebView 你爬出来了吗？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.geniusqyu.com/2018/12/02/WKWebView-cookie-%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener noreferrer">WKWebView Cookie 问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/ChenYilong/iOSBlog/issues/14" target="_blank" rel="noopener noreferrer">iOS 防 DNS 污染方案调研（四）--- Cookie 业务场景<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/entry/5975916e518825594d23d777" target="_blank" rel="noopener noreferrer">教你使用 WKWebView 的正确姿势<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">WKWebView 那些坑    Bugly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/ac45d99cf912" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（上）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/870dba42ec15" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（中）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/52668d5b2e68" target="_blank" rel="noopener noreferrer">iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（下）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5NzMwODI0MA==&amp;mid=2647764511&amp;idx=1&amp;sn=eb792ed468a13239926641c9dd7091e2&amp;chksm=8887d520bff05c36484ed8a9a0731014c93a94ac0d7d9f944c9470cad48d1f21ec0dccc552a7&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1567467597976&amp;sharer_shareid=c38ca2f3cbd21853ce550074313749fc%23rd" target="_blank" rel="noopener noreferrer">一站式解决WKWebView各类问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.yincode.com/2018/03/23/WKWebView%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98%E9%9B%86%E5%90%88/" target="_blank" rel="noopener noreferrer">WKWebView 的接口中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/14/2020, 8:17:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/iOS/OC/WWDC19/WWDC19.html" class="prev">
          WWDC19 概要
        </a></span> <span class="next"><a href="/iOS/OC/Thread/多用派发队列少用同步锁.html">
          多用派发队列 少用同步锁
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-3b069fde data-v-349e681a><li class="level-2" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wk类分析" class="sidebar-link reco-side-wk类分析" data-v-3b069fde>WK类分析</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkwebviewconfiguration" class="sidebar-link reco-side-wkwebviewconfiguration" data-v-3b069fde>WKWebViewConfiguration</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wknavigationaction" class="sidebar-link reco-side-wknavigationaction" data-v-3b069fde>WKNavigationAction</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkuidelegate" class="sidebar-link reco-side-wkuidelegate" data-v-3b069fde>WKUIDelegate</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wknavigationdelegate" class="sidebar-link reco-side-wknavigationdelegate" data-v-3b069fde>WKNavigationDelegate</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkbackforwardlist" class="sidebar-link reco-side-wkbackforwardlist" data-v-3b069fde>WKBackForwardList</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkprocesspool" class="sidebar-link reco-side-wkprocesspool" data-v-3b069fde>WKProcessPool</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#部分重要方法" class="sidebar-link reco-side-部分重要方法" data-v-3b069fde>部分重要方法</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#类结构图" class="sidebar-link reco-side-类结构图" data-v-3b069fde>类结构图</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#工程实践注意点" class="sidebar-link reco-side-工程实践注意点" data-v-3b069fde>工程实践注意点</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkscriptmessagehandler协议" class="sidebar-link reco-side-wkscriptmessagehandler协议" data-v-3b069fde>WKScriptMessageHandler协议</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#blank情况" class="sidebar-link reco-side-blank情况" data-v-3b069fde>_blank情况</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wk-在alert-无法弹出时会出现-crash" class="sidebar-link reco-side-wk-在alert-无法弹出时会出现-crash" data-v-3b069fde>WK 在alert 无法弹出时会出现 Crash</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wkuidelegate-2" class="sidebar-link reco-side-wkuidelegate-2" data-v-3b069fde>WKUIDelegate</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#wknavigationdelegate-2" class="sidebar-link reco-side-wknavigationdelegate-2" data-v-3b069fde>WKNavigationDelegate</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#useragent" class="sidebar-link reco-side-useragent" data-v-3b069fde>UserAgent</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#本地离线包加载" class="sidebar-link reco-side-本地离线包加载" data-v-3b069fde>本地离线包加载</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#cookie问题" class="sidebar-link reco-side-cookie问题" data-v-3b069fde>Cookie问题</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#白屏问题" class="sidebar-link reco-side-白屏问题" data-v-3b069fde>白屏问题</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#estimatedprogress问题" class="sidebar-link reco-side-estimatedprogress问题" data-v-3b069fde>estimatedProgress问题</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#默认的跳转行为-打开-ituns、tel、mail、等其他scheme" class="sidebar-link reco-side-默认的跳转行为-打开-ituns、tel、mail、等其他scheme" data-v-3b069fde>默认的跳转行为，打开 iTuns、tel、mail、等其他scheme</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/WK/WK_summary.html#附录" class="sidebar-link reco-side-附录" data-v-3b069fde>附录</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/assets/js/app.3efcfa1f.js" defer></script><script src="/assets/js/3.d41f5393.js" defer></script><script src="/assets/js/1.0d0e82e9.js" defer></script><script src="/assets/js/36.3d80fb49.js" defer></script>
  </body>
</html>
