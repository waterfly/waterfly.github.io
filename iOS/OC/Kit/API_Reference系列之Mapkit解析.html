<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API Reference 系列 之Mapkit解析 | WaterFly</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just Coding">
    
    <link rel="preload" href="/assets/css/0.styles.84748982.css" as="style"><link rel="preload" href="/assets/js/app.3efcfa1f.js" as="script"><link rel="preload" href="/assets/js/3.d41f5393.js" as="script"><link rel="preload" href="/assets/js/1.0d0e82e9.js" as="script"><link rel="preload" href="/assets/js/75.c4591a8d.js" as="script"><link rel="prefetch" href="/assets/js/10.6a591f7b.js"><link rel="prefetch" href="/assets/js/11.2da2c136.js"><link rel="prefetch" href="/assets/js/12.597e1e9e.js"><link rel="prefetch" href="/assets/js/13.bfe6e49a.js"><link rel="prefetch" href="/assets/js/14.d5101ebe.js"><link rel="prefetch" href="/assets/js/15.d075eb78.js"><link rel="prefetch" href="/assets/js/16.1de846ec.js"><link rel="prefetch" href="/assets/js/17.73e1206f.js"><link rel="prefetch" href="/assets/js/18.3563029d.js"><link rel="prefetch" href="/assets/js/19.018202b6.js"><link rel="prefetch" href="/assets/js/20.92e231d8.js"><link rel="prefetch" href="/assets/js/21.a26b4bf6.js"><link rel="prefetch" href="/assets/js/22.a240a942.js"><link rel="prefetch" href="/assets/js/23.5d73353d.js"><link rel="prefetch" href="/assets/js/24.1a101222.js"><link rel="prefetch" href="/assets/js/25.f7c05ac5.js"><link rel="prefetch" href="/assets/js/26.cf0f99d3.js"><link rel="prefetch" href="/assets/js/27.4412c990.js"><link rel="prefetch" href="/assets/js/28.a9e9a7e1.js"><link rel="prefetch" href="/assets/js/29.9b39ea41.js"><link rel="prefetch" href="/assets/js/30.19dafc01.js"><link rel="prefetch" href="/assets/js/31.9d2c45f0.js"><link rel="prefetch" href="/assets/js/32.f7aa758f.js"><link rel="prefetch" href="/assets/js/33.54518586.js"><link rel="prefetch" href="/assets/js/34.71ab4ffb.js"><link rel="prefetch" href="/assets/js/35.5442dc08.js"><link rel="prefetch" href="/assets/js/36.3d80fb49.js"><link rel="prefetch" href="/assets/js/37.d767afa3.js"><link rel="prefetch" href="/assets/js/38.15d6331f.js"><link rel="prefetch" href="/assets/js/39.a6c25426.js"><link rel="prefetch" href="/assets/js/4.d08f1479.js"><link rel="prefetch" href="/assets/js/40.87d678b9.js"><link rel="prefetch" href="/assets/js/41.edd890b5.js"><link rel="prefetch" href="/assets/js/42.d6677079.js"><link rel="prefetch" href="/assets/js/43.ff4d75ff.js"><link rel="prefetch" href="/assets/js/44.32c7a951.js"><link rel="prefetch" href="/assets/js/45.2c851721.js"><link rel="prefetch" href="/assets/js/46.9bbe5a11.js"><link rel="prefetch" href="/assets/js/47.0e2c36cc.js"><link rel="prefetch" href="/assets/js/48.09bc8442.js"><link rel="prefetch" href="/assets/js/49.52342b74.js"><link rel="prefetch" href="/assets/js/5.9634f48e.js"><link rel="prefetch" href="/assets/js/50.c9e3c4c5.js"><link rel="prefetch" href="/assets/js/51.28a51db9.js"><link rel="prefetch" href="/assets/js/52.58832236.js"><link rel="prefetch" href="/assets/js/53.86af7b76.js"><link rel="prefetch" href="/assets/js/54.973c15bf.js"><link rel="prefetch" href="/assets/js/55.d4a03e12.js"><link rel="prefetch" href="/assets/js/56.ac7e97e0.js"><link rel="prefetch" href="/assets/js/57.7fa14d11.js"><link rel="prefetch" href="/assets/js/58.b0f390b8.js"><link rel="prefetch" href="/assets/js/59.62b96874.js"><link rel="prefetch" href="/assets/js/6.4c543392.js"><link rel="prefetch" href="/assets/js/60.0c40514a.js"><link rel="prefetch" href="/assets/js/61.65259e68.js"><link rel="prefetch" href="/assets/js/62.9fb64114.js"><link rel="prefetch" href="/assets/js/63.3975ffd5.js"><link rel="prefetch" href="/assets/js/64.911d2812.js"><link rel="prefetch" href="/assets/js/65.ce9ab40b.js"><link rel="prefetch" href="/assets/js/66.b89de3df.js"><link rel="prefetch" href="/assets/js/67.4169b86c.js"><link rel="prefetch" href="/assets/js/68.a812ad4b.js"><link rel="prefetch" href="/assets/js/69.b0c76c03.js"><link rel="prefetch" href="/assets/js/7.2aba56aa.js"><link rel="prefetch" href="/assets/js/70.9749f302.js"><link rel="prefetch" href="/assets/js/71.0d38010b.js"><link rel="prefetch" href="/assets/js/72.a6338004.js"><link rel="prefetch" href="/assets/js/73.c1001eb8.js"><link rel="prefetch" href="/assets/js/74.0069037e.js"><link rel="prefetch" href="/assets/js/76.e1a3f216.js"><link rel="prefetch" href="/assets/js/77.df0b0aac.js"><link rel="prefetch" href="/assets/js/78.2f535a98.js"><link rel="prefetch" href="/assets/js/79.60e4b9f5.js"><link rel="prefetch" href="/assets/js/8.c5d718a6.js"><link rel="prefetch" href="/assets/js/80.50af71ac.js"><link rel="prefetch" href="/assets/js/81.7d753c90.js"><link rel="prefetch" href="/assets/js/82.5703b0fa.js"><link rel="prefetch" href="/assets/js/83.4af8ebaa.js"><link rel="prefetch" href="/assets/js/84.ed963d52.js"><link rel="prefetch" href="/assets/js/85.7cb175ff.js"><link rel="prefetch" href="/assets/js/86.bd0d1f92.js"><link rel="prefetch" href="/assets/js/87.f00e8426.js"><link rel="prefetch" href="/assets/js/88.a34c0493.js"><link rel="prefetch" href="/assets/js/89.564cb64c.js"><link rel="prefetch" href="/assets/js/9.25143fa3.js"><link rel="prefetch" href="/assets/js/90.ce031d67.js"><link rel="prefetch" href="/assets/js/91.2a75f163.js"><link rel="prefetch" href="/assets/js/92.a2591da3.js"><link rel="prefetch" href="/assets/js/93.6af4f4b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84748982.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-349e681a><div data-v-349e681a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-b3e6ef50 data-v-349e681a data-v-349e681a><h3 class="title" data-v-b3e6ef50>WaterFly</h3> <p class="description" data-v-b3e6ef50>Just Coding</p> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-349e681a><header class="navbar" data-v-349e681a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WaterFly</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-349e681a></div> <aside class="sidebar" data-v-349e681a><div class="personal-info-wrapper" data-v-1bfe3fa5 data-v-349e681a><img src="/bike.png" alt="author-avatar" class="personal-img" data-v-1bfe3fa5> <!----> <div class="num" data-v-1bfe3fa5><div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>83</h3> <h6 data-v-1bfe3fa5>Articles</h6></div> <div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>34</h3> <h6 data-v-1bfe3fa5>Tags</h6></div></div> <ul class="social-links" data-v-1bfe3fa5></ul> <hr data-v-1bfe3fa5></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/iOS/OC/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html" class="sidebar-link">JavaSrciptCore学习</a></li><li><a href="/iOS/OC/WWDC19/WWDC19.html" class="sidebar-link">WWDC19 概要</a></li><li><a href="/iOS/OC/WK/WK_summary.html" class="sidebar-link">WK实践总结</a></li><li><a href="/iOS/OC/Thread/多用派发队列少用同步锁.html" class="sidebar-link">多用派发队列 少用同步锁</a></li><li><a href="/iOS/OC/Runtime/关联对象实现week.html" class="sidebar-link">关联对象实现week</a></li><li><a href="/iOS/OC/Component/京东组件化方案解析/京东组件化方案解析.html" class="sidebar-link">京东组件化方案解析</a></li><li><a href="/iOS/OC/Component/iOS组件化开源库阅读/iOS组件化开源库阅读.html" class="sidebar-link">iOS组件化开源库阅读</a></li><li><a href="/iOS/OC/Thread/App延长后台时间和backgroundFetch.html" class="sidebar-link">App 延长后台时间 和 background fetch</a></li><li><a href="/iOS/OC/Thread/iOS_IPC_线程通信.html" class="sidebar-link">iOS IPC 线程通信</a></li><li><a href="/iOS/OC/Thread/iOS锁总结/iOS锁总结.html" class="sidebar-link">iOS锁总结</a></li><li><a href="/iOS/OC/Kit/API_Reference系列之Mapkit解析.html" class="active sidebar-link">API Reference 系列 之Mapkit解析</a></li><li><a href="/iOS/OC/Other/导航栏TitleView不显示的问题.html" class="sidebar-link">导航栏TitleView在iOS11上不显示</a></li><li><a href="/iOS/OC/Other/Xcode_GPX文件Mock真机系统定位.html" class="sidebar-link">Xcode GPX文件Mock真机系统定位</a></li><li><a href="/iOS/OC/Other/《禅与Objective-C编程艺术》阅读笔记.html" class="sidebar-link">《禅与 Objective-C 编程艺术 》阅读笔记</a></li><li><a href="/iOS/OC/Other/UniversalLink.html" class="sidebar-link">Universal Link接入方案</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-b3e6ef50 data-v-349e681a><h3 class="title" data-v-b3e6ef50>API Reference 系列 之Mapkit解析</h3> <!----> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-349e681a><div data-v-349e681a><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">API Reference 系列 之Mapkit解析</h1> <div data-v-0b291498><!----> <i class="iconfont reco-date" data-v-0b291498><span data-v-0b291498>7/25/2016</span></i> <!----> <i class="tags iconfont reco-tag" data-v-0b291498><span class="tag-item" data-v-0b291498>MapKit</span></i></div></div> <div class="theme-reco-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#前言">前言</a></li><li><a href="#概要">概要</a></li><li><a href="#详解">详解</a><ul><li><a href="#mapkit是什么">Mapkit是什么</a></li><li><a href="#mapkit解决了什么问题">Mapkit解决了什么问题</a></li><li><a href="#mapkit是怎么解决这些问题的">Mapkit是怎么解决这些问题的</a><ul><li><a href="#定位">定位</a></li><li><a href="#地图展示">地图展示</a></li><li><a href="#标注-annotation">标注 Annotation</a></li><li><a href="#覆盖物-overlay">覆盖物 Overlay</a></li><li><a href="#geocoding-and-reverse-geocoding">Geocoding and reverse-geocoding</a></li><li><a href="#region-monitoring-and-ibeacon">Region Monitoring And iBeacon</a></li><li><a href="#heading">Heading</a></li><li><a href="#direction">Direction</a></li><li><a href="#地理信息查询">地理信息查询</a></li></ul></li></ul></li><li><a href="#后记">后记</a></li><li><a href="#附录">附录</a><ul><li><a href="#第一原理">第一原理</a></li><li><a href="#火星坐标">火星坐标</a></li></ul></li><li><a href="#参考资料">参考资料</a></li></ul></div><p></p> <p>[TOC]</p> <h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <p>最近要开发一个地图相关的工具，于是去苹果开发者官网查阅了资料。发现网站更新了API Reference 的文档结构，聚合了Framework的Guide和所有类，变得很清晰阅读。</p> <p>虽然官网的Guide解释的已经比较清楚，但是不够直观。于是结合官网资料，对Mapkit做了一些思维导图，并做了一些注解。</p> <p>本文章适合有OC基础，但对Mapkit不了解的同学。另外，本文章只大概说明Mapkit的作用和相关类，不做具体API说明。</p> <h1 id="概要"><a href="#概要" class="header-anchor">#</a> 概要</h1> <p>马斯克在一次访谈中，谈到他眼中的第一原理，简单来说就是从本质一层层往上走。</p> <p>所以我们认识和学习一个事物，我觉得要从四个角度去考虑：</p> <ul><li>这个事务是什么</li> <li>这个事务解决了什么问题</li> <li>具体是怎么解决的</li> <li>解决的详细步骤是什么</li></ul> <p>本文章中主要针对Mapkit讨论了前三个问题，第四个问题则需要使用Mapkit的同学结合官网和其他网站上的Demo，去自己实践。即本文将要讨论的三个问题：</p> <ul><li>Mapkit是什么</li> <li>Mapkit解决了什么问题</li> <li>Mapkit是怎么解决这些问题的</li></ul> <h1 id="详解"><a href="#详解" class="header-anchor">#</a> 详解</h1> <h2 id="mapkit是什么"><a href="#mapkit是什么" class="header-anchor">#</a> Mapkit是什么</h2> <p>我们先看下官网的简要解释：</p> <blockquote><p>Location-based information consists of two pieces: location services and maps. Location services are provided by the Core Location framework, which defines Objective-C interfaces for obtaining information about the user’s location and heading (the direction in which a device is pointing). Maps are provided by the Map Kit framework, which supports both the display and annotation of maps similar to those found in the Maps app. (To use the features of the Map Kit framework, you must turn on the Maps capability in your Xcode project.) Location services and maps are available on both iOS and OS X.</p></blockquote> <p>简单来说就是 Location framework 提供了定位和设备方向服务，MapKit提供了地图的标注和地图展示服务。</p> <h2 id="mapkit解决了什么问题"><a href="#mapkit解决了什么问题" class="header-anchor">#</a> Mapkit解决了什么问题</h2> <p>通过Mapkit，我们可以获取<strong>当前定位、地图展示、标注、覆盖物、地理编码和反地理编码、位置检测、设备方向判断、获取路线信息、地理位置查询</strong>等地图相关的操作。</p> <h2 id="mapkit是怎么解决这些问题的"><a href="#mapkit是怎么解决这些问题的" class="header-anchor">#</a> Mapkit是怎么解决这些问题的</h2> <p>Mapkit有很多类，针对以上的功能，画了一个思维导图，方便梳理。
<img src="http://upload-images.jianshu.io/upload_images/209493-23bd3be77d08d583.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="地图相关概念"></p> <h3 id="定位"><a href="#定位" class="header-anchor">#</a> 定位</h3> <p>iOS中获取用户当前坐标的方式有两种：</p> <ul><li>通过<code>Core Loation Framework</code>的<code>CLLocationManager</code></li> <li>通过Mapkit的<code>MKMapView</code>中<code>userLocation</code>获取(需要设置<code>showsUserLocation</code>)</li></ul> <p>从iOS8 开始，以上两种方式获取当前坐标时，都需要手动调用请求授权API：</p> <ul><li>配置plist中的授权提示文案，key为 <code>NSLocationWhenInUseUsageDescription</code> （前台） 或 <code>NSLocationAlwaysUsageDescription</code>（前台，后台）</li> <li>手动调用<code>CLLocationManager</code>的<code>requestWhenInUseAuthorization</code>或<code>requestAlwaysAuthorization</code>，进行定位授权</li></ul> <p>通过<code>CLLocationManager</code>进行定位的基本步骤：</p> <ul><li>配置 <code>CLLocationManager</code></li> <li>调用 <code>requestWhenInUseAuthorization</code> 或 <code>requestAlwaysAuthorization</code></li> <li>实现<code>CLLocationManagerDelegate</code></li></ul> <p>通过Mapkit中获取展示当前定位点的基本步骤：</p> <ul><li>创建<code>MKMapView</code></li> <li>设定<code>showsUserLocation=YES</code></li> <li>实现 <code>MKMapViewDelegate</code>的<code>mapView:didUpdateUserLocation:</code></li></ul> <p>注：</p> <ol><li><code>CLLocationManager</code>获得的坐标类型是<strong>WGS84</strong>坐标（即真实的地理坐标），MKMapView获得的坐标类型为<strong>GCJ02</strong>（即国测局经纬度坐标,高德用该坐标系）</li> <li>从iOS8以后，<code>MKMapView</code>只有展示后上才会启动定位，单独alloc一个<code>MKMapView</code>，并不会启动定位。</li> <li>相关的类：<code>CLLocationManager</code>，<code>MKMapView</code></li></ol> <h3 id="地图展示"><a href="#地图展示" class="header-anchor">#</a> 地图展示</h3> <p>展示地图是通过<code>MKMapView</code>类，初始化<code>MKMapView</code>，即可展示普通地图或卫星地图。这里不细说<code>MKMapView</code>类，相关的资料很多，主要提几个点。</p> <p>这里有三种坐标系</p> <ul><li>地球的经纬度坐标。通过结构<code>CLLocationCoordinate2D</code>表示</li> <li>墨卡托坐标。即地图上的点，通过<code>MKMapPoint</code>表示</li> <li>view上的坐标。即iOS的view坐标系，通过<code>CGPoint</code>表示</li></ul> <p>三种坐标系的相关类见下面的思维导图：
<img src="http://upload-images.jianshu.io/upload_images/209493-e572c35a3acc5767.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="三种坐标系"></p> <p>有些情况，不需要展示一个完整的<code>MKMapView</code>，只需要展示<strong>a map image</strong>即可。则可以通过<code>MKMapSnapshotter</code>异步生成一个 <strong>static map image</strong>。</p> <ul><li>配置<code>MKMapSnapshotOptions</code></li> <li>初始化<code>MKMapSnapshotter</code></li> <li>调用<code>startWithCompletionHandler:</code>异步获得地图图片</li></ul> <h3 id="标注-annotation"><a href="#标注-annotation" class="header-anchor">#</a> 标注 Annotation</h3> <p><strong>Annotation</strong>，就是地图上的常见的大头针等标注。<strong>Annotation</strong>的设计遵循数据与View分离的原则，数据为符合<code>MKAnnotation</code>协议的类，View为<code>MKAnnotationView</code>的子类，添加的基本步骤如下：</p> <ul><li>定义一个 <code>MKPointAnnotation</code> 对象，添加数据</li> <li>使用 <code>MKMapView</code> 的 <code>addAnnotation:</code> 方法添加到地图</li> <li>实现 <code>mapView:viewForAnnotation:</code> 代理方法</li> <li>在代理内定义 <code>MKPinAnnotationView</code> 对象</li></ul> <p>通过上面几个步骤，即可显示标准的大头针。如果要显示自定义标注，把<code>MKPointAnnotation</code>对象替换为自定义<code>MKAnnotation</code>，把<code>MKPinAnnotationView</code>替换为自定义的<code>MKAnnotationView</code>即可。</p> <p>另外，在这块还有一个点是<strong>Callout</strong>，即自定义气泡，如下图是一个标准的<strong>Callout</strong>展示。通过<code>MKAnnotationView</code>的<code>canShowCallout</code>、<code>rightCalloutAccessoryView</code>、<code>leftCalloutAccessoryView</code>三个属性控制。
<img src="http://upload-images.jianshu.io/upload_images/209493-cc3b25bbe789e2f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Callout"></p> <h3 id="覆盖物-overlay"><a href="#覆盖物-overlay" class="header-anchor">#</a> 覆盖物 Overlay</h3> <p>简单来说，覆盖物就是在地图上画的线，圆，矩形等等。覆盖物的设计也遵循数据与View分离的原则。一个Overlay对象对应一个OverlayRenderer对象。</p> <ul><li>Overlay 对象，通过实现 <code>MKOverlay</code> 协议，定义数据。现有的Overlay对象有：<code>MKPolyline</code> 、 <code>MKPolygon</code>、 <code>MKCircle</code>以及 <code>MATileOverlay</code>。</li> <li>Overlay 渲染器，通过继承 <code>MKOverlayRenderer</code>，用于在地图显示 Overlay。以上Overlay对应的渲染器对象有：<code>MKPolylineRenderer</code>、<code>MKPolygonRenderer</code>、<code>MKCircleRenderer</code>以及 <code>MKTileOverlayRenderer</code>。</li></ul> <p>更加复杂的自定义可以详见<a href="https://developer.apple.com/library/prerelease/content/documentation/UserExperience/Conceptual/LocationAwarenessPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009497" target="_blank" rel="noopener noreferrer">Location and Maps Programming Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的解释。</p> <h3 id="geocoding-and-reverse-geocoding"><a href="#geocoding-and-reverse-geocoding" class="header-anchor">#</a> Geocoding and reverse-geocoding</h3> <p>geocoding，地理编码，即通过地理位置信息转化为坐标点。reverse-geocoding,反地理编码，即通过坐标点转化为地理位置信息。主要通过<code>CLGeocoder</code>实现。</p> <h3 id="region-monitoring-and-ibeacon"><a href="#region-monitoring-and-ibeacon" class="header-anchor">#</a> Region Monitoring And iBeacon</h3> <p>区域检测用于监测固定区域内的定位变化，在iOS上有两种方式，第一种是通过<code>CLLocationManager</code>监控指定区域（<strong>circular Region</strong>），另一种是通过蓝牙区域检测（<strong>Beacon Region</strong>）。其中蓝牙参见<code>Core Bluetooth framework</code></p> <h3 id="heading"><a href="#heading" class="header-anchor">#</a> Heading</h3> <p>通过<code>CLLocationManager</code>可以获取当前设备的方向。</p> <h3 id="direction"><a href="#direction" class="header-anchor">#</a> Direction</h3> <p>Mapkit可以通过<code>MKDirections</code>获取指定的路线信息</p> <h3 id="地理信息查询"><a href="#地理信息查询" class="header-anchor">#</a> 地理信息查询</h3> <p>Mapkit支持用户查询地理位置信息，主要步骤为：</p> <ul><li>初始化<code>MKLocalSearchRequest</code>，配置查询参数</li> <li>初始化<code>MKLocalSearch</code></li> <li>调用<code>startWithCompletionHandler:</code>获取查询结果</li></ul> <h1 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h1> <p>本篇文章主要梳理了地图功能，并未详细分析API的使用，只作为地图框架参考，具体使用请查询相关API资料，并结合Demo进行练习。</p> <h1 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h1> <h2 id="第一原理"><a href="#第一原理" class="header-anchor">#</a> 第一原理</h2> <p>马斯克在访谈中表述他眼中的第一原理：</p> <blockquote><p>**我们运用「第一原理思维」而不是「比较思维」去思考问题是非常重要的。**我们在生活中总是倾向于比较——别人已经做过了或者正在做这件事情，我们就也去做。这样的结果是只能产生细小的迭代发展。「第一原理」的思考方式是用物理学的角度看待世界的方法，**也就是说一层层剥开事物的表象，看到里面的本质，然后再从本质一层层往上走。**这要消耗大量的脑力。</p></blockquote> <p>更多解释参见<a href="http://www.geekpark.net/topics/212316" target="_blank" rel="noopener noreferrer">马斯克的「第一原理」到底是什么？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="火星坐标"><a href="#火星坐标" class="header-anchor">#</a> 火星坐标</h2> <p>简单来说就是对GPS坐标进行偏移后得到的坐标，就是所谓的火星坐标。国测局要求国内地图上的坐标都要经过偏移，即国内地图上的坐标都是火星坐标。下面是几种国内的经纬度。</p> <ul><li><strong>wgs84</strong>，GPS经纬度</li> <li><strong>gcj02</strong>，国测局经纬度偏移坐标，高德用该坐标系</li> <li><strong>bd09</strong>，百度经纬度坐标，百度在<strong>gcj02</strong>的基础上再次进行了偏移</li></ul> <p>这里需要注意的是<code>CLLocationManager</code>进行定位获得坐标是GPS坐标。</p> <h1 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h1> <ul><li><a href="https://developer.apple.com/reference/mapkit" target="_blank" rel="noopener noreferrer">MapKit API Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.apple.com/library/prerelease/content/documentation/UserExperience/Conceptual/LocationAwarenessPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009497" target="_blank" rel="noopener noreferrer">Location and Maps Programming Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://lbs.amap.com/api/ios-sdk/guide/mapkit/#t1" target="_blank" rel="noopener noreferrer">高度地图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://lbsyun.baidu.com/index.php?title=iossdk/guide/basicmap#.E7.93.A6.E7.89.87.E5.9B.BE.E5.B1.82" target="_blank" rel="noopener noreferrer">百度地图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://nevan.net/2014/09/core-location-manager-changes-in-ios-8/" target="_blank" rel="noopener noreferrer">Core Location Manager Changes in iOS 8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.jianshu.com/p/990e0d86125e" target="_blank" rel="noopener noreferrer">Core Location 最佳实践 (WWDC 2016 - session716)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/14/2020, 8:17:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/iOS/OC/Thread/iOS锁总结/iOS锁总结.html" class="prev">
          iOS锁总结
        </a></span> <span class="next"><a href="/iOS/OC/Other/导航栏TitleView不显示的问题.html">
          导航栏TitleView在iOS11上不显示
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-3b069fde data-v-349e681a><li class="level-2" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#mapkit是什么" class="sidebar-link reco-side-mapkit是什么" data-v-3b069fde>Mapkit是什么</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#mapkit解决了什么问题" class="sidebar-link reco-side-mapkit解决了什么问题" data-v-3b069fde>Mapkit解决了什么问题</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#mapkit是怎么解决这些问题的" class="sidebar-link reco-side-mapkit是怎么解决这些问题的" data-v-3b069fde>Mapkit是怎么解决这些问题的</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#定位" class="sidebar-link reco-side-定位" data-v-3b069fde>定位</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#地图展示" class="sidebar-link reco-side-地图展示" data-v-3b069fde>地图展示</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#标注-annotation" class="sidebar-link reco-side-标注-annotation" data-v-3b069fde>标注 Annotation</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#覆盖物-overlay" class="sidebar-link reco-side-覆盖物-overlay" data-v-3b069fde>覆盖物 Overlay</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#geocoding-and-reverse-geocoding" class="sidebar-link reco-side-geocoding-and-reverse-geocoding" data-v-3b069fde>Geocoding and reverse-geocoding</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#region-monitoring-and-ibeacon" class="sidebar-link reco-side-region-monitoring-and-ibeacon" data-v-3b069fde>Region Monitoring And iBeacon</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#heading" class="sidebar-link reco-side-heading" data-v-3b069fde>Heading</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#direction" class="sidebar-link reco-side-direction" data-v-3b069fde>Direction</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#地理信息查询" class="sidebar-link reco-side-地理信息查询" data-v-3b069fde>地理信息查询</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#第一原理" class="sidebar-link reco-side-第一原理" data-v-3b069fde>第一原理</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/Kit/API_Reference%E7%B3%BB%E5%88%97%E4%B9%8BMapkit%E8%A7%A3%E6%9E%90.html#火星坐标" class="sidebar-link reco-side-火星坐标" data-v-3b069fde>火星坐标</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/assets/js/app.3efcfa1f.js" defer></script><script src="/assets/js/3.d41f5393.js" defer></script><script src="/assets/js/1.0d0e82e9.js" defer></script><script src="/assets/js/75.c4591a8d.js" defer></script>
  </body>
</html>
