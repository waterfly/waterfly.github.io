<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaSrciptCore学习 | WaterFly</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just Coding">
    
    <link rel="preload" href="/assets/css/0.styles.84748982.css" as="style"><link rel="preload" href="/assets/js/app.3efcfa1f.js" as="script"><link rel="preload" href="/assets/js/3.d41f5393.js" as="script"><link rel="preload" href="/assets/js/1.0d0e82e9.js" as="script"><link rel="preload" href="/assets/js/9.25143fa3.js" as="script"><link rel="prefetch" href="/assets/js/10.6a591f7b.js"><link rel="prefetch" href="/assets/js/11.2da2c136.js"><link rel="prefetch" href="/assets/js/12.597e1e9e.js"><link rel="prefetch" href="/assets/js/13.bfe6e49a.js"><link rel="prefetch" href="/assets/js/14.d5101ebe.js"><link rel="prefetch" href="/assets/js/15.d075eb78.js"><link rel="prefetch" href="/assets/js/16.1de846ec.js"><link rel="prefetch" href="/assets/js/17.73e1206f.js"><link rel="prefetch" href="/assets/js/18.3563029d.js"><link rel="prefetch" href="/assets/js/19.018202b6.js"><link rel="prefetch" href="/assets/js/20.92e231d8.js"><link rel="prefetch" href="/assets/js/21.a26b4bf6.js"><link rel="prefetch" href="/assets/js/22.a240a942.js"><link rel="prefetch" href="/assets/js/23.5d73353d.js"><link rel="prefetch" href="/assets/js/24.1a101222.js"><link rel="prefetch" href="/assets/js/25.f7c05ac5.js"><link rel="prefetch" href="/assets/js/26.cf0f99d3.js"><link rel="prefetch" href="/assets/js/27.4412c990.js"><link rel="prefetch" href="/assets/js/28.a9e9a7e1.js"><link rel="prefetch" href="/assets/js/29.9b39ea41.js"><link rel="prefetch" href="/assets/js/30.19dafc01.js"><link rel="prefetch" href="/assets/js/31.9d2c45f0.js"><link rel="prefetch" href="/assets/js/32.f7aa758f.js"><link rel="prefetch" href="/assets/js/33.54518586.js"><link rel="prefetch" href="/assets/js/34.71ab4ffb.js"><link rel="prefetch" href="/assets/js/35.5442dc08.js"><link rel="prefetch" href="/assets/js/36.3d80fb49.js"><link rel="prefetch" href="/assets/js/37.d767afa3.js"><link rel="prefetch" href="/assets/js/38.15d6331f.js"><link rel="prefetch" href="/assets/js/39.a6c25426.js"><link rel="prefetch" href="/assets/js/4.d08f1479.js"><link rel="prefetch" href="/assets/js/40.87d678b9.js"><link rel="prefetch" href="/assets/js/41.edd890b5.js"><link rel="prefetch" href="/assets/js/42.d6677079.js"><link rel="prefetch" href="/assets/js/43.ff4d75ff.js"><link rel="prefetch" href="/assets/js/44.32c7a951.js"><link rel="prefetch" href="/assets/js/45.2c851721.js"><link rel="prefetch" href="/assets/js/46.9bbe5a11.js"><link rel="prefetch" href="/assets/js/47.0e2c36cc.js"><link rel="prefetch" href="/assets/js/48.09bc8442.js"><link rel="prefetch" href="/assets/js/49.52342b74.js"><link rel="prefetch" href="/assets/js/5.9634f48e.js"><link rel="prefetch" href="/assets/js/50.c9e3c4c5.js"><link rel="prefetch" href="/assets/js/51.28a51db9.js"><link rel="prefetch" href="/assets/js/52.58832236.js"><link rel="prefetch" href="/assets/js/53.86af7b76.js"><link rel="prefetch" href="/assets/js/54.973c15bf.js"><link rel="prefetch" href="/assets/js/55.d4a03e12.js"><link rel="prefetch" href="/assets/js/56.ac7e97e0.js"><link rel="prefetch" href="/assets/js/57.7fa14d11.js"><link rel="prefetch" href="/assets/js/58.b0f390b8.js"><link rel="prefetch" href="/assets/js/59.62b96874.js"><link rel="prefetch" href="/assets/js/6.4c543392.js"><link rel="prefetch" href="/assets/js/60.0c40514a.js"><link rel="prefetch" href="/assets/js/61.65259e68.js"><link rel="prefetch" href="/assets/js/62.9fb64114.js"><link rel="prefetch" href="/assets/js/63.3975ffd5.js"><link rel="prefetch" href="/assets/js/64.911d2812.js"><link rel="prefetch" href="/assets/js/65.ce9ab40b.js"><link rel="prefetch" href="/assets/js/66.b89de3df.js"><link rel="prefetch" href="/assets/js/67.4169b86c.js"><link rel="prefetch" href="/assets/js/68.a812ad4b.js"><link rel="prefetch" href="/assets/js/69.b0c76c03.js"><link rel="prefetch" href="/assets/js/7.2aba56aa.js"><link rel="prefetch" href="/assets/js/70.9749f302.js"><link rel="prefetch" href="/assets/js/71.0d38010b.js"><link rel="prefetch" href="/assets/js/72.a6338004.js"><link rel="prefetch" href="/assets/js/73.c1001eb8.js"><link rel="prefetch" href="/assets/js/74.0069037e.js"><link rel="prefetch" href="/assets/js/75.c4591a8d.js"><link rel="prefetch" href="/assets/js/76.e1a3f216.js"><link rel="prefetch" href="/assets/js/77.df0b0aac.js"><link rel="prefetch" href="/assets/js/78.2f535a98.js"><link rel="prefetch" href="/assets/js/79.60e4b9f5.js"><link rel="prefetch" href="/assets/js/8.c5d718a6.js"><link rel="prefetch" href="/assets/js/80.50af71ac.js"><link rel="prefetch" href="/assets/js/81.7d753c90.js"><link rel="prefetch" href="/assets/js/82.5703b0fa.js"><link rel="prefetch" href="/assets/js/83.4af8ebaa.js"><link rel="prefetch" href="/assets/js/84.ed963d52.js"><link rel="prefetch" href="/assets/js/85.7cb175ff.js"><link rel="prefetch" href="/assets/js/86.bd0d1f92.js"><link rel="prefetch" href="/assets/js/87.f00e8426.js"><link rel="prefetch" href="/assets/js/88.a34c0493.js"><link rel="prefetch" href="/assets/js/89.564cb64c.js"><link rel="prefetch" href="/assets/js/90.ce031d67.js"><link rel="prefetch" href="/assets/js/91.2a75f163.js"><link rel="prefetch" href="/assets/js/92.a2591da3.js"><link rel="prefetch" href="/assets/js/93.6af4f4b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84748982.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-349e681a><div data-v-349e681a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-b3e6ef50 data-v-349e681a data-v-349e681a><h3 class="title" data-v-b3e6ef50>WaterFly</h3> <p class="description" data-v-b3e6ef50>Just Coding</p> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-349e681a><header class="navbar" data-v-349e681a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WaterFly</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-349e681a></div> <aside class="sidebar" data-v-349e681a><div class="personal-info-wrapper" data-v-1bfe3fa5 data-v-349e681a><img src="/bike.png" alt="author-avatar" class="personal-img" data-v-1bfe3fa5> <!----> <div class="num" data-v-1bfe3fa5><div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>83</h3> <h6 data-v-1bfe3fa5>Articles</h6></div> <div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>34</h3> <h6 data-v-1bfe3fa5>Tags</h6></div></div> <ul class="social-links" data-v-1bfe3fa5></ul> <hr data-v-1bfe3fa5></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link"><i class="undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      iOS
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/iOS/Swift/" class="nav-link"><i class="undefined"></i>
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/iOS/RN/" class="nav-link"><i class="undefined"></i>
  RN
</a></li><li class="dropdown-item"><!----> <a href="/iOS/OC/" class="nav-link router-link-active"><i class="undefined"></i>
  OC
</a></li></ul></div></div><div class="nav-item"><a href="/Other/" class="nav-link"><i class="undefined"></i>
  Other
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/waterfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/iOS/OC/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html" aria-current="page" class="active sidebar-link">JavaSrciptCore学习</a></li><li><a href="/iOS/OC/WWDC19/WWDC19.html" class="sidebar-link">WWDC19 概要</a></li><li><a href="/iOS/OC/WK/WK_summary.html" class="sidebar-link">WK实践总结</a></li><li><a href="/iOS/OC/Thread/多用派发队列少用同步锁.html" class="sidebar-link">多用派发队列 少用同步锁</a></li><li><a href="/iOS/OC/Runtime/关联对象实现week.html" class="sidebar-link">关联对象实现week</a></li><li><a href="/iOS/OC/Component/京东组件化方案解析/京东组件化方案解析.html" class="sidebar-link">京东组件化方案解析</a></li><li><a href="/iOS/OC/Component/iOS组件化开源库阅读/iOS组件化开源库阅读.html" class="sidebar-link">iOS组件化开源库阅读</a></li><li><a href="/iOS/OC/Thread/App延长后台时间和backgroundFetch.html" class="sidebar-link">App 延长后台时间 和 background fetch</a></li><li><a href="/iOS/OC/Thread/iOS_IPC_线程通信.html" class="sidebar-link">iOS IPC 线程通信</a></li><li><a href="/iOS/OC/Thread/iOS锁总结/iOS锁总结.html" class="sidebar-link">iOS锁总结</a></li><li><a href="/iOS/OC/Kit/API_Reference系列之Mapkit解析.html" class="sidebar-link">API Reference 系列 之Mapkit解析</a></li><li><a href="/iOS/OC/Other/导航栏TitleView不显示的问题.html" class="sidebar-link">导航栏TitleView在iOS11上不显示</a></li><li><a href="/iOS/OC/Other/Xcode_GPX文件Mock真机系统定位.html" class="sidebar-link">Xcode GPX文件Mock真机系统定位</a></li><li><a href="/iOS/OC/Other/《禅与Objective-C编程艺术》阅读笔记.html" class="sidebar-link">《禅与 Objective-C 编程艺术 》阅读笔记</a></li><li><a href="/iOS/OC/Other/UniversalLink.html" class="sidebar-link">Universal Link接入方案</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-b3e6ef50 data-v-349e681a><h3 class="title" data-v-b3e6ef50>JavaSrciptCore学习</h3> <!----> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-349e681a><div data-v-349e681a><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">JavaSrciptCore学习</h1> <div data-v-0b291498><!----> <i class="iconfont reco-date" data-v-0b291498><span data-v-0b291498>10/7/2019</span></i> <!----> <i class="tags iconfont reco-tag" data-v-0b291498><span class="tag-item" data-v-0b291498>iOS</span></i></div></div> <div class="theme-reco-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#javasrciptcore">JavaSrciptCore</a><ul><li><a href="#背景知识">背景知识</a><ul><li><a href="#webkit框架">WebKit框架</a></li><li><a href="#webkit的渲染流程">WebKit的渲染流程</a></li><li><a href="#js内存管理">JS内存管理</a></li></ul></li><li><a href="#类解析">类解析</a><ul><li><a href="#类基本介绍">类基本介绍</a></li><li><a href="#线程安全">线程安全</a></li><li><a href="#内存管理">内存管理</a></li><li><a href="#jscontext">JSContext</a></li><li><a href="#jsvalue">JSValue</a></li><li><a href="#jsmanagedvalue">JSManagedValue</a></li><li><a href="#jsexport">JSExport</a><ul><li><a href="#转换规则">转换规则</a></li><li><a href="#oc的方法名转成js的遵守以下规则">OC的方法名转成JS的遵守以下规则</a></li></ul></li></ul></li><li><a href="#其他">其他</a><ul><li><a href="#web获取jscontext">Web获取JSContext</a></li><li><a href="#jspatch">JSPatch</a></li></ul></li><li><a href="#参考资料">参考资料</a></li></ul></li></ul></div><p></p> <h1 id="javasrciptcore"><a href="#javasrciptcore" class="header-anchor">#</a> JavaSrciptCore</h1> <p>JavaScriptCore 是 JS引擎，用于解析JS，类似Chrome的 V8。</p> <h2 id="背景知识"><a href="#背景知识" class="header-anchor">#</a> 背景知识</h2> <h3 id="webkit框架"><a href="#webkit框架" class="header-anchor">#</a> WebKit框架</h3> <p><img src="/assets/img/Webkit.c4886ee0.jpg" alt=""></p> <h3 id="webkit的渲染流程"><a href="#webkit的渲染流程" class="header-anchor">#</a> WebKit的渲染流程</h3> <p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNEBCAgICAkICQoKCQ0ODA4NExEQEBETHBQWFBYUHCsbHxsbHxsrJi4lIyUuJkQ1Ly81RE5CPkJOX1VVX3dxd5yc0f/CABEIANoB9AMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAQQFAwYCB//aAAgBAQAAAAD9+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHKjIHzqAAAAAAAABSu5vP4zr/x076YAAAAAAAAUrvkc9an4vaumAAAAAAAAHKj9Hn/QHxpgAACQAAAAAjH2UAAAAkAAAAAI8/6FAAAAJAAAVuEgfNr6pfZka5y0wAABIAADLvZN2Oi4ZvS840uXbSjN04AAAJAABmvI62V8U/U4mTy9RqYHvmF5W95T9kjN0gAABIAAMrVzNKQPmh1sdBBmaYAAAkAAHKlo54Bos+ADQAAAJAAAzNMAAIFevoAAAJAABQ62gAAgK9fQAAAoQC13GaIzLur0AACBxqVMD1QWu+cA6XVDpafXPpn6Bn3+fVx7M/QAACBncddz64W7Gb2teX8xdzL9n2nDSUvzn7p2L3rvrtMeT97ieLqVffemoXwAAgZ3iKnfL9l38bp+t857v58vr09SjtZ2iyLIPjSKvD7g+fpfAACBm9FW2HK3Vnx+HpZG37irsJgAEjN0gAAIBmU9+YAAEwACRnaIAAEBn2LCYAAEwACeVS5VvAAAQM+xYJgAATAAJ5Zefq2rVbjIHzocqn0BWvWBMAACYABJE1qnkvWZPzs4esjvawvTUsXh9/Hb1GbpBMAACYABIGV8UaOjwqcLm7bw/R0cjO+LU+uzdIJgAATAAJAr1AE6POhIEaYTAAAmAASAAEAACYAAH//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oACAECEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAlAAAAAAAAP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oACAEDEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAAAAAAAD//EAC8QAAEEAQMDBAEDAwUAAAAAAAQBAgMFAAYSFRETFBAlQFA0ISI1MjNBICQwYHD/2gAIAQEAAQgA/wDXJpWQQySvbJbPRHZuts3W2brbN1tm62zdbZutsUs2B8Slfa2X8eZ6HWUYRAMUkF7VEOY2OTUFNH/UuoiX2JQ4z9R0bJJ2PTUdX+9zxb4Aw9oY9t+LH9tZfx5noVS3JU71fHpM3YerrHSR08CCjn6cOPm6zv07ZODIr8sqmybdBliU9GVWkQyOtvxY/tpomTwywvbHbMajc6WudLbOltlLqOS6KtRxelrnS1zba44Uyd8SE/cqiKiotYGJBMcsP3qr0RVymtqw4mwYJ9cWQg0DpVay1VqK7t2Wduyzt2Wduyzt2Wduyzt2WPbasarmDTsJgjmbNKyCGSV8fKyNR7u3Z527LO3ZZWaffVz2Uwnbs87dnnbssdOYLJEpH1VoqKPB08iDyPHybUtDBs7otpXmSOjHFta4t0bBzbAMCJspYR4R8bpBPWp/AiyxVFrzenoQRALBKROHdVRr5GDCX9MbKkQ3MVagRH+tr+LH9S8kmaaWETwzXfq9NOGhWZNjIfXGlagZLCIAfHQ1cD7cKyitjzwaYWSiIBRbqIk6KmcNaVMwexWBV1vMBPKX2rZ8EKP05XntJ8qxrRJHhsch+mTktDrb11OPMVpu7HguBS7+NIhJiH20tREPBR2SVEFYvpa/ix/Utd4Z0jH5bfoKx6ovX/gc5rWq51Si8fAq2KKoBiNikjljZJH/AK7VUWEeNPqJ4IiInxSgSytfMHOqIqKi8SAn6N4oHOKBzigc4oHOKBzigc4oHOKA6p19HVYKuVycUFnFBZxQOcUDnFg5xYOcWDnGCNR/bGJlSTxSvqE/fcKrfikjREx7HjEyNk8Ur6YkzY/sQCDIPG5F+MSNGTFseMTKknilfDfaBNe5ucqHnKh5yoecqHnKh5yoeQEwEM3w+qr0zlgV/VvLBZywWcsFjrcJrVXEt3mI1Wjl1gzFZFFLFNG2SL4s5EI7N83Kh4aYCRA5maZvrWV1pFd8qHnKB5ygecqHnKh5ARAQxXw4tqD1XpyoecqFnKhZyoWcqHnLBZyoWQ2Ik0jY2+lU1G1gCJ54P+7xrmuajmsex7UczJJootncyNqNsyVT1snNdXnIiIiIiJNNDAxZJfSCeAhivh9AkRs9iifFlRFtg+rtQUbClEd6RzRS7+3ian06pCDJ6RIiWxfSw/jzekbWtjY1uqXoi0kU7bR4RloFWT6jsYLSGFpVzaF14TMMvrASUxHm3FpBvhHAJaWCIS21RPFavrWfxoOW9afCuq7MOJLlbxY3jC3I4VcGBNLZvHSY0kC8kZNPFQSPkqBFklhlls5dnhEf58GbPAkwzS8zLOwuHZqKOSWrc2PvWcKTywRSntekT+3axgxMSkGM821ILwT8ix+NJ/LC4dXWb6u6eiOvXWZarMLYBsWNXtOjZFs08LYqUQRYlQypdHysPGtxxwoEg5ldQNWZ8MsltPsPoLfkzbJG/wBKZJHHKxzJBbqo3DthfFUTuKwd9DXQgCRJIA50io9aLvwVbkRERES1/D9QikGFgHn5EfOQHzkR85EfOQHzkR8FV8xRBC+psT5gyYmNsolam/kYM5AfOQgzkIMS0E3qzORHwBJF8mZ/xS98RYxSciPi2I3+R7+qKlniH5AfOQHzkIM5CDOQHwXfMWSVhcTphSImx2LNje688Z7HNWsmuQq+tqWNpipAxRnlVbls0IHEozmAPglpwZgC6h83Ij4VN5jY4IfhjqrrM93yjpVn3gw0GnK6giMhA+jAXdKfJ8kkmV0niijDRjR7GfQzTRQROllbaAKqNWSRkcb5HVjHtBg3/HJJkdJ4oow0Y0Wxn0U0Mc8T4pEJUdqjWU4YpbkGre9Yj/3RzRSFc2PCyUGgWRUWzVE6+5Z7lnuWe5Z7lnuWe5Y0kmMiKEjJ5mQQyzPY+ze1HL7jnuOe457jnuOe457jhJB8LWo8YaMaLYz6RURU6KiI1OiYQIMSid7s2A39h+sa063fS5a2fHxQbC9QGV4s7zSNSkCDxuJBOInFmlIB1Wsza2UxdRUzYXTObqGlc+ZuLqSkSLuOPkYyase/zQ8P1FTK8ysXLE6KuBJMmkvLIOEiewbqeZgJJ066jJgFmmJM1IbXMJQ9+p4OtAkeW34sf1dmxjYIFbcVjz4xXwSVl5Mk8skGmzhmkvGpKR1aMfFgmmYQqJAQwtNGQmJPLPpIqdT2YLpudhghcx7GPnrGv8UbD6Kpap9l6WYLLGvKDetdfkbvIbpqw8uc1jtJzSyGT4bQ2lms8hcGmHQmykJlt+LH9WUO0mF0a7LjNtzm25zbcZtuM23GbbjNtxkYpT54pismiZNDJE9sduxEam23zbb5tt822+bbfNtvm23xRTZ3xoV/1X//xABEEAACAQMBBAUHCQYEBwAAAAABAgMABBESEyGT0gUQMUFRFCJQYZGS0SMyQFJTVHGBsxUgM0KxsiQwocJDYGJjcHKj/9oACAEBAAk/AP8Ay5nSiljjwAzVvbpnfpaRiR+OFqK199+WorX335aitffflqK199+WorX335aitffflqK199+WoYtk7qmuNySrOcDIIG4n0t9g/wDTqXzbh5FLk4CCOMyEn3au1LO6ooIKklwSuMgbmAODV6na4JAJC7NtDFiOwBt2TVgk0VtcJBNicCfLAEusXeo1V0hEDCJC5PYBEcPv7Do76uYxGZFSIjLM5ZNeNOM5pzIWtVuVkUZQozFa+9W36q+lvsH/AKdXSaBI/KmtpBHmVGnUoue7EYNXUSySw22xYGWQxzWrl0cs7EsKv1EPkIgAfXhZMlnkIQgOX8Gp7F8TpJFcNCfKIACCVRv7TV3beSHbmP5IlyZn1jUfVWzYvfmbz0JVFW1MXnGrmJwYJROAhXMssxmJTwXLGvvVt+qvpbOl0KnHgRip7d8btTIwJ/HBp7X3X+NPa+6/xp7X3X+NTWhaxuNi25jqH1x6s5FSWvuP8aktfcf41Ja+4/xqaLZI6vojUgsynK5JJ3A+m7eKMpPoXSoXC6EOn0/eRTNttZCNqwulVyfR6ljlVVR2szHSBU9sp8BEzAfnqGaurfgNz1dW/Abnq6t+A3PV1b8Buerq34Dc9XVvwG56urfgNz1LbSEfyGNkz6tWpsUCA65we0eo1nSiFjjwAzT28Od4Qo0hX1E6lyaurfgNz1dW/Abnq6t+A3PUtujXtxt5fkD84gDAw9XVvwG56urfgNz1dW/AbnoxSQu6prRShRmOFyCWyCfRf3u3/VFSDbaNpo79OcZrpGFdTFVye1gxXA9eRVykjrGkhUdoR86SR4HFXcUjOsjKFOciJtD+6Tg1OsSM4RS3ex7AKuElVWKMVPzWHcfA/ueL/wB5o9kL/wBvXIscUSF3djgKqjJJq9id0QOy5wQp7Gwe6r6J3ZC6D66r2sn1gPEVexeSSFQk2rzWLnSOv71bfqr6JVBsyA8smSoYjOlVGMmukpR6kRFH+oaul7hop7+3ItBjZfPA1N6//XFXl1axrYaTJCqEM20zpO0VqhmaWPpnW+oDWUFyx2jYq1kaabZWeofZypjX6xG1dG3QtoU6ShURQtJgNcqUyF+sooTRny6OQto86NdDb2Vqa5uXu70zXM2lyAVi2aAxwaMrR6UWeLoa1hTDvkS5cSkJqGp6huksUnnyUS6O1ZkXS4iDCVFyWAFPdtOljaxDauVUtoy5KKSuvxNX1woLyHSujA88+K101cxwi00GBCMTaR2y7sdcZeWWxnREHazMhAFWE0Zj6NuomluEMOppVCiEZ34auirqA2spmlaeExCALEyaFPYxOcebXRsq28EEV8igdk7hQYseKtlj1/erb9VfRP8ACun1I3cJMAFPzxkdW5Y7iB2PgqyAk/5JAAGSTuAAoEatTD8GYkUCTsXwB+FMGRlDKw3gg/5Hz3uoNI7zpcMfYB6JQMjDBFOXkhClXPa8bfNY+vdg0Mg1DpHgrMoH4AGo24j/ABqNuI/xqNuI/wAajbiP8ajbiP8AGo24j/Go24j/ABqDV6mZmHsJ64AuTkhSVGT6lIqNuI/xqNuI/wAajb33+NRtxH+NRtxH+NRt77/Go299/jSFHZdIkVjrX8CawJwMo43LKo718D4j0T2R2ul/xdsj+n0bIwdSsu5kYdjKe41gTgEow3LKo7x4HxHodRJckZCdyj6znuFOXd2LyOe1mPf9HyMEFWU4ZWHYynxrAmAJRxuWVR3jwPiPokjMVODojdwCO7Kg0ZuBLy0ZuBLy0ZuBLy0ZuBLy0ZuBLy0ZuBLy04YA4PcQfAg9h/dkdx3MkTup/AqCDRm4EvLRm4EvLRm4EvLW3OB3QSk/20J7WE97QSbYj8CuEpZgCcsTDKSx8WJXJNOHRuxgcj6M4UE4HiT4ADtNGbgSctLMXHnJiKRCHHYQ2ncatZYpEuQYSsEpRoivc2mttwJeWjNwJeWjNwJeWjNwJeWjNwJeWnDAHB8QfAg9h6pHYeKRu6/kVBBozcCXlozcCTlozcCXlozcCXlozcCXlozcCXlozcCTlqQhz2B0ZC2PDUBnrGB5PH/qtXUX+F/j+cPkt2rz/DdRBBGQRTBlPYQcg9Tqutwi5OMse4dQxqt4ifWQzD9xgcROD7KGAKkVEyBqY4GWOB1yq6h2QlTkBkJVh+IIwesYHlOfzMak/Ru62nYeo6kGa6VtFuBJszEZVDa/q48euQNoco2DnDDtB6umbPbl9Gz2y6tedOMdffbQk+s6nFfYSf20AFCgADsAFStHYzdIKl2wYoCuzcorN3KzgCjbwS+UWA3TG4gTymYxZCYXQ5AyVq4WSF72W1OpEQDZQM/1tRbWtdJ20r3EfRtzqiXAgd7lFwcHerVNBJLZi8RZXTGNKROGcKexde+ulbe6ZJH1NEkYlUCMNgq7KrYzk4OcU2VmhSQHSUyGGew7xXatxbkcVev7tF/aKtJXleZ4ZYkXfc272yAFfFkapLtG8pt1hAWcx+S7JdfZiMb9WSfOry9EeAmTUXGxksZC5Xzvtsha/ayNPYvcWaQCQOlzK5YROE3AoCoAfdU8vlx6TjWLba3giVYxlgg7s1HcJKFIlW4JMgkU4bJNXUkWLaPOgKc+c31ga6SufZHy10jdf/PlrpC69qctdLXQU2oQQK2FfR3y+PUjO3lFscKMnAmUml6VlvlhvWvEOsKfsxFqBQH6mmn6S/Z/lVu87ILotsjE6+az/KY1gasU3SEMWb17Y6JzIZnuHKFxF34IID1Lcl9sscauzCMJskJKL2b26vvC/pr9G+6z/wB6VM4h/aEsjW4g1PJEJQWCnt84VLeLOs97qQLMUa2Ctsh9n9Ugr51XHSr20lvYPdOHd5Ml2EpTvUkY1hKPSSdHNcX75YXO1MmpdkW2XymMZ0VPdPMkMEYDkpGSYlLsEB05LVE2P2QAjBf5w7nAPjV10kNXRyvFLm4lc3jneX2f5YV/Mqa6EwuwCoWYxG2CcL/dVzJFi1hzoCnPnP8AWBrpyZLUWZRoAqnblQd79wrwpFZGGGVhkEesGujpY7OSYRQ3IhCwM+d2O8AnsYjBryYyfNmYaNansGo9xp4MTyLBEQFO0kiTO8r3gLTwFg+l8FSQzbsH1morUuweWODQpHyZGo47iM9X29v+qvXDMskUao2I3dTpGMgqCCDSz8CTlpZ+BJy0s/Ak5aWfgSctLPwJOWkn4EnLUTpGUSNNYKs2kkk4PYN/7mNbRsFz2ZIqG4Ru9TC5wfDIBBpJ+BJ8KSfgSfCkn4MnwpJ+BJ8KE2sKCV2MmQD+VJPwJOWoym2m1qrdoUKFGfAnH0aN3RY5I3CDUy6ypDYHaPNpJ+BJy0s/Bk+FTtK8JAlVI3YoT2BsCkn4EnLST8CTlpJ+BJy0k/Ak5aSfgyctRukbRxxprGlm0FiTg7wN9Y1PEyjPiRioLhHAwy7J2wfxUEGluMEEfwJOWrTQlroia7KO4eCLcCqYB1sK6OCbCwe2mbQ58qZ3Rix90k6qtNMQ6UWddMLKQhtDAWA09oarOZ5vII7TMudGrWCZRskUnRjWpY6s1ZlvJobyGWcRuXkMrq6zHK5y+DqpLjgSctRS5MsbMzxsiqqOGO9gPD6J2LHCns1N/u+lIju6/KFxqSNG72HeT3LSFUnuDMR4EqBgehP5rkgfgihf6j6TgzEZdyMrEp729fgKyckszHezMe1mPifQTaUUZJqcIxOAJAYyffxRGlVLE+oUMO4MjjwaQ6j9IwZiAXc71iU959fgKycnLMd7Ox7WY95PoMZVxg1gp2LOwGiQf9fcrVK0SFgZ3hIMQUb9Gk5UlqgW4T68Pmt+aMf6GpQXX5yHzXX8VO8dSljlVVR2szHSBS2wPhqY4/PAoW/tahb+1qFv7WoW/tahb+1qFv7WoW/tao0Cy5COjE+cBnSQfUOrOlELHG84FRQR536CzMR+JAoW/tahb+1qFv7WoW/tahb+1qFv7WoW/tahCqyMIxKuW2bOcKSpxkVk7yWZt7Mx7WY959DAAdUQYj5rdjL61YbxUwnT7OY4b8nA/qKJS5iuLUgHBDNrBdARkFlqEzT3E6wwRBgut2BO8nsAAJNdGrFKksMaNthsH27aQTKwGAv81WMccsl4ttExnHk7a0Lh9rjctWmxkjZhgOHRwBkMjd6mrSO3gvYGmjcTiTQFTanaDA0jFXgVA6Idasran3qApGTq7qvoxskkdy2VXTDuchjuOjsbwq9VRthDhlYPtCusJoIzkjeKcKvlR3scdsT1cw++Kvolu/JiyRswGsMDgp49QYpDGXKoMs2O4DxNdDskSWss4MEm2I2QzofcuGNWMZt0tduk1tcLNE3dpLYUKa6ODH5EQeSzCZJ3mbQqKxC4auiwsq2c1zCIZdokuxxqTJUYeoHc9Jtwl05Jbq+9W36q+i0Uf4u37B/3RUyxXNrcLPA7LqUMAVIYeBDEV0jCJGeLRAIy1uETOpGBOSXzvapbKEy3SyvapD/hnUJpZWHi3bqFNEvlM7yiKFCkMOpQulF/LJrYW975CLfyyOEBtQXGurmEpt4JQgEjsNijIQXkZic6qu4oY50nGIg4V2lbWrNHq0gr3lcFqlhDxXgnKqHfKiB4QC0jEk5fNKGBujuIyP4T1BH7oqziN2bZkEpUEoqjsXw6nZBNGV1r2qe5hnwrpaKIravGnk0ZGZX/AOKwct2dy1cWdnctabHNrBhZX1BtcwJ84bsAVJa2k0nk7oLWIhNrbvtFkkBI1VeQI4spreBYkbQrTY1SPk5PYMCroFPLUmiQr/DjBLsg9bOxPV96tv1V9FsVOVZWHarKcg1PacJ+aprPhvzVNZ8N+aprPhvzVNacN+aprThvzVNacN+aprThvzVNG2yyUSNCo1EY1EknqzpdSpx4Grm2cDcGaNtR/HDVNacN+aprThvzVNacN+aprThvzVNacN+aprThvzVNacN+apoTEjq+iNCuplORkkncD/yt/8QAFBEBAAAAAAAAAAAAAAAAAAAAgP/aAAgBAgEBPwBgf//EABQRAQAAAAAAAAAAAAAAAAAAAID/2gAIAQMBAT8AYH//2Q==" alt=""></p> <blockquote><p>首先浏览器通过URL定位到了一堆由HTML、CSS、JS组成的资源文件，通过加载器（这个加载器的实现也很复杂，在此不多赘述）把资源文件给WebCore。之后HTML Parser会把HTML解析成DOM树，CSS Parser会把CSS解析成CSSOM树。最后把这两棵树合并，生成最终需要的渲染树，再经过布局，与具体WebKit Ports的渲染接口，把渲染树渲染输出到屏幕上，成为了最终呈现在用户面前的Web页面。</p></blockquote> <h3 id="js内存管理"><a href="#js内存管理" class="header-anchor">#</a> JS内存管理</h3> <p>JS的内存管理是GC机制（垃圾回收机制），GC会维护一条引用链，一旦某个对象节点不在链上，就会被释放</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <h2 id="类解析"><a href="#类解析" class="header-anchor">#</a> 类解析</h2> <h3 id="类基本介绍"><a href="#类基本介绍" class="header-anchor">#</a> 类基本介绍</h3> <table><thead><tr><th style="text-align:left;">Class</th> <th>Detail</th> <th style="text-align:center;">Detail</th></tr></thead> <tbody><tr><td style="text-align:left;">JSVirtualMachine</td> <td>JS的虚拟机，可以包含多个JSContext，一个JSVM对应一个线程，不能JSVM之间不能传递数据JSValue等</td> <td style="text-align:center;">代表一个对象空间，拥有自己的堆结构和垃圾回收机制。大部分情况下不需要和它直接交互，除非要处理一些特殊的多线程或者内存管理问题</td></tr> <tr><td style="text-align:left;">JSContext</td> <td>JS运行环境上下文，只能属于一个 JSVirtualMachine，类似一个js 中window对象</td> <td style="text-align:center;">代表JavaScript的运行环境，你需要用JSContext来执行JavaScript代码。所有的JSValue都是捆绑在一个JSContext上的</td></tr> <tr><td style="text-align:left;">JSValue</td> <td>JS的值对象，用于OC和JS之间数值类型转换</td> <td style="text-align:center;">代表一个JavaScript实体，一个JSValue可以表示很多JavaScript原始类型例如boolean, integers, doubles，甚至包括对象和函数</td></tr> <tr><td style="text-align:left;">JSManagedValue</td> <td>对象管理器，用于处理对象的声明周期</td> <td style="text-align:center;">本质上是一个JSValue，但是可以处理内存管理中的一些特殊情形，它能帮助引用技术和垃圾回收这两种内存管理机制之间进行正确的转换</td></tr> <tr><td style="text-align:left;">JSExport</td> <td>接口导出协议，用于暴露OC方法给JS</td> <td style="text-align:center;">这是一个协议，可以用这个协议来将原生对象导出给JavaScript，这样原生对象的属性或方法就成为了JavaScript的属性或方法，非常神奇</td></tr> <tr><td style="text-align:left;">JSBase.h / JSContextRef.h / JSObjectRef.h</td> <td>c结构</td> <td style="text-align:center;">c结构</td></tr></tbody></table> <p>JSContext是JS运行环境，JSValue是JS实体抽象，这两者用的比较多，一个简单的代码示例：</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>//运行JS代码
JSContext *context = [[JSContext alloc] init];
[context evaluateScript:@&quot;var num = 5 + 5&quot;];
[context evaluateScript:@&quot;var names = ['Grace', 'Ada', 'Margaret']&quot;];
[context evaluateScript:@&quot;var triple = function(value) { return value * 3 }&quot;];
JSValue *tripleNum = [context evaluateScript:@&quot;triple(num)&quot;];

//示例2，使用字面量
NSString *factorialScript = loadFactorialScript();
[_context evaluateScript:factorialScript];
JSValue *function = _context[@&quot;factorial&quot;];
JSValue *result = [function callWithArguments:@[@5]];
NSLog(@&quot;factorial(5) = %d&quot;, [result toInt32]);

</code></pre></div><p>OC中调用JS代码示例</p> <div class="language- extra-class"><pre class="language-text"><code>//js代码 Hello.js
function printHello() {
}

//OC中调用 JS方法
NSString *scriptPath = [[NSBundle mainBundle] pathForResource:@&quot;hello&quot; ofType:@&quot;js&quot;];
NSString *scriptString = [NSString stringWithContentsOfFile:scriptPath encoding:NSUTF8StringEncoding error:nil];

JSContext *context = [[JSContext alloc] init];
[context evaluateScript:scriptString];

//运行 printHello
JSValue *function = self.context[@&quot;printHello&quot;];
[function callWithArguments:@[]];

</code></pre></div><p>JS调用OC代码，两种方式</p> <ul><li>Blocks JS functions
<ul><li>Avoid capturing JSValues, Prefer passing as arguments 或使用 JSManagedValue</li> <li>Avoid capturing JSContexts, Use + [JSContext currentContext]</li></ul></li> <li>JSExport Protocol</li></ul> <div class="language-objective-c extra-class"><pre class="language-text"><code>//Blocks JS functions

//native
context[@&quot;makeNSColor&quot;] = ^(NSDictionary *rgb){
    float r = [colors[@&quot;red&quot;] floatValue];
    float g = [colors[@&quot;green&quot;] floatValue];
    float b = [colors[@&quot;blue&quot;] floatValue];
    return [NSColor colorWithRed:(r / 255.0)
	green:(g / 255.0f)
	blue:(b / 255.0f)
	alpha:1.0];
};

//js
var colorForWord = function(word) {
    if (!colorMap[word])
        return;
    return makeNSColor(colorMap[word]);
};


//JSExport Protocol, 详见下面JSExport
</code></pre></div><h3 id="线程安全"><a href="#线程安全" class="header-anchor">#</a> 线程安全</h3> <p>JavaScriptCore 是线程安全的，唯一需要注意的有两点</p> <ul><li>JSVirtualMachine 是在一个独立的线程执行，多个JSVirtualMachine对应多个线程，之间的JSContext不共享和不能传递</li> <li>JSVirtualMachine 之间不能传递 JSValue，但是JSVirtualMachine下的多个JSContext可以传递JSValue</li></ul> <p>线程运行图示例</p> <p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wEEEAAWABYAFgAWABcAFgAZABwAHAAZACMAJQAhACUAIwAzAC8AKwArAC8AMwBNADcAOwA3ADsANwBNAHUASQBWAEkASQBWAEkAdQBoAH4AZgBfAGYAfgBoALoAkgCCAIIAkgC6ANcAtQCrALUA1wEFAOkA6QEFAUgBOAFIAa0BrQJBEQAWABYAFgAWABcAFgAZABwAHAAZACMAJQAhACUAIwAzAC8AKwArAC8AMwBNADcAOwA3ADsANwBNAHUASQBWAEkASQBWAEkAdQBoAH4AZgBfAGYAfgBoALoAkgCCAIIAkgC6ANcAtQCrALUA1wEFAOkA6QEFAUgBOAFIAa0BrQJB/8IAEQgBQwH0AwEiAAIRAQMRAf/EABoAAQADAQEBAAAAAAAAAAAAAAABAwQCBQb/2gAIAQEAAAAA+uAAAAAAAAAAAAAGaQAAAARd2AAAADNpAAAAAzaQAAAAZtIAFGG3vaAAzaQAAAA8D1NYAGHzJ2+mAAzaQAAACMmvPpAAQkAAzaQAAAEZdagjiwAAVWgFOvoAAACMusEVXAADPoAM+gAAABj2ARVcAAM+gAz6AAAAMewBFVwAAz6ADPoAAABl0dAIquAAGfQAZ9AAAAZ7LACKrgABn0AGfRx5+q0q0gAK+LwBFVwAAz6ADPoefizuN3pXyADJrMuPbHU4/SVXAMVOpLJt50AGfQAAAZdMlfk8c8NPsRXaAzZs9MdPZjQAZ9AAADiu8AHNdoCUBOe8AovABIDNpAA5rtK6K+6672T2JhReAUXgAkDji4BHAyUekZMkX8ZdffkfR9nhe6J6OPJ9kAEgZtIBkuAFGslnntAEc3gACQM2kAovPEnuu71YovCjQQAovAAEgZ9ABRezZLOaN+pmybTjD7Bjwa8F/rlF4AAkFU2AFHWC6ZTQ1xGk4x7zyS3H7qKLwABIKLpAM7xdLjZRxV6nd4UaABFF4AAnzOLp6vXAGToAcawp5kQDq4AAc4eqnPp06QAZ75GbTAJBn0CAAASgTl0gAz6CWbTAJBn0CAAASgK4tAHHNpKuLASDPoEAAAlAM2kAY9gkxbASDDuEAAAlAGbSGeTyPXd2cVvI9YXzLio8v1CzsAAEoA44uKO6I18d8130W8LoKL5Z7q10TFF4AAJQAot6UZc12U49q+jyKtdeezT6F8s/n4tmea7/AFbwAASgAy6lHOoiczRjstc9Rmu0GWLznvHdoAABKABm00eZms7zez5e/wBLzac99XevN6Ogx489nVHqYfR0gAAlAArjuqSJL6AIssKuJBNoAAJQAFFnYz6SCQAAIAABKAAZtIz6ASAABAAAJQABl1FF4JAAAgAAEoAAjNqovAkAACAAASgABGfq8CQAAIAABKAAAASAABAAAJQAAACQAAIAAB//xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oACAECEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8QASBAAAgEDAQIFEAkDAwMFAAAAAQIDAAQREhMhMVNzkZIFEBQgJDAyQEFRUmJjobHRIiMzNFRhcYGyRFByQkPCFYLBYHCDouL/2gAIAQEAAT8A/wDSRlkd2WJRhTgs3BnzCu6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++u6fZ++i1yozoRvyBINI6yIrrwEeP2v2R/zf8Akf7Ba/Ztykn8j4/a74f+9/5Hv1zMLeCWUjOhSatb11tp2u8CSA/WaaHVGDDl1kTTGZPpLjKiob6KaQRhXUsupNS41Dv9r9m3KyfyPj1/aP1Rw8LuE1KPCOHFWSKluqKMKrMB+gbv17bPdCGP/a15k34OBV9Y9jQ3kkROh7Zg+pixyKvIrp4J5p0RAlrIoCsWyWqCO7lmgkmSNFjQ4Ctq1Fu/2v2bcrJ/I+OEgAk1g3fDug83Gf8A561r9kR5pH/l38gEYNEAjxC1+yJ88jkdI+NkhQSTgCgDckFhiLyL6X5nrtB9MujlCfCxwGtnNx56IrZzceeiKMcwH256IqJZ3ijcznLKD4IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiKxPtgm3ONBPgitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3HnoitnNx56IrZzceeiK2c3Hnoio0lmVg8zYDsuFAXIBpVVVCqAABgDxokAEk4FAG5IZt0Q3qPT/ADPbngNW/wB3h5NfEf6ockfj3q28GTlX+PjY7rPsAemfl3g8Bq3+7w8mviP9UOSPx71beDJyr/Hxpu6mKD7EHDH0z5u8ngNW/wB3h5NfEf6ockfj3q28GTlX+PjMjGZzChI4xh8BSqqKFUAADAA7yeA1b/d4eTXxH+qHJH496tvBk5V/j4xNIwxHH9o3Mo85qKNYkCrz+UnvR4DVv93h5NfEf6ockfj3q28GTlX+PWkZlRmVC5A3KN2ajv55JWjFjIChAf6Sbs1BdRTquGAY5+hnfW1i3/WLuGTvoSxsmsOpXzg7qWWJ1LrIpXzg7qjuY5Z3iTfpRW1A5B1d/lkESFiM+YDhJNQxFcu++R97fId7PAat/u8PJr4j/VDkj8e9W3gycq/x69qrC8vyQQC6Y6NQ2ypBZsIcP2TljjfvJo2umwQiHhuS0v0MkqGNOp2V06oXVpIgcwkJuO9glFS5ucxu6F4XYbIprRat3hS7vJ0hcRbKPgjI1GnuETa5VzoUE4UnOfNQ77H9e+2PgDdH/wCW7S5luIgGihVwAS2X00vVGbYJPJAiRuY9J1+RzSXdq6F1njKAgFg1Ne2aKjNcRBX8ElhvqW6toNO1mRNXBqNSXNvEF2kyLq8HLAZpuqUaWsU7IcvwKOseA1b/AHeHk17zeTz26NIkKuiqWfL6aF9MiI88CRo7KAdpnc1Ld2rx7RZ4ymcag1NeWiiMtPGNe9MsN9TXdtAVEs6ITwamAqa6t4MCSZFLeCCwGaS/eVItnbs7tCsrKG4A1W863EMcqggOM4Nf1Q5I/HvVt4MnKv8AHxaYmRhAp4Rlz5loAAADtJgTDIAMkoaMEh6mWMRjJYGDUtXdq7z3OIco5tfc9XUUiXcz/XBHiVU2SB6MU0WyjCSp3MqqUQO59Rmq1VoNi0ttIwNqkQwmcMtCGUdRki2bBwijR1jwGrf7vDya95vUZ7O5RQSzROAKmhZ4LJShOJIywqe2Z5pxsSVa5garqGRbm6zttMqgII41cMPRqWKdMwhZR3OiKUQMX/JmNRZj1GS1kfa2yKv0PMN6mlNysFrAyTIi26ayiZYn0athGsEYjQogXAUjBFf1Q5I/HvVt4MnKv8fFZHWNGduACoEZVJfw3Opu+ngNW/3eHk18R/qRyR+PerbwZOVf4+Kt9bOq/wCmPDN+beTvx4DVv93h5Ne0lZ1XKqpOeAtpqC4km0sY0VT6+TTXzLEH2JbLhcrvXe2KmvFiWL6J1O25W3HA4TVv1QSckBMb2Ayy+SpeqLxBMwDWyndrHDTXyhI3EbEMqtwgEBjiheqZZE2cmFj1+AaTqtkgtAwQjUDwkJQIYAjgI7T+pHJH496tvBk5V/j4pI4jRnPAoJqBCkY1eGx1N+p7ySAMk1tYuMXnraxcYvPW1i4xeetrFxi89XrM9s+wnCygZXeK6lO/YiPPMC7jorW1i4xeetrFxi89bWLjF56vGR0CqkcjHgLYKp+Zq2tlt5CqWquNaaZN2AAtPbyyPEZLUsC7u2CB/itRQORbF4Arq7hv0watreaKUqyERRx4UAhg9diTF0Z7crpbICcBG8767EmlFrk42O/U3CzfKo4nR5wiSYEYVC36ncK/6fKJTuVNSnXwYao5Y9C5ZV3DdqBxW1i4xeetrFxi89bWLjF56YXR6qhBddzldfzStrFxi89bWLjF562sXGLz1tYuMXnoSIxwHUn9e0lQvG6hipI3MOEV1JS+O2e6c7nZVX4t4pN9N4ovOdTfoveljE8jtJvVW0qp4N3lrYxcWnMK2MXFpzCtjFxacwrYxcWnMK2MXFpzCtjFxacwrYxcWnMK2MXFpzCtjFxacwrYxcWnMKljWDEsYC4I1AbgwPbXDNpRFOC7Bc+alt4FGBGvNk1sYuLTmFbGLi05hWxi4tOYVsYuLTmFbGLi05hWxi4tOYVsYuLTmFbGLi05hWxi4tOYU1vAwwYl5qgLDWjEko2AfOCMjxiP6U0z+bCD9t/eoOCTlX7SW5ucXeGbCXQQlV1FEK1C8sonSC+Eo2W4tjWj0bx54rERHDzsNX5BN71ZXsuu8Fw+5WkdD6iHFdSp7mZJzOd4m5gQD17r7B/27ab7S25X/ie+Rfa3H+S/xHjFrvgRvTy3SOe9QcEnKv17mOZxGYZArI4bB4GHmNLZ3KqziYCZp9qfQ4Maait5jdC4mMYZUKBUq3sTBdTTF8oc7NPQ1nLVJ1Ld0QbUA7aQt+aSNkrVvAYXuWJB2suscwHXuyBbyEnAFR9VrSacxRNkAZZ+Ba7Jt+NTnrsm341OeuybfjU56ku4VRiroxA3DNQ9UrW+e32T/SD70PD4PaXszwQqycJljXpMBT3crTzp2XHC6NiONl8KknnW6hjlAAlhz+jrwip7+7ERmiwVN0UQedEFXt+6GzEGCJGQsfUYgdpF9rcf5L/EeLztphlbzIxqIaY0HmUDvUHBJyr1NIIoncgkKM03VIDgiJGlD0quL5IHZcZ0qC37ncKS8EiStGhco+MCjdqH04XGcZ1rRvFLuqpnT+YGfPjNNdaI9bJj6QGCwqHqhtJRGYGDascINSdUdn/ssTg8BG/9Kgm28evGN5FXX2D/ALULSBZ9uqBZCCCRuz2kiCRGQkgMMHBwaFvBbG2SGNUXaf8AE9pLBfStsmKGLbhw+d4UHVpxUsV6drGYoZ0YkqZGxgGpbGYWMEULjbQBdDGjZFY7GNMaYHBPRIpOpk6I6lkJEsQTko2z2kX2tx/kv8R4vc/dp+Tal8Efp3qDgk5V6uwxtpQpcEqcaRk12NNrTMMgQbskltwWp7dzJKIkcbUR5I95angmWO7jZHlLHKZxjLUUnMrSbPBLocbMk6V/00sCLLcvIhcHScsNX7CtgFslURFS0mcKu/e1QW7I9vqgdVDEgZ1BR5BUsMzNK4gKrklQoqzjMMRQrjDH9876uvsH7af7S25X/ie+Rfa3H+S/xHiVzeSxPOiIDoWI9MkEmkvpdmX1wyosqqzx+Zq7NImmBjYojBRgcJAy1R3ySSeo6xlD/nTX8I3AOxy+4D0DgmiVngJU5V03HzgioG1wRN50HestA7nSzRsc5G8qa7Ki9foNXZUXr9Bq7Kh9foNS3cDAEFyDwEI1dlRev0GrsqL1+g1dlRev0Go3UI9PoNQu4SARr6DV2VF6/QamZrjCqjCPILMwxnHkHbTozoCmNasGXNC5TgdJFPm0E/CuyovX6DV2VF6/QauyovX6DV2VF6/Qauy4c4+n0GrsqL1+g1dlRev0GrsqL1+g1dlRev0Go3Kf6UkY+YIR8ahRlDM+NbtqPiLrrRlyRqBGRQsXGtzcttSEAcDG5KWyB7IMrB2mQI2BgYFHqaNEK7XOgNksobUW8tJ1O0IgWYhkEYU44uj1LXcdplvp5LoG8M5pEEaKg4FAFW25Xj9ByP2O8d9uSdARThpDpFABQAOAdrbfRDw8WcD/ABPB37+qHJH4+PN9Xcq3kkGk/qN476v1lw7eSMaR+p3ntpfq5o5PI30G/wDHfv6ockfj49LGJY2XOPMfMRwGoZDIm8YdThx5iO9yuI43c+QVBGY4lU+Fwt+p3ntpYxLG6ecVBIZIlY8PA36jce+/1Q5I/Hx+UGJtsv6OPOPP+1AggEd6MqXMkaIwKqxZ/wBUOAO8GRLaWUu2Ecax+o3Ed9NxALgHargIV4fLqxj+wJ9RIIv9DeB+R9HtSQoJJwBQnZt6QSMvkO4fE1tpfw0nOvzrbS/hpOdfnW2l/DSc6/OrWwMF1PcPBIzPIWUZXArbS/hpOdfnW2l/DSc6/Oo5VkzgEEcKncR1pJUiALZ3nAA3kmttL+Gk51+dbaX8NJzr86v7BrqSOVIJFdXUneuGrbS/hpOdfnW2l/DSc6/OttL+Gk51+dGdxva3kA/Y/A0rK6hlIIIyD2kkiRqWY4FbaT8NJzr8620v4aTnX51tpfw0nOvzo2WeqS3nYz7k4Mr4dbaX8NJzr8620v4aTnX51tpPw0nOvzqORJVDKfHJI1lQq1QyM2Uf7RPC+faXO+IDyF0B6VSypCupzu1Kv7scCuzoNen6eNejXpOnVRv4AT4ekPoL6ToDVkZIyM080Ua6mcAZA/c7hWRnGRTyxxgFmAyQB+ppt11GfPG2f2I6xGbpfyiOP3NF1BwWAOM/sKiuIJgWjlRwOEqQaiuIJ87KVHxw6SD1sjrwbtsBwCU9pKMzW4PpE+6iyggEgE8FR3EErMscqMy8IBBpLmCR2RJkZxwqGBPWyOtkVHunn/MIfHZkbdInhp7x5RUbrIgdeA9e58BeUj/kKuxcSsIRCSpkiYP+jZOaMM4l+qiljcz5YhsxFc1EbqGMW4t8kPgOSNGmuxZtQAgIcPKzy+mGFS2BRFEVsMCOHI85R6S0mW41PCxIlkcsNOGU8C1FYzJFiSDWQ8TDeDhAfA3+jTfeYuTf4jrH7z/8X/mp5Y7tmfTJpFq6uAMspZhUheUTBSkw0IWdEKkoG3oannhfU9shLpEcyoPAUmg8jyqkU8phMyjX/wBpJGaLXClnDyGVYbhU/Z6211s5DFKWbUmyAJcFvKCSBVmdVxG5kkLNbDwvODvqDhn5U/AdpL9tb/q3wqeZZ54FVH1RyS618uAhFDWVSKB1kOwdUOjQ8W7y0JrZkgWCHMqKSoxjZ4Xy1tpSuIbiZgUTW3lVy4FOJRdIC8hEV0QmfziqGe5aFi0zZ2OWxlmElQNI81o87uJdUgdeABqT7xN/injz/USF/wDbc/T9U+l17nwF5WP+QoXtoz6BOhbOMdoCGG4g9Zru2QAtMuCSOjWtXngZGBUxOQR+3WnlEMpkIJAi4Bw72qKcuSGhki/N8b6MsS8LqN+OHy0ZIwwUuoY+TO+pZ4YYzI7gKBmtpGWC611YzjO+pZFhjLtnAo3q6yBFIUD6DIACoaoOGflT8B2k7BHiY8C6zzLUV1tMEwSopGdb6QKaSNQSzqAOHJoyRjTl1Grg38NNJGqliwwM+6knhdY2Ei4cArv4adgiMx4FBJpr9B4MMrhVDOVHgg1GQZ5iPKiePEAggjINRExPsWPJnzjzfqOtc+AnKx/yFWshRtDyzj61/obE6d7eliu7NlLvn/0bPktX8qGvdtWnNuXfwQ9GWZEKYnLs8BXIOdO7OSKCSoAhEqx658+H4Wrd4NLM8FtbmUO5IUOwHvIFRqUEDkzRMdqQ4TUMM+rDCrQv3NrQIdnJuAx5R1r2Jpi6KMkxcGccDVJbPJBLEluUL4AZpNWPzo2FwEjGzzpieM4K7yTwnV6VR2csbsphRwzqwkJ4AFxXYl00KoYFGi12Y38LULObsnUUODOJM5WrpbqQtGqKY20YbONJB35qS2nMrMkWiQy5EqPpUr6y1Bwz8qfgO0ulLlFHCQ4HRqO3dISnYZyYiv0pcqaSwuYo4lOXMcpYupGp8r69R2U0XDAkgaNVwx3JhiaFrc6o0MS6Elmctn0812BOQAY9zRRLgMuF0VddlY0xRh1aNlO/BDVLaTbwIcvoUJKj6CMD/VUIYSyBjlgkYJ8fljEqackHhBHCDUMhcFWGHXcwqRFkRkbgNDsld31b/mSVrNz6EfSPyrNz6EfSPyrNz6EfSPyoPOSQFiyOEaj8qzc+hH0j8qzc+hH0j8qjiYMzu2XIxu3ADrSxFiro2l14DwjB8hrNz6EfSPyrNz6EfSPyrNz6EfSPyrNz6EfSPyrNz6EfSPyrNz6EfSPyo9kncBGv55LVFGIkCgk+cnhJPaSx7QDfhlOVPmNA3PlWM/uRWbn0I+kflWbn0I+kflWbn0I+kflWbn0I+kflWbn0I+kflWbn0Y+kTUUWzDZbUzHLH+wTI2RJH4a//Yeao5FlQMp3HtYd8tyfXH8R/epAYHMqj6B+0H/KgQQCO0t/94+eVvdu/vY7mbH+yx3eofl2lr9gh9LLdI5/vbKGUqwBBGCDSsbdhG5yh3I5/ietck7IoPCc6B+9ABQAOAD++OiupVgCpGCDQSeLcjB18gc7x+9JE5faSEFgMKBwL/7V/wD/xAAUEQEAAAAAAAAAAAAAAAAAAACQ/9oACAECAQE/ACg//8QAFBEBAAAAAAAAAAAAAAAAAAAAkP/aAAgBAwEBPwAoP//Z" alt=""></p> <h3 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h3> <ul><li>JSValue 的生命周期不需要在OC中手动维护，JSContext会使用JS的GC垃圾回收机制管理</li> <li>不要强引用JSValue，容易造成retain circle，如果要引用，需要使用JSManagedValue</li> <li>在JSContext的函数中，不要直接引用外部的JSContext，会造成retain circle，需要使用 <code>[JSContext currentContext]</code>来获取JSContext</li></ul> <h3 id="jscontext"><a href="#jscontext" class="header-anchor">#</a> JSContext</h3> <p>JSContext是JS运行的上下文环境，其中有几个点需要注意</p> <ul><li>执行JS代码，是调用 <code>evaluateScript:</code> 和 <code>evaluateScript:withSourceURL:</code>，其中第二个方法的URL参数用于Debug时展示信息使用</li> <li>globalObject，它返回当前执行JSContext的全局对象，例如在WebKit中，JSContext就会返回当前的Window对象。该类保存了所有的变量和函数。</li> <li>exceptionHandler，捕捉JS错误</li></ul> <h3 id="jsvalue"><a href="#jsvalue" class="header-anchor">#</a> JSValue</h3> <p>JSValue是对一个JS值的抽象，是一个非常重要的类。内部提供了大量的方法用于JS与OC之间的转换。</p> <p>OC与JS数据类型转换对照表：</p> <p><img src="/assets/img/JSValue.e5e933e7.jpg" alt=""></p> <p>内部大量方法用于转换和判断，具体可以参见<a href="https://developer.apple.com/documentation/javascriptcore/jsvalue?language=objc" target="_blank" rel="noopener noreferrer">JSValue API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="jsmanagedvalue"><a href="#jsmanagedvalue" class="header-anchor">#</a> JSManagedValue</h3> <p><strong>OC的内存管理是ARC机制，JS的是GC机制。</strong> JSContext中的JSValue生命周期属于GC管理，当相关对象不在引用链上时就会被释放。</p> <p>相关类的引用关系：</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
A<span class="token text string">[JSValue]</span> <span class="token arrow operator">--&gt;</span> <span class="token label property">|Strong|</span> B<span class="token text string">[JSContext]</span>
    B <span class="token arrow operator">--&gt;</span><span class="token label property">|Strong|</span> C<span class="token text string">[JSVirtualMachine]</span>
</code></pre></div><p>JSValue是不需要OC来保存管理的，一般不要直接 用 property(strong) JSValue ，这样很容易造成循环引用（使用 JSExport的类，如果持有JSValue，必然会造成retain circle，因为JSVaule -&gt; JSContext -&gt; OC Export -&gt; JSValue）。</p> <p><strong>如果要在OC上保存 JSValue，就需要使用 JSManagedValue 。</strong> JSManagedValue 是有条件的强引用( conditional retain )  JSValue  ：</p> <ul><li>JS生命图里是包含 JSValue</li> <li>OC生命周期里持有 JSManagedValue</li></ul> <p>当上面两个条件满足其中一个时，JSManagedValue 就会持有JSValue，但是如果这两个条件都不满足，则会 JSManagedValue的 value属性就会被自动置空。</p> <p>需要注意的时，要满足 conditional retain 必须调用 addManagedReference:withOwner: 否则当 JS生命图中不包含 JSValue时，JSManagedValue就会自动释放 JSValue</p> <p>当 OC对象持有 了JSValue，而该OC对象又被 JSContext 持有时，就会造成retain circle</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <p>为了避免这种情况，就需要使用 JSMagagedValue</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <h3 id="jsexport"><a href="#jsexport" class="header-anchor">#</a> JSExport</h3> <p>使用JSExport来暴露OC对象给JS，供JS直接调用。</p> <p>JSExport本身是一个空的协议，使用时必须自定义协议继承JSExport，然后在该协议内暴露OC属性和方法供JS调用。OC类中属性和方法都不会自动转换，必须用自定义协议继承 JSExport ，然后协议内暴露出的方法和类，才会被转换</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>//OC
@protocol MyPointExports &lt;JSExport&gt;
@property double x;
@property double y;
- (NSString *)description;
+ (MyPoint *)makePointWithX:(double)x
                          y:(double)y;
@end
    
    
//对应的JS调用
point.x;
point.x = 10;
point.description();
MyPoint.makePointWithXY(0, 0);

//OC, MyPoint 类
@interface MyPoint : NSObject &lt;MyPointExports&gt;
- (void)myPrivateMethod;  // Not visible to JavaScript code.
@end
@implementation MyPoint
...
@end
    
//在 JSContext 中，JS调用 MyPoint 实例方法
JSContext *context = [[JSContext alloc] init];
[context evaluateScript:geometryScript];
MyPoint *point1 = [[MyPoint alloc] initWithX:0.0 y:0.0];
MyPoint *point2 = [[MyPoint alloc] initWithX:1.0 y:1.0];
JSValue *function = context[@&quot;euclideanDistance&quot;];
JSValue *result = [function callWithArguments:@[point1, point2]];

//在 JSContext 中，JS调用 MyPoint 类方法
context[@&quot;MyPoint&quot;] = [MyPoint class];
JSValue *function = context[@&quot;midpoint&quot;];
JSValue *jsResult = [function callWithArguments:@[point1, point2]];
MyPoint *midpoint = [jsResult toObject];


// geometry.js，对应的JS文件
var euclideanDistance = function(p1, p2) {
     var xDelta = p2.x - p1.x;
     var yDelta = p2.y - p1.y;
     return Math.sqrt(xDelta * xDelta + yDelta * yDelta);
};
var midpoint = function(p1, p2) {
     var xDelta = (p2.x - p1.x) / 2;
     var yDelta = (p2.y - p1.y) / 2;
     return MyPoint.makePointWithXY(p1.x + xDelta, p1.y + yDelta);
};

</code></pre></div><h4 id="转换规则"><a href="#转换规则" class="header-anchor">#</a> 转换规则</h4> <ul><li>Enumeration of methods and properties to export to JavaScript</li> <li>@property → JavaScript getter/setter</li> <li>Instance method → JavaScript function</li> <li>Class methods → JavaScript functions on global class object</li></ul> <h4 id="oc的方法名转成js的遵守以下规则"><a href="#oc的方法名转成js的遵守以下规则" class="header-anchor">#</a> OC的方法名转成JS的遵守以下规则</h4> <ul><li>所有的冒号会被去除</li> <li>冒号后的标示中小写字母会被转成大写字母</li></ul> <p>比如，<code>doFoo:withBar:</code> 转成 <code>doFooWithBar</code>。</p> <p>如果需要自定义JS名字，需要使用 JSExportAs</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>@protocol MyClassJavaScriptMethods &lt;JSExport&gt;
JSExportAs(doFoo,
- (void)doFoo:(id)foo withBar:(id)bar
);
@end

</code></pre></div><h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="web获取jscontext"><a href="#web获取jscontext" class="header-anchor">#</a> Web获取JSContext</h3> <ul><li><p>UIWebView，使用以下方法获取</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>JSContext *context = [webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext”];

</code></pre></div></li> <li><p>WKWebView 无法获取到 JSContext，因为WK是在一个独立的进程里，获取不到 JSContext 对象</p></li></ul> <p>###Debug方法</p> <p>Safari浏览器可以调试JSContext，可以打开<em>Automatically Show Web Inspector for JSContexts</em>和<em>Automatically Pause Connecting to JSContexts</em>开关，App运行到JSContext开关时，Safari会自动打开调试工具。</p> <p>在Debug页面内，如果要显示js，则可以用 <code>evaluateScript:withSourceURL:</code> 方法，在资源标签内会把对应 js放到 xork 文件内供调试</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>//在调试工具中的JS文件中不会显示
[self.context evaluateScript:@&quot;var num = 5 + 5&quot;];     
//var num = 5 + 5 会放到 xork中显示
[self.context evaluateScript:@&quot;var num = 5 + 5&quot; withSourceURL:[NSURL URLWithString:@&quot;xork&quot;]];        

// 添加了一个sourceURL参数 , 用于debug和异常抛出时标记JS路径，一般可以放到Debug内，用 evaluateScript:withSourceURL: 来调试 JSContext的JS
- (JSValue *)evaluateScript:(NSString *)script withSourceURL:(NSURL *)sourceURL;

</code></pre></div><h3 id="jspatch"><a href="#jspatch" class="header-anchor">#</a> JSPatch</h3> <p>JSPatch是基于JSContext来调用JS，但是没有对所有类实现JSExport协议，而是采用动态转发机制实现。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://developer.apple.com/documentation/javascriptcore?language=objc" target="_blank" rel="noopener noreferrer">JavaScriptCore - Apple<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.apple.com/videos/play/wwdc2013/615/" target="_blank" rel="noopener noreferrer">Integrating JavaScript into Native Apps - WWDC2013<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://nshipster.cn/javascriptcore/" target="_blank" rel="noopener noreferrer">JavaScriptCore-nshipster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;mid=2651748649&amp;idx=2&amp;sn=3909ebe4e33eed50fe5d75b61a3d4203&amp;chksm=bd12a0648a652972bf89f9bfc14cfbcaff5aee2fb617e89cc084bd2c1c0a58e5958f39cb32f2&amp;mpshare=1&amp;scene=1&amp;srcid=0823pqsSjBskHA2uyTpSV3KA%23rd" target="_blank" rel="noopener noreferrer">深入理解JavaScriptCore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://zhuanlan.zhihu.com/p/34646281" target="_blank" rel="noopener noreferrer">iOS 中的 JS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://liuduo.me/2015/10/24/JavaScriptCore%E5%88%9D%E6%8E%A2/" target="_blank" rel="noopener noreferrer">JavaScriptCore 初探<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  JSManagedValue</p> <p><a href="http://lingyuncxb.com/2018/07/19/JavaScriptCore%E5%BC%95%E6%93%8E%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-1-%E5%BC%80%E7%AF%87/" target="_blank" rel="noopener noreferrer">JavaScriptCore引擎深度解析-1-开篇<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://lingyuncxb.com/2018/07/25/JavaScriptCore%E5%BC%95%E6%93%8E%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-2-API%E7%AF%87/" target="_blank" rel="noopener noreferrer">JavaScriptCore引擎深度解析-2-API篇<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  分析了源码，从源码角度解释了 conditional retain 是怎么实现的</p> <p><a href="http://lingyuncxb.com/2018/07/30/JavaScriptCore%E5%BC%95%E6%93%8E%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-3-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E7%AF%87/" target="_blank" rel="noopener noreferrer">JavaScriptCore引擎深度解析3—词法分析篇<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://luoxianming.cn/2016/05/12/javaScriptCore/" target="_blank" rel="noopener noreferrer">JavaScriptCore的学习<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/bang590/JSPatch" target="_blank" rel="noopener noreferrer">JSPatch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/bang590/JSPatch/wiki/JSPatch-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3" target="_blank" rel="noopener noreferrer">JSPatch 实现原理详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/14/2020, 8:17:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/iOS/OC/" class="prev router-link-active">
          简介
        </a></span> <span class="next"><a href="/iOS/OC/WWDC19/WWDC19.html">
          WWDC19 概要
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-3b069fde data-v-349e681a><li class="level-2" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#背景知识" class="sidebar-link reco-side-背景知识" data-v-3b069fde>背景知识</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#webkit框架" class="sidebar-link reco-side-webkit框架" data-v-3b069fde>WebKit框架</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#webkit的渲染流程" class="sidebar-link reco-side-webkit的渲染流程" data-v-3b069fde>WebKit的渲染流程</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#js内存管理" class="sidebar-link reco-side-js内存管理" data-v-3b069fde>JS内存管理</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#类解析" class="sidebar-link reco-side-类解析" data-v-3b069fde>类解析</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#类基本介绍" class="sidebar-link reco-side-类基本介绍" data-v-3b069fde>类基本介绍</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#线程安全" class="sidebar-link reco-side-线程安全" data-v-3b069fde>线程安全</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#内存管理" class="sidebar-link reco-side-内存管理" data-v-3b069fde>内存管理</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#jscontext" class="sidebar-link reco-side-jscontext" data-v-3b069fde>JSContext</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#jsvalue" class="sidebar-link reco-side-jsvalue" data-v-3b069fde>JSValue</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#jsmanagedvalue" class="sidebar-link reco-side-jsmanagedvalue" data-v-3b069fde>JSManagedValue</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#jsexport" class="sidebar-link reco-side-jsexport" data-v-3b069fde>JSExport</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#其他" class="sidebar-link reco-side-其他" data-v-3b069fde>其他</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#web获取jscontext" class="sidebar-link reco-side-web获取jscontext" data-v-3b069fde>Web获取JSContext</a></li><li class="level-3" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#jspatch" class="sidebar-link reco-side-jspatch" data-v-3b069fde>JSPatch</a></li><li class="level-2" data-v-3b069fde><a href="/iOS/OC/JavaSrciptCore/JavaSrciptCore.html#参考资料" class="sidebar-link reco-side-参考资料" data-v-3b069fde>参考资料</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/assets/js/app.3efcfa1f.js" defer></script><script src="/assets/js/3.d41f5393.js" defer></script><script src="/assets/js/1.0d0e82e9.js" defer></script><script src="/assets/js/9.25143fa3.js" defer></script>
  </body>
</html>
