(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{447:function(e,r,t){e.exports=t.p+"assets/img/vpn_2.39bd2481.jpg"},448:function(e,r,t){e.exports=t.p+"assets/img/vpn_1.97cfd1cd.jpg"},449:function(e,r,t){e.exports=t.p+"assets/img/core_1.f2b04efa.jpg"},450:function(e,r,t){e.exports=t.p+"assets/img/core_2.f33b1134.jpg"},537:function(e,r,t){"use strict";t.r(r);var n=t(2),a=Object(n.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"networkextenson-packet-tunnel-provider介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#networkextenson-packet-tunnel-provider介绍"}},[e._v("#")]),e._v(" NetworkExtenson-Packet Tunnel Provider介绍")]),e._v(" "),r("h2",{attrs:{id:"vpn介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#vpn介绍"}},[e._v("#")]),e._v(" VPN介绍")]),e._v(" "),r("p",[e._v("核心是虚拟网卡 TUN/TAP，开启vpn后，网络数据会流向虚拟网卡，通过虚拟网卡再最终发到物理网卡。")]),e._v(" "),r("p",[e._v("整体数据流向图，参考以下两张：")]),e._v(" "),r("p",[r("img",{attrs:{src:t(447),alt:""}})]),e._v(" "),r("p",[r("img",{attrs:{src:t(448),alt:""}})]),e._v(" "),r("p",[e._v("参考资料：")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://junmajinlong.com/virtual/network/kernel_nic_ip/",target:"_blank",rel:"noopener noreferrer"}},[e._v("理解物理网卡、网卡接口、内核、IP等属性的关系"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://www.junmajinlong.com/virtual/network/all_about_tun_tap/",target:"_blank",rel:"noopener noreferrer"}},[e._v("理解Linux虚拟网卡设备tun/tap的一切"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"networkextenson"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#networkextenson"}},[e._v("#")]),e._v(" NetworkExtenson")]),e._v(" "),r("h3",{attrs:{id:"内存限制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#内存限制"}},[e._v("#")]),e._v(" 内存限制")]),e._v(" "),r("p",[e._v("从iOS15开始，packet tunnel内存限制从15M提升到了50M。")]),e._v(" "),r("p",[e._v("数据来源参考："),r("a",{attrs:{href:"https://developer.apple.com/forums/thread/73148",target:"_blank",rel:"noopener noreferrer"}},[e._v("What is the memory limit for a network extension?"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("img",{attrs:{src:"memoryLimit.jpg",alt:""}})]),e._v(" "),r("h3",{attrs:{id:"内存管理策略"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#内存管理策略"}},[e._v("#")]),e._v(" 内存管理策略")]),e._v(" "),r("p",[e._v("内存管理核心是建立buffer space，通过监控buffer space的大小来控制内存。但是需要建立进程max内存与buffer space的关系。")]),e._v(" "),r("p",[e._v("参考：")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.apple.com/forums/thread/44942",target:"_blank",rel:"noopener noreferrer"}},[e._v("Network Extension Provider Memory Strategy"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.apple.com/forums/thread/97636",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monitor live memory for Network Exension"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"packet-tunnel-provider介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#packet-tunnel-provider介绍"}},[e._v("#")]),e._v(" Packet Tunnel Provider介绍")]),e._v(" "),r("p",[e._v("NetworkExtenson 实现了手机网络的众多自定义功能，其中实现VPN主要有三种方式：")]),e._v(" "),r("ul",[r("li",[e._v("Personal VPN")]),e._v(" "),r("li",[e._v("Packet Tunnel Provider")]),e._v(" "),r("li",[e._v("App Proxy Provider")])]),e._v(" "),r("p",[e._v("Packet Tunnel Provider 用于自定义协议的vpn控制。")]),e._v(" "),r("p",[e._v("了解一个框架抓住核心类，了解众多子类的作用。")]),e._v(" "),r("h3",{attrs:{id:"核心类"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#核心类"}},[e._v("#")]),e._v(" 核心类")]),e._v(" "),r("p",[e._v("核心类为： "),r("strong",[e._v("NETunnelProviderManager")]),e._v("、"),r("strong",[e._v("NEPacketTunnelProvider")]),e._v("、"),r("strong",[e._v("NEPacketTunnelFlow")])]),e._v(" "),r("ul",[r("li",[e._v("App内使用NETunnelProviderManager开启、监控VPN")]),e._v(" "),r("li",[e._v("Extension内入口类（NEPacketTunnelProvider子类）对VPN参数进行配置，通过NEPacketTunnelFlow对网络数据进行读写")])]),e._v(" "),r("p",[r("img",{attrs:{src:t(449),alt:""}})]),e._v(" "),r("p",[r("img",{attrs:{src:t(450),alt:""}})]),e._v(" "),r("h3",{attrs:{id:"类图"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#类图"}},[e._v("#")]),e._v(" 类图")]),e._v(" "),r("p",[e._v("Packet Tunnel Provider 包含了较多的类，用于不同模块的抽象。")]),e._v(" "),r("p",[r("img",{attrs:{src:"PacketTunnelProvider.jpg",alt:""}})]),e._v(" "),r("h3",{attrs:{id:""}},[r("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")])]),e._v(" "),r("h3",{attrs:{id:"学习demo"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#学习demo"}},[e._v("#")]),e._v(" 学习Demo")]),e._v(" "),r("p",[e._v("可通过OpenVPNAdaper详细学习iOS VPN使用。")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/ss-abramchuk/OpenVPNAdapter",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenVPNAdapter"),r("OutboundLink")],1)])]),e._v(" "),r("h3",{attrs:{id:"资料"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[e._v("#")]),e._v(" 资料")]),e._v(" "),r("ul",[r("li",[r("p",[r("a",{attrs:{href:"https://developer.apple.com/videos/play/wwdc2019/714",target:"_blank",rel:"noopener noreferrer"}},[e._v("WWDC集合"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://developer.apple.com/documentation/networkextension?language=objc#topics",target:"_blank",rel:"noopener noreferrer"}},[e._v("NetworkExtension"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://developer.apple.com/forums/thread/73148",target:"_blank",rel:"noopener noreferrer"}},[e._v("What is the memory limit for a network extension?"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://developer.apple.com/forums/thread/44942",target:"_blank",rel:"noopener noreferrer"}},[e._v("Network Extension Provider Memory Strategy"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://developer.apple.com/forums/thread/97636",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monitor live memory for Network Exension"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://github.com/ss-abramchuk/OpenVPNAdapter",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenVPNAdapter"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://junmajinlong.com/virtual/network/kernel_nic_ip/",target:"_blank",rel:"noopener noreferrer"}},[e._v("理解物理网卡、网卡接口、内核、IP等属性的关系"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://www.junmajinlong.com/virtual/network/all_about_tun_tap/",target:"_blank",rel:"noopener noreferrer"}},[e._v("理解Linux虚拟网卡设备tun/tap的一切"),r("OutboundLink")],1)])])])])}),[],!1,null,null,null);r.default=a.exports}}]);