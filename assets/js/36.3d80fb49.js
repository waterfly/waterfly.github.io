(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{457:function(t,a,e){t.exports=e.p+"assets/img/WKLoadProcess.b14e39e1.jpg"},550:function(t,a,e){"use strict";e.r(a);var n=e(2),s=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#wk总结"}},[t._v("WK总结")]),a("ul",[a("li",[a("a",{attrs:{href:"#wk类分析"}},[t._v("WK类分析")]),a("ul",[a("li",[a("a",{attrs:{href:"#wkwebviewconfiguration"}},[t._v("WKWebViewConfiguration")]),a("ul",[a("li",[a("a",{attrs:{href:"#wkpreferences"}},[t._v("WKPreferences")])]),a("li",[a("a",{attrs:{href:"#wkusercontentcontroller"}},[t._v("WKUserContentController")]),a("ul",[a("li",[a("a",{attrs:{href:"#wkuserscript"}},[t._v("WKUserScript")])]),a("li",[a("a",{attrs:{href:"#与js交互"}},[t._v("与JS交互")])]),a("li",[a("a",{attrs:{href:"#rulelist"}},[t._v("RuleList")])])])]),a("li",[a("a",{attrs:{href:"#wkwebsitedatastore"}},[t._v("WKWebsiteDataStore")])]),a("li",[a("a",{attrs:{href:"#suppressesincrementalrendering"}},[t._v("suppressesIncrementalRendering")])]),a("li",[a("a",{attrs:{href:"#mediatypesrequiringuseractionforplayback-ios10"}},[t._v("mediaTypesRequiringUserActionForPlayback(iOS10)")])]),a("li",[a("a",{attrs:{href:"#allowsinlinemediaplayback"}},[t._v("allowsInlineMediaPlayback")])]),a("li",[a("a",{attrs:{href:"#selectiongranularity"}},[t._v("selectionGranularity")])]),a("li",[a("a",{attrs:{href:"#datadetectortypes-ios10"}},[t._v("dataDetectorTypes  （iOS10）")])]),a("li",[a("a",{attrs:{href:"#ignoresviewportscalelimits"}},[t._v("ignoresViewportScaleLimits")])]),a("li",[a("a",{attrs:{href:"#wkurlschemehandler-ios11"}},[t._v("WKURLSchemeHandler ( iOS11)")])])])]),a("li",[a("a",{attrs:{href:"#wknavigationaction"}},[t._v("WKNavigationAction")]),a("ul",[a("li",[a("a",{attrs:{href:"#属性"}},[t._v("属性")])]),a("li",[a("a",{attrs:{href:"#相关类"}},[t._v("相关类")])])])]),a("li",[a("a",{attrs:{href:"#wkuidelegate"}},[t._v("WKUIDelegate")]),a("ul",[a("li",[a("a",{attrs:{href:"#相关方法"}},[t._v("相关方法")])]),a("li",[a("a",{attrs:{href:"#相关类"}},[t._v("相关类")])])])]),a("li",[a("a",{attrs:{href:"#wknavigationdelegate"}},[t._v("WKNavigationDelegate")]),a("ul",[a("li",[a("a",{attrs:{href:"#协议方法"}},[t._v("协议方法")])]),a("li",[a("a",{attrs:{href:"#相关类-协议-枚举"}},[t._v("相关类/协议/枚举")])])])]),a("li",[a("a",{attrs:{href:"#wkbackforwardlist"}},[t._v("WKBackForwardList")]),a("ul",[a("li",[a("a",{attrs:{href:"#相关类"}},[t._v("相关类")])])])]),a("li",[a("a",{attrs:{href:"#wkprocesspool"}},[t._v("WKProcessPool")])]),a("li",[a("a",{attrs:{href:"#部分重要方法"}},[t._v("部分重要方法")])])])]),a("li",[a("a",{attrs:{href:"#类结构图"}},[t._v("类结构图")])]),a("li",[a("a",{attrs:{href:"#工程实践注意点"}},[t._v("工程实践注意点")]),a("ul",[a("li",[a("a",{attrs:{href:"#wkscriptmessagehandler协议"}},[t._v("WKScriptMessageHandler协议")])]),a("li",[a("a",{attrs:{href:"#blank情况"}},[t._v("_blank情况")])]),a("li",[a("a",{attrs:{href:"#wk-在alert-无法弹出时会出现-crash"}},[t._v("WK 在alert 无法弹出时会出现 Crash")])]),a("li",[a("a",{attrs:{href:"#wkuidelegate"}},[t._v("WKUIDelegate")])]),a("li",[a("a",{attrs:{href:"#wknavigationdelegate"}},[t._v("WKNavigationDelegate")]),a("ul",[a("li",[a("a",{attrs:{href:"#调用顺序分析"}},[t._v("调用顺序分析")])]),a("li",[a("a",{attrs:{href:"#关于错误回调"}},[t._v("关于错误回调")])]),a("li",[a("a",{attrs:{href:"#uiwebview-wkwebview-加载流程对比"}},[t._v("UIWebView/WKWebView 加载流程对比")])])])]),a("li",[a("a",{attrs:{href:"#useragent"}},[t._v("UserAgent")])]),a("li",[a("a",{attrs:{href:"#本地离线包加载"}},[t._v("本地离线包加载")]),a("ul",[a("li",[a("a",{attrs:{href:"#loadrequest"}},[t._v("loadRequest")])]),a("li",[a("a",{attrs:{href:"#loadfileurl-allowingreadaccesstourl"}},[t._v("loadFileURL:allowingReadAccessToURL:")])]),a("li",[a("a",{attrs:{href:"#设置wk跨域"}},[t._v("设置WK跨域")])]),a("li",[a("a",{attrs:{href:"#私有api拦截wk请求"}},[t._v("私有API拦截WK请求")])]),a("li",[a("a",{attrs:{href:"#wkurlschemehandler"}},[t._v("WKURLSchemeHandler")])])])]),a("li",[a("a",{attrs:{href:"#cookie问题"}},[t._v("Cookie问题")])]),a("li",[a("a",{attrs:{href:"#白屏问题"}},[t._v("白屏问题")]),a("ul",[a("li",[a("a",{attrs:{href:"#web页面url远程和本地"}},[t._v("Web页面URL远程和本地")])]),a("li",[a("a",{attrs:{href:"#web页面被kill时的两种情况"}},[t._v("Web页面被Kill时的两种情况")]),a("ul",[a("li",[a("a",{attrs:{href:"#web页面正在展示"}},[t._v("Web页面正在展示")])]),a("li",[a("a",{attrs:{href:"#web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中"}},[t._v("Web页面非当前展示页面，退到后台或在导航栈中非当前展示的VC中")])])])])])]),a("li",[a("a",{attrs:{href:"#estimatedprogress问题"}},[t._v("estimatedProgress问题")])]),a("li",[a("a",{attrs:{href:"#默认的跳转行为-打开-ituns、tel、mail、等其他scheme"}},[t._v("默认的跳转行为，打开 iTuns、tel、mail、等其他scheme")])])])]),a("li",[a("a",{attrs:{href:"#附录"}},[t._v("附录")])])])])])]),a("p"),t._v(" "),a("p",[t._v("[TOC]")]),t._v(" "),a("h1",{attrs:{id:"wk总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wk总结"}},[t._v("#")]),t._v(" WK总结")]),t._v(" "),a("h2",{attrs:{id:"wk类分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wk类分析"}},[t._v("#")]),t._v(" WK类分析")]),t._v(" "),a("p",[t._v("熟悉一个模块，先对内部所有类功能一个个熟悉，然后再跑个Demo各种验证功能，基本就差不多了。")]),t._v(" "),a("h3",{attrs:{id:"wkwebviewconfiguration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkwebviewconfiguration"}},[t._v("#")]),t._v(" WKWebViewConfiguration")]),t._v(" "),a("p",[t._v("WKWeb页面的各种配置项，用config来创建WK，一旦创建wk后，就不能再修改config")]),t._v(" "),a("h4",{attrs:{id:"wkpreferences"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkpreferences"}},[t._v("#")]),t._v(" WKPreferences")]),t._v(" "),a("p",[t._v("用于设置web view一些属性，字体大小、是否允许js等，作用不大")]),t._v(" "),a("h4",{attrs:{id:"wkusercontentcontroller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkusercontentcontroller"}},[t._v("#")]),t._v(" WKUserContentController")]),t._v(" "),a("p",[t._v("用与web页面进行JS通信和规则规律。该类主要由三个功能，向Web注入JS、与Web页面进行JS交互、按照设定的规则对Web页面进行过滤。"),a("strong",[t._v("注意，网上有资料说 WKWebViewConfiguration 存在不被释放的问题，具体这块要再研究下")])]),t._v(" "),a("h5",{attrs:{id:"wkuserscript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkuserscript"}},[t._v("#")]),t._v(" WKUserScript")]),t._v(" "),a("p",[t._v("WKUserScript，JS的抽象，用于OC向Web注入或移除JS")]),t._v(" "),a("h5",{attrs:{id:"与js交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与js交互"}},[t._v("#")]),t._v(" 与JS交互")]),t._v(" "),a("p",[t._v("用于JS向OC发送message，在OC中实现该协议，获取到到对应的message")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("WKScriptMessage")])]),t._v(" "),a("li",[a("p",[t._v("WKScriptMessageHandler协议")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" js中写法，替换name为自定义name，window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webkit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("messageHandlers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("messageBody"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" OC中实现WKScriptMessageHandler协议，收到的message会封装为 WKScriptMessage\n\n")])])])])]),t._v(" "),a("h5",{attrs:{id:"rulelist"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rulelist"}},[t._v("#")]),t._v(" RuleList")]),t._v(" "),a("p",[t._v("用来过滤网页的规则，iOS11引入，基本用不到")]),t._v(" "),a("ul",[a("li",[t._v("WKContentRuleList")]),t._v(" "),a("li",[t._v("WKContentRuleListStore")])]),t._v(" "),a("p",[t._v("相关资料：")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/8af24e9dc82e",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 11：WKWebView内容过滤规则详解"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://developer.apple.com/documentation/safariservices/creating_a_content_blocker?language=objc",target:"_blank",rel:"noopener noreferrer"}},[t._v("Creating a Content Blocker"),a("OutboundLink")],1),t._v("   官方文档，介绍了过滤的规则")])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://developer.apple.com/videos/play/wwdc2017/220/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WWDC 17：customized_loading_in_wkwebview"),a("OutboundLink")],1)])])]),t._v(" "),a("h4",{attrs:{id:"wkwebsitedatastore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkwebsitedatastore"}},[t._v("#")]),t._v(" WKWebsiteDataStore")]),t._v(" "),a("p",[t._v("用于管理 Cookies, session storage, local storage, WebSQL, IndexedDB等Web存储相关。")]),t._v(" "),a("p",[t._v("相关类有：")]),t._v(" "),a("ul",[a("li",[t._v("WKWebsiteDataRecord，对数据类型的抽象，只有两个属性\n"),a("ul",[a("li",[t._v("displayName，键值")]),t._v(" "),a("li",[t._v("dataTypes，数据类型")])])]),t._v(" "),a("li",[t._v("WKHTTPCookieStore，从iOS11开始引入，用于WK管理Cookie")])]),t._v(" "),a("h4",{attrs:{id:"suppressesincrementalrendering"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#suppressesincrementalrendering"}},[t._v("#")]),t._v(" suppressesIncrementalRendering")]),t._v(" "),a("p",[t._v("是否在所有的数据加载到内存中才开始渲染，默认为 NO，目前感觉作用不大。")]),t._v(" "),a("h4",{attrs:{id:"mediatypesrequiringuseractionforplayback-ios10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mediatypesrequiringuseractionforplayback-ios10"}},[t._v("#")]),t._v(" mediaTypesRequiringUserActionForPlayback(iOS10)")]),t._v(" "),a("p",[t._v("类似 UIWEBVIEW的 mediaPlaybackRequiresUserAction（默认值是 true） ，但是修改成了 type类型，默认是none，即不需要。iOS 9- 10 用 "),a("strong",[t._v("requiresUserActionForMediaPlayback")]),t._v(" 属性，默认是NO，即不需要")]),t._v(" "),a("h4",{attrs:{id:"allowsinlinemediaplayback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#allowsinlinemediaplayback"}},[t._v("#")]),t._v(" allowsInlineMediaPlayback")]),t._v(" "),a("p",[t._v("是否允许内敛播放，默认NO")]),t._v(" "),a("h4",{attrs:{id:"selectiongranularity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selectiongranularity"}},[t._v("#")]),t._v(" selectionGranularity")]),t._v(" "),a("p",[t._v("网页交互中选择内容的粒度。(自动变化/任何字符串边界)")]),t._v(" "),a("h4",{attrs:{id:"datadetectortypes-ios10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#datadetectortypes-ios10"}},[t._v("#")]),t._v(" dataDetectorTypes  （iOS10）")]),t._v(" "),a("p",[t._v("默认值是 WKDataDetectorTypeNone ，我们工程没有设置，这些可通过 meta自动添加 "),a("code",[t._v('<meta name="format-detection" content="telephone=no,email=no,adress=no">')])]),t._v(" "),a("h4",{attrs:{id:"ignoresviewportscalelimits"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ignoresviewportscalelimits"}},[t._v("#")]),t._v(" ignoresViewportScaleLimits")]),t._v(" "),a("p",[t._v("是否禁止用户对web页面缩放，如果设置为true则禁止用户缩放页面，会会略 user-scalable 设置；默认值为false，受 "),a("code",[t._v('<meta name="viewport" content="user-scalable=no"/>')]),t._v(" 里面的 user-scalable 控制")]),t._v(" "),a("h4",{attrs:{id:"wkurlschemehandler-ios11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkurlschemehandler-ios11"}},[t._v("#")]),t._v(" WKURLSchemeHandler ( iOS11)")]),t._v(" "),a("p",[t._v("离线资源加载，只对对自定义的协议拦截，不能对http,https进行拦截")]),t._v(" "),a("p",[t._v("相关类：")]),t._v(" "),a("ul",[a("li",[t._v("WKURLSchemeHandler")]),t._v(" "),a("li",[t._v("WKWebViewConfiguration")]),t._v(" "),a("li",[t._v("WKURLSchemeTask")])]),t._v(" "),a("h3",{attrs:{id:"wknavigationaction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wknavigationaction"}},[t._v("#")]),t._v(" WKNavigationAction")]),t._v(" "),a("p",[t._v("对打开新web这个动作的抽象")]),t._v(" "),a("h4",{attrs:{id:"属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("ul",[a("li",[t._v("sourceFrame")]),t._v(" "),a("li",[t._v("targetFrame")]),t._v(" "),a("li",[t._v("navigationType")]),t._v(" "),a("li",[t._v("request")])]),t._v(" "),a("h4",{attrs:{id:"相关类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关类"}},[t._v("#")]),t._v(" 相关类")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("WKFrameInfo")]),t._v("，对frame的一个抽象，比如 一个"),a("iframe",[t._v("标签就对应一个单独的 WKFrameInfo")])]),t._v(" "),a("li",[a("strong",[t._v("WKNavigationType")]),t._v("，动作的类型，比如 "),a("code",[t._v("<a href target='_blank'>")]),t._v("就是WKNavigationTypeLinkActivated；"),a("code",[t._v("window.open")]),t._v(" 就是 WKNavigationTypeOther")])]),t._v(" "),a("h3",{attrs:{id:"wkuidelegate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkuidelegate"}},[t._v("#")]),t._v(" WKUIDelegate")]),t._v(" "),a("p",[t._v("UI协议，用于处理 JS中 alert,confirm,prompt方法的展示，如果不实现相关协议，对应方法会无响应。注，在UIWebView中，这些是自动处理的。")]),t._v(" "),a("h4",{attrs:{id:"相关方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关方法"}},[t._v("#")]),t._v(" 相关方法")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("createWebViewWithConfiguration")]),t._v("，处理 _blank的情况，如果不实现该方法，则WK不会响应_blank的情况")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 针对以下两种 _blank的情况，如果不实现该方法，以下两种行为会失效，即不会加载新页面")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("a href"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.qq.com"')]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_blank"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("QQ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.qq.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_blank'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("runJavaScriptAlertPanelWithMessage")]),t._v("，当JS 调用 alert()时候会触发该方法，如果不实现则会无响应")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("runJavaScriptConfirmPanelWithMessage")]),t._v("，当JS调用 confirm()时候会触发该方法，如果不实现则会无响应")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("runJavaScriptTextInputPanelWithPrompt")]),t._v("，当JS调用 prompt(message,default) 时会触发该方法，如果不实现会无反应")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("webViewDidClose:")]),t._v("，JS 调用 "),a("code",[t._v("window.close ();")]),t._v(" 会触发该方法")])])]),t._v(" "),a("h4",{attrs:{id:"相关类-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关类-2"}},[t._v("#")]),t._v(" 相关类")]),t._v(" "),a("ul",[a("li",[t._v("WKWindowFeatures，当新的wk被请求的时候，展示一些额外的属性，包括statusbar, toolbar, menubar的一些状态，但都是readonly的")])]),t._v(" "),a("h3",{attrs:{id:"wknavigationdelegate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wknavigationdelegate"}},[t._v("#")]),t._v(" WKNavigationDelegate")]),t._v(" "),a("p",[t._v("一个非常重要的协议，webview加载各个阶段的代理方法。")]),t._v(" "),a("h4",{attrs:{id:"协议方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议方法"}},[t._v("#")]),t._v(" 协议方法")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("decidePolicyForNavigationAction")]),t._v("，在发送请求之前决定是否跳转")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didStartProvisionalNavigation")]),t._v("，页面开始加载时调用")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("decidePolicyForNavigationResponse")]),t._v("，在收到响应后决定是否跳转")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didCommitNavigation")]),t._v("，当内容开始返回时调用")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didFinishNavigation")]),t._v("，页面加载完成之后调用")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didFailNavigation")]),t._v("，启动时加载数据发生错误就会调用这个方法")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didFailProvisionalNavigation:withError:")]),t._v("，当一个正在提交的页面在跳转过程中出现错误时调用这个方法")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didReceiveServerRedirectForProvisionalNavigation")]),t._v("，接收到服务器跳转请求之后调用")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("didReceiveAuthenticationChallenge")]),t._v("，证书 认证相关")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("webViewWebContentProcessDidTerminate")]),t._v("，当wk进程即将被杀死的时候会调用，比如内存过高的时候，但是有文章说也有部分情况不会调用。一般在此方法内调用 webview reload")])])]),t._v(" "),a("h4",{attrs:{id:"相关类-协议-枚举"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关类-协议-枚举"}},[t._v("#")]),t._v(" 相关类/协议/枚举")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("WKNavigationAction")])]),t._v(" "),a("li",[a("strong",[t._v("WKNavigation")]),t._v("，无属性方法，官方说法是为了跟踪web的加载过程，作为唯一标示")]),t._v(" "),a("li",[a("strong",[t._v("WKNavigationResponse")]),t._v("，用于 decidePolicyForNavigationResponse")]),t._v(" "),a("li",[a("strong",[t._v("WKNavigationActionPolicy")])]),t._v(" "),a("li",[a("strong",[t._v("WKNavigationResponsePolicy")])])]),t._v(" "),a("h3",{attrs:{id:"wkbackforwardlist"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkbackforwardlist"}},[t._v("#")]),t._v(" WKBackForwardList")]),t._v(" "),a("p",[t._v("用于页面前进后退管理，比较简单")]),t._v(" "),a("h4",{attrs:{id:"相关类-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关类-3"}},[t._v("#")]),t._v(" 相关类")]),t._v(" "),a("ul",[a("li",[t._v("WKBackForwardListItem")])]),t._v(" "),a("h3",{attrs:{id:"wkprocesspool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkprocesspool"}},[t._v("#")]),t._v(" WKProcessPool")]),t._v(" "),a("p",[t._v("web的进程池，多个web共享一个进程池，可以共享cookie、用户凭证等，但是苹果文档支出，如果一个进程池的web到达上限后，新的web会分配到新的进程池里，但是这个上限并没有说多少。")]),t._v(" "),a("p",[t._v("该类在iOS11之前应该是很有用的，为了共享Cookie（把该类设置成单例，然后分配给WK），但是11之后，wk有了自己的cookie管理，似乎作用不到了。")]),t._v(" "),a("p",[t._v("具体还要再研究下")]),t._v(" "),a("h3",{attrs:{id:"部分重要方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部分重要方法"}},[t._v("#")]),t._v(" 部分重要方法")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("estimatedProgress")]),t._v("，页面加载进度，可以KVO")]),t._v(" "),a("li",[a("strong",[t._v("evaluateJavaScript")]),t._v("，可以向页面注入JS方法执行")]),t._v(" "),a("li",[a("strong",[t._v("takeSnapshotWithConfiguration")]),t._v("，获取wk可见区域的视图，iOS11引入")]),t._v(" "),a("li",[a("strong",[t._v("allowsBackForwardNavigationGestures")]),t._v("，是否允许右滑手势，默认是NO。设置为YES后，右滑会打开上个Web页面，体验与Native类似")]),t._v(" "),a("li",[a("strong",[t._v("allowsLinkPreview")]),t._v("，是否允许预览,10及其以后默认值是YES之前是NO，如果设置YES,用户点击会跳转到Safari")])]),t._v(" "),a("h2",{attrs:{id:"类结构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类结构图"}},[t._v("#")]),t._v(" 类结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:"WKClass.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"工程实践注意点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工程实践注意点"}},[t._v("#")]),t._v(" 工程实践注意点")]),t._v(" "),a("h3",{attrs:{id:"wkscriptmessagehandler协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkscriptmessagehandler协议"}},[t._v("#")]),t._v(" WKScriptMessageHandler协议")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//苹果在 WKWebView 中的 js runtime 里事先注入了一个 window.webkit.messageHandlers.OOXX.postMessage() 方法，我们可以使用这个方法直接向 Native 层传值，异常方便")]),t._v("\n\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Demo：")]),t._v("\n    JS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n在JS中使用window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webkit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("messageHandlers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TEST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("向APP传值\n\n    OC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nfunc "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("userContentController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userContentController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" WKUserContentController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" didReceiveScriptMessage message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" WKScriptMessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//根据定义的key来判断message")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TEST"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//转换为字典,并获取key/value")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" let dic "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body as"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" NSDictionary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"blank情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blank情况"}},[t._v("#")]),t._v(" _blank情况")]),t._v(" "),a("p",[t._v("JS中使用_blank打开新页面的情况有两种：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('<a href="https://www.qq.com" target="_blank">QQ</a>')])]),t._v(" "),a("li",[a("code",[t._v("window.open ('https://www.qq.com', '_blank’)")])])]),t._v(" "),a("p",[t._v("当以上两种情况使用 _blank 需要新开页面的情况，如果WK不实现相关代理方法，则WK会无响应。")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//示例代码")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("pragma")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("mark "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" WKUIDelegate")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n 处理：_blank的情况，如果不实现该方法，则WK不会响应_blank的情况\n <a href=\"https://www.qq.com\" target=\"_blank\">QQ</a>   ，对应 WKNavigationAction.navigationType == WKNavigationTypeLinkActivated\n window.open ('https://www.qq.com', '_blank');  对应 WKNavigationAction.navigationType == WKNavigationTypeOther\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable WKWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView createWebViewWithConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWebViewConfiguration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("configuration forNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKNavigationAction "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("navigationAction windowFeatures"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWindowFeatures "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("windowFeatures"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对于加载新连接的情况是 navigationAction.sourceFrame = xxxx, navigationAction.targetFrame = nil")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("navigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("targetFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isMainFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//感觉这里判断的意义不大，测试了 href, window.open, iframe 里面的href 和 open, 对应的 target 都为 nil，且该方法只会走一次，已知的两种情况targetFrame都为nil ，u不知道有没其他情况")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("webView loadRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("navigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("网上还有一种方案是说，用 WKNavigationDelegate 的 decidePolicyForNavigationAction，该方法是当加载任一url的时候都会加载 ，"),a("strong",[t._v("但是这个方法只有 href 的情况调用，当Js调用 windows.open 的时候 不会调用")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("pragma")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("mark "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" WKNavigationDelegate")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*\n \n 这个方法是加载任意url都会先走这个方法，\n <a href="" target="_blank> 的情况会走该方法，\n windown.open(url,\'_blank")则不会先走，如果不实现 createWebViewWithConfiguration ，则会无响应\n \n 第一打开web\n navigationAction.sourceFrame = nil\n navigationAction.targetFrame = xxxxx\n \n 加载其他链接\n navigationAction.sourceFrame = xxxxx\n navigationAction.targetFrame = nil\n \n navigationAction.sourceFrame = nil\n navigationAction.targetFrame = yyyyy\n \n \n */')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKNavigationAction "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("navigationAction decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKNavigationActionPolicy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果是跳转一个新页面")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("targetFrame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("webView loadRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("navigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decisionHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKNavigationActionPolicyAllow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"wk-在alert-无法弹出时会出现-crash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wk-在alert-无法弹出时会出现-crash"}},[t._v("#")]),t._v(" WK 在alert 无法弹出时会出现 Crash")]),t._v(" "),a("p",[t._v("详见 "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 那些坑    Bugly"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"wkuidelegate-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkuidelegate-2"}},[t._v("#")]),t._v(" WKUIDelegate")]),t._v(" "),a("p",[t._v("WKUIDelegate 的几个回调需要处理，否则 JS的 "),a("em",[t._v("alert()")]),t._v("、"),a("em",[t._v("confirm()")]),t._v("、"),a("em",[t._v("prompt(message,default)")]),t._v(" 方法会无响应。")]),t._v(" "),a("p",[t._v("其中 "),a("code",[t._v("webViewDidClose:")]),t._v("可以不用处理，该回调对应 js 的 *window.close ()*方法。 目前似乎没有这个场景，window.close()是针对使用 window.open() 打开的页面，目前这种写法比较少。")]),t._v(" "),a("div",{staticClass:"language-objective-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n#pragma mark - WKUIDelegate\n\n\n/*\n 处理：_blank的情况，如果不实现该方法，则WK不会响应_blank的情况\n <a href="https://www.qq.com" target="_blank">QQ</a>   ，对应 WKNavigationAction.navigationType == WKNavigationTypeLinkActivated\n window.open (\'https://www.qq.com\', \'_blank\');  对应 WKNavigationAction.navigationType == WKNavigationTypeOther\n */\n- (nullable WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures{\n    //对于加载新连接的情况是 navigationAction.sourceFrame = xxxx, navigationAction.targetFrame = nil\n    if (!navigationAction.targetFrame.isMainFrame) {        //感觉这里判断的意义不大，测试了 href, window.open, iframe 里面的href 和 open, 对应的 target 都为 nil，且该方法只会走一次，已知的两种情况targetFrame都为nil ，不知道有没其他情况\n        [webView loadRequest:navigationAction.request];\n    }\n    return nil;\n}\n\n/*\n js 调用 window.close (); 会触发该方法，官方文档说：\n Your app should remove the web view from the view hierarchy and update the UI as needed, for instance by closing the containing browser tab or window.\n 但是目前似乎没有这个场景，window.close()是针对使用 window.open() 打开的页面，似乎 这种写法比较少\n 该代理暂时不处理\n \n */\n//- (void)webViewDidClose:(WKWebView *)webView API_AVAILABLE(macosx(10.11), ios(9.0)){\n//\n//}\n\n//当JS 调用 alert()时候会触发该方法，如果不实现则会无响应\n- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler{\n    \n    UIAlertController *alert = [UIAlertController alertControllerWithTitle:message\n                                                                   message:nil\n                                                            preferredStyle:UIAlertControllerStyleAlert];\n    UIAlertAction *action = [UIAlertAction actionWithTitle:@"确定"\n                                                     style:UIAlertActionStyleDefault\n                                                   handler:^(UIAlertAction * _Nonnull action) {\n                                                       completionHandler();\n                                                   }];\n    [alert addAction:action];\n    [self.currentVC presentViewController:alert animated:YES completion:nil];\n}\n\n//当JS调用 confirm()时候会触发该方法，如果不实现则会无响应\n- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL result))completionHandler{\n    UIAlertController *alert = [UIAlertController alertControllerWithTitle:message\n                                                                   message:nil\n                                                            preferredStyle:UIAlertControllerStyleAlert];\n    UIAlertAction *sure = [UIAlertAction actionWithTitle:@"确定"\n                                                   style:UIAlertActionStyleDefault\n                                                 handler:^(UIAlertAction * _Nonnull action) {\n                                                     completionHandler(YES);\n                                                 }];\n    UIAlertAction *cacle = [UIAlertAction actionWithTitle:@"取消"\n                                                    style:UIAlertActionStyleCancel\n                                                  handler:^(UIAlertAction * _Nonnull action) {\n                                                      completionHandler(NO);\n                                                  }];\n    \n    [alert addAction:sure];\n    [alert addAction:cacle];\n    [self.currentVC presentViewController:alert animated:YES completion:nil];\n}\n\n/*\n 当JS调用 prompt(message,default) 时会触发该方法，如果不实现会无反应，注意 defaultd参数无textfiled的默认值不是placeHolder\n 注意点，在action的handler里是不能直接饮用 UIAlertController 的，否则会造成循环引用。网上的例子多是直接引用，是不对的\n */\n- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(nullable NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * _Nullable result))completionHandler{\n    UIAlertController *alert = [UIAlertController alertControllerWithTitle:prompt\n                                                                   message:nil\n                                                            preferredStyle:UIAlertControllerStyleAlert];\n    \n    __weak typeof(alert) weakAlert = alert;\n    UIAlertAction *sure = [UIAlertAction actionWithTitle:@"确定"\n                                                   style:UIAlertActionStyleDefault\n                                                 handler:^(UIAlertAction * _Nonnull action) {\n                                                     //                                                       网上例子大多是直接饮用alert，这里直接引用alert是会造成 UIAlertController 泄露的，理论实践都验证了\n                                                     //                                                     completionHandler(alert.textFields.firstObject.text);\n                                                     completionHandler(weakAlert.textFields.firstObject.text);\n                                                 }];\n    UIAlertAction *cacle = [UIAlertAction actionWithTitle:@"取消"\n                                                    style:UIAlertActionStyleCancel\n                                                  handler:^(UIAlertAction * _Nonnull action) {\n                                                      completionHandler(nil);\n                                                  }];\n    [alert addTextFieldWithConfigurationHandler:^(UITextField * _Nonnull textField) {\n        textField.text = defaultText;\n    }];\n    \n    [alert addAction:sure];\n    [alert addAction:cacle];\n    [self.currentVC presentViewController:alert animated:YES completion:nil];\n}\n\n')])])]),a("h3",{attrs:{id:"wknavigationdelegate-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wknavigationdelegate-2"}},[t._v("#")]),t._v(" WKNavigationDelegate")]),t._v(" "),a("h4",{attrs:{id:"调用顺序分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用顺序分析"}},[t._v("#")]),t._v(" 调用顺序分析")]),t._v(" "),a("p",[t._v("不存在iframe时的web调用顺序")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//不存在iframe时的调用顺序")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didStartProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didCommitNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didFinishNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),a("p",[t._v("当页面存在一个iframe标签时调用顺序为")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当页面存在一个iframe时调用顺序为：")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    （URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/）")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didStartProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didCommitNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这里会多出这两次调用，用于加载iframe")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    （URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/sencond.html）")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didFinishNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),a("p",[t._v("当有两个 iframe时的调用顺序，即对iframe会一次性调用 "),a("code",[t._v("decidePolicyForNavigationAction")]),t._v(" ，然后再一次性调用"),a("code",[t._v("decidePolicyForNavigationResponse")])]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当有两个 iframe时的调用顺序，即对iframe会一次性调用 decidePolicyForNavigationAction ，然后再一次性调用decidePolicyForNavigationResponse")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didStartProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didCommitNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/sencond.html")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/thrid.html")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/sencond.html")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.100:8005/thrid.html")]),t._v("\n\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didFinishNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),a("p",[t._v("如果在 decidePolicyForNavigationAction 中选择cancel，调用顺序")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果在 decidePolicyForNavigationAction 中选择cancel，调用顺序")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),a("p",[t._v("如果在 decidePolicyForNavigationResponse 里选择 cancel的调用顺序，最后会调用fail")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果在 decidePolicyForNavigationResponse 里选择 cancel的调用顺序，最后会调用fail")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didStartProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didFailProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("withError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),a("h4",{attrs:{id:"关于错误回调"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于错误回调"}},[t._v("#")]),t._v(" 关于错误回调")]),t._v(" "),a("p",[t._v("WK错误回调有两个：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("webView:didFailProvisionalNavigation:withError:")]),t._v(" ，启动时加载数据发生错误就会调用这个方法")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("webView:didFailNavigation:withError:")]),t._v("，当一个正在提交的页面在跳转过程中出现错误时调用这个方法 ，例如在didCommitNavigation这个代理方法中调用webview的stopLoading方法，但是具体还有点不清楚")])])]),t._v(" "),a("p",[t._v("具体区别还没搞清楚，现在测试如果页面加载失败，比如关掉nginx的情况，会调用 didFailProvisionalNavigation")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[t._v("webView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decidePolicyForNavigationAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("decisionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//192.168.1.110/")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didStartProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nwebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("didFailProvisionalNavigation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("withError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("h4",{attrs:{id:"uiwebview-wkwebview-加载流程对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uiwebview-wkwebview-加载流程对比"}},[t._v("#")]),t._v(" UIWebView/WKWebView 加载流程对比")]),t._v(" "),a("p",[t._v("WK的回调更加细分，方便精细度控制")]),t._v(" "),a("p",[a("img",{attrs:{src:e(457),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"useragent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#useragent"}},[t._v("#")]),t._v(" UserAgent")]),t._v(" "),a("p",[t._v("WK新增了两种设置UA的方法")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("WKWebViewConfiguration.applicationNameForUserAgent")]),t._v("，这个会对默认的UA值设备信息部分进行替换")]),t._v(" "),a("li",[a("code",[t._v("WKWebView.customUserAgent")]),t._v("，设置这个值会完全覆盖UA值")])]),t._v(" "),a("p",[t._v("示例")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WK")]),t._v("\nDefaults User"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \nMozilla"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iPhone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" CPU iPhone OS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("_4 like Mac OS X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AppleWebKit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("605.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".15")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("KHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" like Gecko"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Mobile"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15E148")]),t._v("\n\nWKWebViewConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("applicationNameForUserAgent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    TestUA\nMozilla"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iPhone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" CPU iPhone OS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("_4 like Mac OS X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" AppleWebKit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("605.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".15")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("KHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" like Gecko"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" TestUA\n\nWKWebView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("customUserAgent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    TestUA\nUser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TestUA\n\n")])])]),a("p",[t._v("设置全局UA方法：")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[t._v("WKWebView  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("wkWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WKWebView alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initWithFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("CGRectZero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wkWebView evaluateJavaScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"navigator.userAgent"')]),t._v(" completionHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id  _nullable result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" _nullable error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      \n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1）获取默认userAgent：")]),t._v("\n   NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("oldUA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//直接获取为nil ")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2）设置userAgent：添加额外的信息   ")]),t._v("\n  NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("newUA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSString stringWithFormat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"%@ crfapp/(%@)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldUA "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"ios;43"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n  NSDictionary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("dictNU "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSDictionary dictionaryWithObjectsAndKeys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("newUA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"UserAgent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSUserDefaults standardUserDefaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" registerDefaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("dictNU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注：WKWebView  调用evaluateJavaScript方法获取UA或者设置UA时，需执行loadRequest方法，否则completionHandler result值为空。但是经过测试，是可以拿到的，估计部分系统有该问题")]),t._v("\n\nNSURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSURL URLWithString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h5Url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nNSURLRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSURLRequest requestWithURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("url\n                                             cachePolicy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSURLRequestUseProtocolCachePolicy\n                                         timeoutInterval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wkWebView loadRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("经过测试，"),a("strong",[t._v("UA的优先级为：WKWebView.customUserAgent > 全局设置 > applicationNameForUserAgent")])]),t._v(" "),a("p",[a("strong",[t._v("注意，WK全局设置UA，由于是异步，回调可能比较晚，App启动第一次可能回调还没回来，所以UA可能会失效。可直接使用UIWebView设置UA，并设置WK的 applicationNameForUserAgent或customUserAgent，用来防止UA失去自定义节点。")])]),t._v(" "),a("h3",{attrs:{id:"本地离线包加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地离线包加载"}},[t._v("#")]),t._v(" 本地离线包加载")]),t._v(" "),a("h4",{attrs:{id:"loadrequest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loadrequest"}},[t._v("#")]),t._v(" loadRequest")]),t._v(" "),a("p",[t._v("真机不能使用loadRequest，无法加载本地页面，但是模拟器可以")]),t._v(" "),a("h4",{attrs:{id:"loadfileurl-allowingreadaccesstourl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loadfileurl-allowingreadaccesstourl"}},[t._v("#")]),t._v(" "),a("strong",[t._v("loadFileURL:allowingReadAccessToURL:")])]),t._v(" "),a("p",[t._v("NSURL 必须是file协议，否则会无法加载")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("NSURL *url = [NSURL fileURLWithPath:fragment]")]),t._v(" 方法会对#等参数进行编码，导致无法识别。所以有两种解决方法：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("手动拼接 "),a("code",[t._v("file://")]),t._v("，不使用 "),a("code",[t._v("fileURLWithPath:")]),t._v("方法")])]),t._v(" "),a("li",[a("p",[t._v("使用 NSURLComponents方法，对query和fragmetn进行设置")]),t._v(" "),a("div",{staticClass:"language-objective-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n            NSURLComponents *test = [NSURLComponents componentsWithURL:url resolvingAgainstBaseURL:nil];\n            test.fragment = @"/list";\n            [test setQueryItems:@[[NSURLQueryItem queryItemWithName:@"data" value:@"3333"]]];\n            [self.webView loadFileURL:test.URL allowingReadAccessToURL:[NSURL fileURLWithPath:document]];\n\n\n')])])])])]),t._v(" "),a("h4",{attrs:{id:"设置wk跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置wk跨域"}},[t._v("#")]),t._v(" 设置WK跨域")]),t._v(" "),a("p",[t._v("另外需要注意，必须设置WK跨域，否则会无法加载本地包")]),t._v(" "),a("div",{staticClass:"language-objective-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('    [configuration.preferences setValue:@YES forKey:@"allowFileAccessFromFileURLs"];\n    if (@available(iOS 10.0, *)) {\n        [configuration setValue:@YES forKey:@"allowUniversalAccessFromFileURLs"];\n    }\n}\n')])])]),a("p",[t._v("###拦截WKWebView请求")]),t._v(" "),a("h4",{attrs:{id:"私有api拦截wk请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#私有api拦截wk请求"}},[t._v("#")]),t._v(" 私有API拦截WK请求")]),t._v(" "),a("p",[t._v("基于UIWebView可以自由做拦截，然后做资源缓存等处理，但是WK无法通过 NSURLProtocol 做拦截，资源缓存这块比较难处理。")]),t._v(" "),a("p",[t._v("WK的请求其实是可以拦截的，通过一个私有API "),a("code",[t._v("[WKBrowsingContextController registerSchemeForCustomProtocol:]")]),t._v("，但是这种方案有两个问题：")]),t._v(" "),a("ul",[a("li",[t._v("Web页面的POST请求body体会被清空")]),t._v(" "),a("li",[t._v("对ATS支持不足，Allow Arbitrary Loads 选项设置为NO 下，一旦拦截后，WK发起的http网络请求会被阻塞。不过这块设置为YES即可。")])]),t._v(" "),a("p",[t._v("针对第一个问题，其实网上有一个方案可以绕过，大致思路是：")]),t._v(" "),a("ol",[a("li",[t._v("Hook Ajax请求，Web页面的Ajax请求全部通过Native转发")]),t._v(" "),a("li",[t._v("通过私有API拦截WK请求，由于Ajax请求已经被Hook，剩下的请求一般都是图片等资源请求，不存在body体的情况，可以拦截后做本地缓存等处理。")])]),t._v(" "),a("p",[t._v("不过需要注意点，目前似乎只能做到Hook Ajax请求，还无法做到Hook fetch请求。如果Web页面有post的fetch请求，请求会失败。还有文章提出Hook Ajax可能存在 "),a("strong",[t._v("post header字符长度限制")]),t._v(" 、"),a("strong",[t._v("Put类型请求异常")]),t._v("等情况。")]),t._v(" "),a("p",[t._v("具体可参考：")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/wendux/Ajax-hook",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ajax-hook"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/karosLi/KKJSBridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("KKJSBridge"),a("OutboundLink")],1)])])]),t._v(" "),a("p",[t._v("还有一个技巧，可通过搭建locak web server的形式来加载本地包，不过个人感觉这块目前意义不大，具体可参考 "),a("a",{attrs:{href:"https://juejin.im/entry/599e500e6fb9a0249174fa31",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于 LocalWebServer 实现 WKWebView 离线资源加载"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"wkurlschemehandler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wkurlschemehandler"}},[t._v("#")]),t._v(" WKURLSchemeHandler")]),t._v(" "),a("p",[t._v("作用与NSURLProtocol类似，可以拦截网络请求，但是只能拦截WK中自定义协议，一般使用 WKURLSchemeHandler 实现的 WKWebView 离线资源加载。"),a("strong",[t._v("WKURLSchemeHandler 最好的场景还是用在加载本地图片上，其它方面不稳定，慎用")]),t._v("。")]),t._v(" "),a("p",[t._v("WKURLSchemeHandler 是 iOS11 就推出的，用于处理自定义请求的方案，不过并不能处理 HTTP、HTTPS 等常规 scheme。")]),t._v(" "),a("div",{staticClass:"language-objc extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//相关代码")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WKURLSchemeHandler")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView startURLSchemeTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WKURLSchemeTask"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlSchemeTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKWebView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("webView stopURLSchemeTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WKURLSchemeTask"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlSchemeTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WKWebViewConfiguration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注册 schemeHandle， You can use +[WKWebView handlesURLScheme:] to check the availability of a given URL scheme.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("setURLSchemeHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WKURLSchemeHandler"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlSchemeHandler forURLScheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlScheme "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("API_AVAILABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("macosx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ios")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取当前 schemeHandle 示例")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WKURLSchemeHandler"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlSchemeHandlerForURLScheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlScheme "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("API_AVAILABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("macosx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ios")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WKWebView")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断  urlScheme 是否可以用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("handlesURLScheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("urlScheme "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("API_AVAILABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("macosx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ios")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WKURLSchemeTask")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" readonly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" NSURLRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("didReceiveResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSURLResponse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("didReceiveData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("didFinish"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("didFailWithError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("参考资料：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/VcvZ1C1Qs26v5iB8dwBjcw",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKURLSchemeHandler 的能与不能"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/hite/AppHost",target:"_blank",rel:"noopener noreferrer"}},[t._v("AppHost"),a("OutboundLink")],1),t._v("   一个 native 和 h5 通讯的框架，支持调试")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/videos/play/wwdc2017/220/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WWDC 2017 Customized Loading in WKWebView"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/pengyuan_D/article/details/89958936",target:"_blank",rel:"noopener noreferrer"}},[t._v("思考 NSURLProtocol 无法拦截 WKWebview 请求的解决思路"),a("OutboundLink")],1),t._v(" ，在本篇文章中，使用了私有api，hook wk，从而拦截http, https请求，（不过 iOS 12.2 上该方法已经失效，不存在此属性，详见 "),a("a",{attrs:{href:"https://nemocdz.github.io/post/ios-%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86proxy%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 设置代理（Proxy）方案总结"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"cookie问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie问题"}},[t._v("#")]),t._v(" Cookie问题")]),t._v(" "),a("p",[t._v("WK的软肋之一就是Cookie问题，"),a("strong",[t._v("Cookie问题的核心就是 WKWebview 与 NSHTTPCookieStorage 的Cookie不共享")]),t._v("。")]),t._v(" "),a("p",[t._v("WK在 iOS11 推出了 WKHTTPCookieStore 管理Cookie，基本解决了Cookie软肋的问题。不过依然无法做到与Native请求共享Cookie，如果共享需要手动处理。")]),t._v(" "),a("p",[t._v("鉴于工程实际情况，对WK的Cooike做了以下处理：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建一个 WKProcessPool 的单例，WK共享该 WKProcessPool，使不同WK共享WK")])]),t._v(" "),a("li",[a("p",[t._v("对iOS11 以下的情况，针对首次request主动携带 NSHTTPCookieStorage 里的Cookie")]),t._v(" "),a("div",{staticClass:"language-objective-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('NSArray<NSHTTPCookie *> *availableCookie = [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookiesForURL:request.URL];\n                    if (availableCookie.count > 0) {\n                        NSDictionary *reqHeader = [NSHTTPCookie requestHeaderFieldsWithCookies:availableCookie];\n                        NSString *cookieStr = [reqHeader objectForKey:@"Cookie"];\n                        \n                        muRequest = [request mutableCopy];\n                        [(NSMutableURLRequest *)muRequest setValue:cookieStr forHTTPHeaderField:@"Cookie"];\n                    }\n[webView loadRequest:muRequest];\n')])])])]),t._v(" "),a("li",[a("p",[t._v("其他情况，无业务需求，暂不做处理。Cookie这块比较复杂，看的脑壳疼，目前基于工程现状，不需要做到")])])]),t._v(" "),a("p",[t._v("NSHTTPCookieStorage 与 WK的同步，具体有需要再处理。")]),t._v(" "),a("p",[t._v("不同工程注意点不一样，这块具体可以参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://xiaozhuanlan.com/topic/5743162890",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 你爬出来了吗？"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.geniusqyu.com/2018/12/02/WKWebView-cookie-%E9%97%AE%E9%A2%98/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView Cookie 问题"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/entry/5975916e518825594d23d777",target:"_blank",rel:"noopener noreferrer"}},[t._v("教你使用 WKWebView 的正确姿势"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 那些坑    Bugly"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/ac45d99cf912",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（上）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/870dba42ec15",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（中）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/52668d5b2e68",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（下）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzA5NzMwODI0MA==&mid=2647764511&idx=1&sn=eb792ed468a13239926641c9dd7091e2&chksm=8887d520bff05c36484ed8a9a0731014c93a94ac0d7d9f944c9470cad48d1f21ec0dccc552a7&mpshare=1&scene=1&srcid=&sharer_sharetime=1567467597976&sharer_shareid=c38ca2f3cbd21853ce550074313749fc%23rd",target:"_blank",rel:"noopener noreferrer"}},[t._v("一站式解决WKWebView各类问题"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"白屏问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#白屏问题"}},[t._v("#")]),t._v(" 白屏问题")]),t._v(" "),a("p",[t._v("在 "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 那些坑    Bugly"),a("OutboundLink")],1),t._v(" 中有提到白屏问题，WK是独立的进程，当系统内存过高时，可能会Kill掉WK进程，造成白屏问题。文中的做法是在 "),a("code",[t._v("webViewWebContentProcessDidTerminate:")]),t._v(" 回调中执行 "),a("code",[t._v("reload")]),t._v("。")]),t._v(" "),a("p",[t._v("在接入实际过程中，发现我们工程中简单的执行reload会有以下几个问题：")]),t._v(" "),a("ul",[a("li",[t._v("页面非当前展示页面时，即使调用reload，系统依然会再次kill掉页面，会造成频繁kill，频繁reload，消耗性能")]),t._v(" "),a("li",[t._v("file协议的本地Web页面，执行reload会报错："),a("code",[t._v('*Error Domain=kCFErrorDomainCFNetwork Code=1 "(null)" UserInfo={_NSURLErrorFailingURLSessionTaskErrorKey=LocalDataTask*')])])]),t._v(" "),a("h4",{attrs:{id:"web页面url远程和本地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web页面url远程和本地"}},[t._v("#")]),t._v(" Web页面URL远程和本地")]),t._v(" "),a("ol",[a("li",[t._v("http/https，http类型的可以执行 "),a("code",[t._v("reload")])]),t._v(" "),a("li",[t._v("file（即本地包），file协议的必须要执行 "),a("code",[t._v("loadFileURL:allowingReadAccessToURL:")]),t._v(" 才能正常加载。这里需要注意，如果WK正常展示过程中调用 "),a("code",[t._v("reload")]),t._v("是可以正常刷新的。但是在 "),a("code",[t._v("webViewWebContentProcessDidTerminate:")]),t._v(" 函数中调用"),a("code",[t._v("reload")]),t._v("会报错，即被Terminated后，必须调用  "),a("code",[t._v("loadFileURL:allowingReadAccessToURL:")]),t._v(" 重新加载")])]),t._v(" "),a("h4",{attrs:{id:"web页面被kill时的两种情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web页面被kill时的两种情况"}},[t._v("#")]),t._v(" Web页面被Kill时的两种情况")]),t._v(" "),a("h5",{attrs:{id:"web页面正在展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web页面正在展示"}},[t._v("#")]),t._v(" Web页面正在展示")]),t._v(" "),a("p",[t._v("这种情况，直接"),a("code",[t._v("reload")]),t._v("（file协议需要调用"),a("code",[t._v("loadFileURL:allowingReadAccessToURL:")]),t._v("，后面类似情况都需要做区分，不再赘述）")]),t._v(" "),a("h5",{attrs:{id:"web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web页面非当前展示页面-退到后台或在导航栈中非当前展示的vc中"}},[t._v("#")]),t._v(" Web页面非当前展示页面，退到后台或在导航栈中非当前展示的VC中")]),t._v(" "),a("p",[t._v("这种情况不建议直接刷新页面，系统Kill是为了减少内存，如果直接刷新，经过测试系统还会继续Kill。所以直接刷新意义不大，只会造成频繁的Kill和刷新，消耗性能。")]),t._v(" "),a("p",[t._v("另外，在我们工程中，是混合Bridge模式，比如 "),a("code",[t._v("A混合页面 -> B混合页面 -> C混合页面")]),t._v(" ，A需要隐藏bar ,B C 需要展示bar ,此时如果A被杀死 然后直接reload，A中的Bridge会造成bar 被隐藏，BC页面的显示就会有问题。")]),t._v(" "),a("p",[t._v("因此这种情况需要监听 "),a("strong",[t._v("前后台状态和viewWillAppear/Disappear")]),t._v(" ，在 "),a("code",[t._v("webViewWebContentProcessDidTerminate:")]),t._v("  中记录当前URL，当页面重新展示时（从后台到前台或触发viewWillAppear）再重新刷新页面。"),a("strong",[t._v("不过需要注意，这种情况下会有个短暂的loading或白屏。")])]),t._v(" "),a("h3",{attrs:{id:"estimatedprogress问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#estimatedprogress问题"}},[t._v("#")]),t._v(" estimatedProgress问题")]),t._v(" "),a("p",[t._v("estimatedProgress 是WK推出用于监听页面加载进度的。**需要注意的是，estimatedProgress 并不是从"),a("code",[t._v("loadRequst")]),t._v("开始，也不一定是从 "),a("code",[t._v("decidePolicyForNavigationAction:")]),t._v("或 "),a("code",[t._v("didStartProvisionalNavigation")]),t._v("开始。**即中间会有一段白屏期，这块需要注意下，不过目前测试下来，这个时间目前还可以接受，暂时没有处理。")]),t._v(" "),a("p",[t._v("具体可参考 "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/XNv_3yyk-vH1xOMtPZ4K-A",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebview 加载过程中的性能指标图解"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"默认的跳转行为-打开-ituns、tel、mail、等其他scheme"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认的跳转行为-打开-ituns、tel、mail、等其他scheme"}},[t._v("#")]),t._v(" 默认的跳转行为，打开 iTuns、tel、mail、等其他scheme")]),t._v(" "),a("p",[t._v("WK上打开 mailto、tel、facetime、sms和其他scheme时，默认会忽略这些链接，不会有任何反应，这块需要单独处理。在 "),a("code",[t._v("decidePolicyForNavigationAction:")]),t._v("中判断scheme，然后调用"),a("code",[t._v("openURL:")]),t._v("函数打开。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n//参考代码\n- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler{\n    \n    NSURL *tmpURL = navigationAction.request.URL;\n    NSArray *schemes = @[@"http",@"https",@"file",@"about"];        //注意这类需要加about，部分空连接 scheme 是 about\n    if (![schemes containsObject:tmpURL.scheme]) {\n        if (@available(iOS 10.0,*)) {\n            [[UIApplication sharedApplication] openURL:tmpURL\n                                               options:@{}\n                                     completionHandler:nil];\n        }else{\n            [[UIApplication sharedApplication] openURL:tmpURL];\n        }\n        decisionHandler(WKNavigationActionPolicyCancel);\n        return;\n    }\n}\n')])])]),a("h2",{attrs:{id:"附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.apple.com/documentation/webkit?language=objc",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebKit"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://support.apple.com/zh-cn/guide/safari-developer/welcome/mac",target:"_blank",rel:"noopener noreferrer"}},[t._v("Safari Developer Help"),a("OutboundLink")],1),t._v("   Safari调试工具")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.apple.com/documentation/webkit/wkwebview?language=objc",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/7bb5f15f1daa",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView学习笔记"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/4fa8c4eb1316",target:"_blank",rel:"noopener noreferrer"}},[t._v("IOS进阶之WKWebView"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://ongfei.github.io/2016/05/14/WKWebview%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebview的使用及遇到的问题"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/0OR4HJQSDq7nEFUAaX1x5A",target:"_blank",rel:"noopener noreferrer"}},[t._v("移动端本地 H5 秒开方案探索与实现"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tech.meituan.com/2017/06/09/webviewperf.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebView性能、体验分析与优化"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.moecoder.com/2016/10/26/support-nsurlprotocol-in-wkwebview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("让 WKWebView 支持 NSURLProtocol"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://nshipster.cn/wkwebkit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("wkwebkit-nshipster"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://xiaozhuanlan.com/topic/5743162890",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 你爬出来了吗？"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.geniusqyu.com/2018/12/02/WKWebView-cookie-%E9%97%AE%E9%A2%98/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView Cookie 问题"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ChenYilong/iOSBlog/issues/14",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 防 DNS 污染方案调研（四）--- Cookie 业务场景"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/entry/5975916e518825594d23d777",target:"_blank",rel:"noopener noreferrer"}},[t._v("教你使用 WKWebView 的正确姿势"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 那些坑    Bugly"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/ac45d99cf912",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（上）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/870dba42ec15",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（中）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/52668d5b2e68",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（下）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzA5NzMwODI0MA==&mid=2647764511&idx=1&sn=eb792ed468a13239926641c9dd7091e2&chksm=8887d520bff05c36484ed8a9a0731014c93a94ac0d7d9f944c9470cad48d1f21ec0dccc552a7&mpshare=1&scene=1&srcid=&sharer_sharetime=1567467597976&sharer_shareid=c38ca2f3cbd21853ce550074313749fc%23rd",target:"_blank",rel:"noopener noreferrer"}},[t._v("一站式解决WKWebView各类问题"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.yincode.com/2018/03/23/WKWebView%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98%E9%9B%86%E5%90%88/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WKWebView 的接口中文文档"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=s.exports}}]);